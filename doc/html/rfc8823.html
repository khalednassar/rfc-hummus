<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc8823
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-acme-email-smime/">
  <meta name="description" content="Extensions to Automatic Certificate Management Environment for End-User S/MIME Certificates (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgorange"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc8823.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc8823.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/rfc8823.xml" title="XML source for this document">xml</a>|<a href="https://www.rfc-editor.org/rfc/rfc8823.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/rfc8823/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc8823/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/acme/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-acme-email-smime@ietf.org?subject=draft-ietf-acme-email-smime" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-acme-email-smime-14.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-acme-email-smime-14.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-acme-email-smime-14.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-ietf-acme-email-smime-14">draft-ietf-acme-email-smime-14</a>                       Informational</pre>
      </div>
    

    <div class="draftcontent">
    <pre>Internet Engineering Task Force (IETF)                       A. Melnikov
Request for Comments: 8823                                     Isode Ltd
Category: Informational                                       April 2021
ISSN: 2070-1721


Extensions to Automatic Certificate Management Environment for End-User
                          S/MIME Certificates

Abstract

   This document specifies identifiers and challenges required to enable
   the Automated Certificate Management Environment (ACME) to issue
   certificates for use by email users that want to use S/MIME.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are candidates for any level of Internet
   Standard; see <a href="/doc/html/rfc7841#section-2">Section&nbsp;2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8823">https://www.rfc-editor.org/info/rfc8823</a>.

Copyright Notice

   Copyright (c) 2021 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust&#x27;s Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions Used in This Document
   3.  Use of ACME for Issuing End-User S/MIME Certificates
     3.1.  ACME &quot;Challenge&quot; Email
     3.2.  ACME &quot;Response&quot; Email
     3.3.  Generating Encryption-Only or Signing-Only S/MIME
           Certificates
   4.  Internationalization Considerations
   5.  IANA Considerations
     5.1.  ACME Identifier Type
     5.2.  ACME Challenge Type
   6.  Security Considerations
   7.  References
     7.1.  Normative References
     7.2.  Informative References
   Acknowledgements
   Author&#x27;s Address

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction</span>

   ACME [<a href="/doc/html/rfc8555" title="&quot;Automatic Certificate Management Environment (ACME)&quot;">RFC8555</a>] is a mechanism for automating certificate management
   on the Internet.  It enables administrative entities to prove
   effective control over resources like domain names, and it automates
   the process of generating and issuing certificates.

   This document describes an extension to ACME for use by S/MIME.
   <a href="#section-3">Section 3</a> defines extensions for issuing end-user S/MIME [<a href="/doc/html/rfc8550" title="&quot;Secure/ Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Certificate Handling&quot;">RFC8550</a>]
   certificates.

   This document aims to support both:

   1.  A Mail User Agent (MUA) that has a built-in ACME client that is
       aware of the extension described in this document.  (We will call
       such MUAs &quot;ACME-email-aware&quot;.)  Such an MUA can present a nice
       user interface to the user and automate certificate issuance.

   2.  An MUA that is not ACME aware, with a separate ACME client
       implemented in a command-line tool or as a part of a website.
       While S/MIME certificate issuance is not going to be as painless
       as in the case of the ACME-email-aware MUA, the extra burden on a
       user is going to be minimal.

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Conventions Used in This Document</span>

   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and
   &quot;OPTIONAL&quot; in this document are to be interpreted as described in
   <a href="/doc/html/bcp14">BCP 14</a> [<a href="/doc/html/rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>] [<a href="/doc/html/rfc8174" title="&quot;Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words&quot;">RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Use of ACME for Issuing End-User S/MIME Certificates</span>

   ACME [<a href="/doc/html/rfc8555" title="&quot;Automatic Certificate Management Environment (ACME)&quot;">RFC8555</a>] defines a &quot;dns&quot; identifier type that is used to verify
   that a particular entity has control over a domain or specific
   service associated with the domain.  In order to be able to issue
   end-user S/MIME certificates, ACME needs a new identifier type that
   proves ownership of an email address.

   This document defines a new identifier type, &quot;email&quot;, which
   corresponds to an email address.  The address can be all ASCII
   [<a href="/doc/html/rfc5321" title="&quot;Simple Mail Transfer Protocol&quot;">RFC5321</a>] or internationalized [<a href="/doc/html/rfc6531" title="&quot;SMTP Extension for Internationalized Email&quot;">RFC6531</a>]; when an internationalized
   email address is used, the domain part can contain both U-labels and
   A-labels [<a href="/doc/html/rfc5890" title="&quot;Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework&quot;">RFC5890</a>].  This can be used with S/MIME or another similar
   service that requires possession of a certificate tied to an email
   address.

   Any identifier of type &quot;email&quot; in a newOrder request MUST NOT have a
   wildcard (&quot;*&quot;) character in its value.

   A new challenge type, &quot;email-reply-00&quot;, is used with the &quot;email&quot;
   identifier type, which provides proof that an ACME client has control
   over an email address.

   The process of issuing an S/MIME certificate works as follows.  Note
   that the ACME client can be a standalone application (if the MUA is
   not ACME-email-aware) or can be a component of the MUA.

   1.   An end user initiates issuance of an S/MIME certificate for one
        of their email addresses.  This might be done by using an email
        client UI, by running a command-line tool, by visiting a
        certificate authority web page, etc.  This document doesn&#x27;t
        prescribe a specific UI used to initiate S/MIME certificate
        issuance or where the ACME client is located.

   2.   The ACME-email-aware client component begins the certificate
        issuance process by sending a POST request to the server&#x27;s
        newOrder resource, including the identifier of type &quot;email&quot;.
        See <a href="/doc/html/rfc8555#section-7.4">Section&nbsp;7.4 of [RFC8555]</a> for more details.

   3.   The ACME server responds to the POST request, including an
        &quot;authorizations&quot; URL for the requested email address.  The ACME
        client then retrieves information about the corresponding
        &quot;email-reply-00&quot; challenge, as specified in <a href="/doc/html/rfc8555#section-7.5">Section&nbsp;7.5 of
        [RFC8555]</a>.  The &quot;token&quot; field of the corresponding challenge
        object (from the &quot;challenges&quot; array) contains token-part2.
        token-part2 should contain at least 128 bits of entropy.  The
        &quot;type&quot; field of the challenge object is &quot;email-reply-00&quot;.  The
        challenge object also contains the &quot;from&quot; field, with the email
        address that would be used in the From header field of the
        &quot;challenge&quot; email message (see the next step).

        An example challenge object might look like this:

          {
            &quot;type&quot;: &quot;email-reply-00&quot;,
            &quot;url&quot;: &quot;https://example.com/acme/chall/ABprV_B7yEyA4f&quot;,
            &quot;from&quot;: &quot;acme-challenge+2i211oi1204310@example.com&quot;,
            &quot;token&quot;: &quot;DGyRejmCefe7v4NfDGDKfA&quot;
          }

   4.   After responding to the authorization request, the ACME server
        generates another token and a &quot;challenge&quot; email message with the
        subject &quot;ACME: &lt;token-part1&gt;&quot;, where &lt;token-part1&gt; is the
        base64url-encoded [<a href="/doc/html/rfc4648" title="&quot;The Base16, Base32, and Base64 Data Encodings&quot;">RFC4648</a>] form of the token.  The ACME server
        MUST generate a fresh token for each S/MIME issuance request
        (authorization request), and token-part1 MUST contain at least
        128 bits of entropy.  The &quot;challenge&quot; email message structure is
        described in more details in <a href="#section-3.1">Section 3.1</a>.

   5.   The MUA retrieves and parses the &quot;challenge&quot; email message.  If
        the MUA is ACME-email-aware, it ignores any &quot;challenge&quot; email
        that is not expected, e.g., if there is no ACME certificate
        issuance pending.  The ACME-email-aware MUA also ignores any
        &quot;challenge&quot; email that has the Subject header field that
        indicates that it is an email reply, e.g., a subject starting
        with the reply prefix &quot;Re:&quot;.

   6.   The ACME client concatenates &quot;token-part1&quot; (received over email)
        and &quot;token-part2&quot; (received over HTTPS [<a href="/doc/html/rfc2818" title="&quot;HTTP Over TLS&quot;">RFC2818</a>]) to create the
        ACME &quot;token&quot; and calculates keyAuthorization (as per <a href="/doc/html/rfc8555#section-8.1">Section&nbsp;8.1
        of [RFC8555]</a>).  Then, it returns the base64url-encoded SHA-256
        digest [<a href="/doc/html/rfc6234" title="&quot;US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)&quot;">RFC6234</a>] of the key authorization.  The MUA returns the
        base64url-encoded SHA-256 digest obtained from the ACME client
        in the body of a &quot;response&quot; email message.  The &quot;response&quot; email
        message structure is described in more details in <a href="#section-3.2">Section 3.2</a>.
        If the MUA is ACME-email-aware, it MUST NOT respond to the same
        &quot;challenge&quot; email more than once.

   7.   Once the MUA sends the &quot;response&quot; email, the ACME client
        notifies the ACME server by POST to the challenge URL (&quot;url&quot;
        field).

   8.   The ACME client can start polling the authorization URL (using
        POST-as-GET requests) to see if the ACME server received and
        validated the &quot;response&quot; email message.  (See <a href="/doc/html/rfc8555#section-7.5.1">Section&nbsp;7.5.1 of
        [RFC8555]</a> for more details.)  If the &quot;status&quot; field of the
        challenge switches to &quot;valid&quot;, then the ACME client can proceed
        with request finalization.  The Certificate Signing Request
        (CSR) MUST indicate the exact same set of requested identifiers
        as the initial newOrder request.  For an identifier of type
        &quot;email&quot;, the PKCS#10 [<a href="/doc/html/rfc2986" title="&quot;PKCS #10: Certification Request Syntax Specification Version 1.7&quot;">RFC2986</a>] CSR MUST contain the requested
        email address in an extensionRequest attribute [<a href="/doc/html/rfc2985" title="&quot;PKCS #9: Selected Object Classes and Attribute Types Version 2.0&quot;">RFC2985</a>]
        requesting a subjectAltName extension.  The email address MUST
        also match the From header field value of the &quot;response&quot; email
        message.

   9.   In order to request generation of signing-only or encryption-
        only S/MIME certificates (as opposed to requesting generation of
        S/MIME certificates suitable for both), the CSR needs to include
        the key usage extension (see <a href="/doc/html/rfc8550#section-4.4.2">Section&nbsp;4.4.2 of [RFC8550]</a>).  This
        is described in more details in <a href="#section-3.3">Section 3.3</a>.

   10.  If a request to finalize an order is successful, the ACME server
        will return a 200 (OK) with an updated order object.  If the
        certificate is issued successfully, i.e., if the order &quot;status&quot;
        is &quot;valid&quot;, then the ACME client can download the issued S/MIME
        certificate from the URL specified in the &quot;certificate&quot; field.

<span class="h3"><a class="selflink" id="section-3.1" href="#section-3.1">3.1</a>.  ACME &quot;Challenge&quot; Email</span>

   A &quot;challenge&quot; email message MUST have the following structure:

   1.  The Subject header field has the following syntax: &quot;ACME: &lt;token-
       part1&gt;&quot;, where the prefix &quot;ACME:&quot; is followed by folding white
       space (FWS; see [<a href="/doc/html/rfc5322" title="&quot;Internet Message Format&quot;">RFC5322</a>]) and then by &lt;token-part1&gt;, which is
       the base64url-encoded first part of the ACME token that MUST be
       at least 128 bits long after decoding.  Due to the recommended
       78-octet line-length limit in [<a href="/doc/html/rfc5322" title="&quot;Internet Message Format&quot;">RFC5322</a>], the subject line can be
       folded, so white spaces (if any) within the &lt;token-part1&gt; MUST be
       ignored.  [<a href="/doc/html/rfc2231" title="&quot;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations&quot;">RFC2231</a>] encoding of the Subject header field MUST be
       supported, and, when used, only the &quot;UTF-8&quot; and &quot;US-ASCII&quot;
       charsets are allowed; other charsets MUST NOT be used.  The US-
       ASCII charset SHOULD be used.

   2.  The From header field MUST be the same email address as specified
       in the &quot;from&quot; field of the challenge object.

   3.  The To header field MUST be the email address of the entity that
       requested the S/MIME certificate to be generated.

   4.  The message MAY contain a Reply-To and/or CC header field.

   5.  The message MUST include the Auto-Submitted header field with the
       value &quot;auto-generated&quot; [<a href="/doc/html/rfc3834" title="&quot;Recommendations for Automatic Responses to Electronic Mail&quot;">RFC3834</a>].  To aid in debugging (and, for
       some implementations, to make automated processing easier), the
       Auto-Submitted header field SHOULD include the &quot;type=acme&quot;
       parameter.  It MAY include other optional parameters, as allowed
       by the syntax of the Auto-Submitted header field.

   6.  In order to prove authenticity of a challenge message, it MUST be
       signed using either DomainKeys Identified Mail (DKIM) [<a href="/doc/html/rfc6376" title="&quot;DomainKeys Identified Mail (DKIM) Signatures&quot;">RFC6376</a>]
       or S/MIME [<a href="/doc/html/rfc8551" title="&quot;Secure/ Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification&quot;">RFC8551</a>].

       *  If DKIM signing is used, the resulting DKIM-Signature header
          field MUST contain the &quot;h=&quot; tag that includes at least the
          From, Sender, Reply-To, To, CC, Subject, Date, In-Reply-To,
          References, Message-ID, Auto-Submitted, Content-Type, and
          Content-Transfer-Encoding header fields.  The DKIM-Signature
          header field&#x27;s &quot;h=&quot; tag SHOULD also include the Resent-Date,
          Resent-From, Resent-To, Resent-Cc, List-Id, List-Help, List-
          Unsubscribe, List-Subscribe, List-Post, List-Owner, List-
          Archive, and List-Unsubscribe-Post header fields.  The domain
          from the &quot;d=&quot; tag of the DKIM-Signature header field MUST be
          the same as the domain from the From header field of the
          &quot;challenge&quot; email.

       *  If S/MIME signing is used, the certificate corresponding to
          the signer MUST have an rfc822Name subjectAltName extension
          with the value equal to the From header field email address of
          the &quot;challenge&quot; email.

   7.  The body of the challenge message is not used for automated
       processing, so it can be any media type.  (However, there are
       extra requirements on S/MIME signing, if used.  See below.)
       Typically, it is text/plain or text/html containing a human-
       readable explanation of the purpose of the message.  If S/MIME
       signing is used to prove authenticity of the challenge message,
       then the multipart/signed or &quot;application/pkcs7-mime; smime-
       type=signed-data;&quot; media type should be used.  Either way, it
       MUST use S/MIME header protection.

   An email client compliant with this specification that detects that a
   particular &quot;challenge&quot; email fails the validation described above
   MUST ignore the challenge and thus will not generate a &quot;response&quot;
   email.  To aid in debugging, such failed validations SHOULD be
   logged.

   Here is an example of an ACME &quot;challenge&quot; email (note that, for
   simplicity, DKIM-related header fields are not included).


     Auto-Submitted: auto-generated; type=acme
     Date: Sat, 5 Dec 2020 10:08:55 +0100
     Message-ID: &lt;A2299BB.FF7788@example.org&gt;
     From: acme-generator@example.org
     To: alexey@example.com
     Subject: ACME: LgYemJLy3F1LDkiJrdIGbEzyFJyOyf6vBdyZ1TG3sME=
     Content-Type: text/plain
     MIME-Version: 1.0

     This is an automatically generated ACME challenge for email address
     &quot;alexey@example.com&quot;. If you haven&#x27;t requested an S/MIME
     certificate generation for this email address, be very afraid.
     If you did request it, your email client might be able to process
     this request automatically, or you might have to paste the first
     token part into an external program.

                                  Figure 1


<span class="h3"><a class="selflink" id="section-3.2" href="#section-3.2">3.2</a>.  ACME &quot;Response&quot; Email</span>

   A valid &quot;response&quot; email message MUST have the following structure:

   1.  The Subject header field is formed as a reply to the ACME
       &quot;challenge&quot; email (see <a href="#section-3.1">Section 3.1</a>).  Its syntax is the same as
       that of the challenge message except that it may be prefixed by a
       US-ASCII reply prefix (typically &quot;Re:&quot;) and FWS (see [<a href="/doc/html/rfc5322" title="&quot;Internet Message Format&quot;">RFC5322</a>]),
       as is normal in reply messages.  When parsing the subject, ACME
       servers MUST decode [<a href="/doc/html/rfc2231" title="&quot;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations&quot;">RFC2231</a>] encoding (if any), and then they
       can ignore any prefix before the &quot;ACME:&quot; label.

   2.  The From header field contains the email address of the user that
       is requesting S/MIME certificate issuance.

   3.  The To header field of the response contains the value from the
       Reply-To header field from the challenge message (if set).
       Otherwise, it contains the value from the From header field of
       the challenge message.

   4.  The Cc header field is ignored if present in the &quot;response&quot; email
       message.

   5.  The In-Reply-To header field SHOULD be set to the Message-ID
       header field of the challenge message according to rules in
       <a href="/doc/html/rfc5322#section-3.6.4">Section&nbsp;3.6.4 of [RFC5322]</a>.

   6.  List-* header fields [<a href="/doc/html/rfc4021" title="&quot;Registration of Mail and MIME Header Fields&quot;">RFC4021</a>][RFC8058] MUST be absent (i.e., the
       reply can&#x27;t come from a mailing list).

   7.  The media type of the &quot;response&quot; email message is either text/
       plain or multipart/alternative [<a href="/doc/html/rfc2046" title="&quot;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types&quot;">RFC2046</a>], containing text/plain
       as one of the alternatives.  (Note that the requirement to
       support multipart/alternative is to allow use of ACME-unaware
       MUAs, which can&#x27;t always generate pure text/plain, e.g., if they
       reply to a text/html).  The text/plain body part (whether or not
       it is inside multipart/alternative) MUST contain a block of lines
       starting with the line &quot;-----BEGIN ACME RESPONSE-----&quot;, followed
       by one or more lines containing the base64url-encoded SHA-256
       digest [<a href="/doc/html/rfc6234" title="&quot;US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)&quot;">RFC6234</a>] of the key authorization, calculated from
       concatenated token-part1 (received over email) and token-part2
       (received over HTTPS), as outlined in the 5th bullet in
       <a href="#section-3">Section 3</a>.  (Note that each line of text/plain is terminated by
       CRLF.  Bare LFs or bare CRs are not allowed.)  Due to historical
       line-length limitations in email, line endings (CRLFs) can be
       freely inserted in the middle of the encoded digest, so they MUST
       be ignored when processing it.  The final line of the encoded
       digest is followed by a line containing:

      -----END ACME RESPONSE-----

       Any text before and after this block is ignored.  For example,
       such text might explain what to do with it for ACME-unaware
       clients.

   8.  There is no need to use any Content-Transfer-Encoding other than
       7bit for the text/plain body part.  Use of quoted-printable or
       base64 in a &quot;response&quot; email message is not necessary and should
       be avoided, though it is permitted.

   9.  In order to prove authenticity of a response message, it MUST be
       DKIM [<a href="/doc/html/rfc6376" title="&quot;DomainKeys Identified Mail (DKIM) Signatures&quot;">RFC6376</a>] signed.  The resulting DKIM-Signature header field
       MUST contain the &quot;h=&quot; tag that includes at least the From,
       Sender, Reply-To, To, CC, Subject, Date, In-Reply-To, References,
       Message-ID, Content-Type, and Content-Transfer-Encoding header
       fields.  The DKIM-Signature header field&#x27;s &quot;h=&quot; tag SHOULD also
       include the Resent-Date, Resent-From, Resent-To, Resent-Cc, List-
       Id, List-Help, List-Unsubscribe, List-Subscribe, List-Post, List-
       Owner, List-Archive, and List-Unsubscribe-Post header fields.
       The domain from the &quot;d=&quot; tag of DKIM-Signature header field MUST
       be the same as the domain from the From header field of the
       &quot;response&quot; email.

   Here is an example of an ACME &quot;response&quot; email (note that, for
   simplicity, DKIM-related header fields are not included).

      Date: Sat, 5 Dec 2020 12:01:45 +0100
      Message-ID: &lt;111-22222-3333333@example.com&gt;
      In-Reply-To: &lt;A2299BB.FF7788@example.org&gt;
      From: alexey@example.com
      To: acme-generator@example.org
      Subject: Re: ACME: LgYemJLy3F1LDkiJrdIGbEzyFJyOyf6vBdyZ1TG3sME=
      Content-Type: text/plain
      MIME-Version: 1.0

      -----BEGIN ACME RESPONSE-----
      LoqXcYV8q5ONbJQxbmR7SCTNo3tiAXDfowy
      jxAjEuX0=
      -----END ACME RESPONSE-----

                                  Figure 2


<span class="h3"><a class="selflink" id="section-3.3" href="#section-3.3">3.3</a>.  Generating Encryption-Only or Signing-Only S/MIME Certificates</span>

   ACME extensions specified in this document can be used to request
   signing-only or encryption-only S/MIME certificates.

   In order to request signing-only S/MIME certificates, the CSR MUST
   include the key usage extension with digitalSignature and/or
   nonRepudiation bits set and no other bits set.

   In order to request encryption-only S/MIME certificates, the CSR MUST
   include the key usage extension with keyEncipherment or keyAgreement
   bits set and no other bits set.

   Presence of both of the above sets of key usage bits in the CSR, as
   well as absence of the key usage extension in the CSR, signals to the
   ACME server to issue an S/MIME certificate suitable for both signing
   and encryption.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  Internationalization Considerations</span>

   [<a id="ref-RFC8616">RFC8616</a>] updated/clarified use of DKIM with internationalized email
   addresses [<a href="/doc/html/rfc6531" title="&quot;SMTP Extension for Internationalized Email&quot;">RFC6531</a>].  Please consult [<a href="/doc/html/rfc8616" title="&quot;Email Authentication for Internationalized Mail&quot;">RFC8616</a>] in regards to any
   changes that need to be implemented.

   Use of non-ASCII characters in left-hand sides of internationalized
   email addresses requires putting internationalized email addresses in
   X.509 certificates [<a href="/doc/html/rfc8398" title="&quot;Internationalized Email Addresses in X.509 Certificates&quot;">RFC8398</a>].

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  IANA Considerations</span>

<span class="h3"><a class="selflink" id="section-5.1" href="#section-5.1">5.1</a>.  ACME Identifier Type</span>

   IANA has registered a new identifier type in the &quot;ACME Identifier
   Types&quot; registry defined in <a href="/doc/html/rfc8555#section-9.7.7">Section&nbsp;9.7.7 of [RFC8555]</a> with Label
   &quot;email&quot; and a Reference to this document, [<a href="/doc/html/rfc5321" title="&quot;Simple Mail Transfer Protocol&quot;">RFC5321</a>], and [<a href="/doc/html/rfc6531" title="&quot;SMTP Extension for Internationalized Email&quot;">RFC6531</a>].
   The new identifier type corresponds to an (all ASCII) email address
   [<a href="/doc/html/rfc5321" title="&quot;Simple Mail Transfer Protocol&quot;">RFC5321</a>] or internationalized email addresses [<a href="/doc/html/rfc6531" title="&quot;SMTP Extension for Internationalized Email&quot;">RFC6531</a>].

<span class="h3"><a class="selflink" id="section-5.2" href="#section-5.2">5.2</a>.  ACME Challenge Type</span>

   IANA has registered a new entry in the &quot;ACME Validation Methods&quot;
   registry defined in <a href="/doc/html/rfc8555#section-9.7.8">Section&nbsp;9.7.8 of [RFC8555]</a>.  This entry is as
   follows:

          +================+=================+======+===========+
          |     Label      | Identifier Type | ACME | Reference |
          +================+=================+======+===========+
          | email-reply-00 |      email      |  Y   |  <a href="/doc/html/rfc8823">RFC 8823</a> |
          +----------------+-----------------+------+-----------+

                                  Table 1

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Security Considerations</span>

   Please see the Security Considerations section of [<a href="/doc/html/rfc8555" title="&quot;Automatic Certificate Management Environment (ACME)&quot;">RFC8555</a>] for
   general security considerations related to the use of ACME.  This
   challenge/response protocol demonstrates that an entity that controls
   the private key (corresponding to the public key in the certificate)
   also controls the named email account.  The ACME server is confirming
   that the requested email address belongs to the entity that requested
   the certificate, but this makes no claim to address correctness or
   fitness for purpose.  If such claims are needed, they must be
   obtained by some other mechanism.

   The security of the &quot;email-reply-00&quot; challenge type depends on the
   security of the email system.  A third party that can read and reply
   to user&#x27;s email messages (by possessing a user&#x27;s password or a secret
   derived from it that can give read and reply access, such as
   &quot;password equivalent&quot; information, or by being given permissions to
   act on a user&#x27;s behalf using email delegation features common in some
   email systems) can request S/MIME certificates using the protocol
   specified in this document and is indistinguishable from the email
   account owner.  This has several possible implications:

   1.  An entity that compromised an email account would be able to
       request S/MIME certificates using the protocol specified in this
       document, and such entity couldn&#x27;t be distinguished from the
       legitimate email account owner (unless some external sources of
       information are consulted).

   2.  For email addresses with legitimate shared access/control by
       multiple users, any such user would be able to request S/MIME
       certificates using the protocol specified in this document; such
       requests can&#x27;t be attributed to a specific user without
       consulting external systems (such as IMAP/SMTP access logs).

   3.  The protocol specified in this document is not suitable for use
       with email addresses associated with mailing lists [<a href="/doc/html/rfc5321" title="&quot;Simple Mail Transfer Protocol&quot;">RFC5321</a>].
       While it is not always possible to guarantee that a particular S/
       MIME certificate request is not from a mailing list address,
       prohibition on inclusion of List-* header fields helps
       certificate issuers to handle most common cases.

   An email system in its turn depends on DNS.  A third party that can
   manipulate DNS MX records for a domain might be able to redirect an
   email and can get (at least temporary) read and reply access to it.
   Similar considerations apply to DKIM TXT records in DNS.  Use of
   DNSSEC by email system administrators is recommended to avoid making
   it easy to spoof DNS records affecting an email system.  However, use
   of DNSSEC is not ubiquitous at the time of publishing of this
   document, so it is not required here.  Also, many existing systems
   that rely on verification of ownership of an email address -- for
   example, 2-factor authentication systems used by banks or traditional
   certificate issuance systems -- send email messages to email
   addresses, expecting the owner to click on the link supplied in them
   (or to reply to a message), without requiring use of DNSSEC.  So the
   risk of not requiring DNSSEC is presumed acceptable in this document.

   An ACME email challenge message can be forged by an attacker.  As per
   requirements on an ACME-email-aware MUA specified in <a href="#section-3">Section 3</a>, the
   MUA will not respond to requests it is not expecting.  Even if the
   attacker causes the erroneous &quot;response&quot; email to go to an attacker-
   controlled email address, very little information is leaked -- the
   SHA-256 hash of the key authorization would be leaked, not the key
   authorization itself, so no parts of the token or the account key
   thumbprint are leaked.

   An attacker that can read the &quot;response&quot; email has only one chance to
   guess the token-part2.  Even if the attacker can guess it right, it
   still needs to know the ACME account key to be able to make use of
   the intercepted SHA-256 hash of the key authorization.

   Also see the Security Considerations section of [<a href="/doc/html/rfc6376" title="&quot;DomainKeys Identified Mail (DKIM) Signatures&quot;">RFC6376</a>] for details
   on how DKIM depends on the DNS and the respective vulnerabilities
   this dependence has.

<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  References</span>

<span class="h3"><a class="selflink" id="section-7.1" href="#section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-RFC2046">RFC2046</a>]  Freed, N. and N. Borenstein, &quot;Multipurpose Internet Mail
              Extensions (MIME) Part Two: Media Types&quot;, <a href="/doc/html/rfc2046">RFC 2046</a>,
              DOI 10.17487/RFC2046, November 1996,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2046">https://www.rfc-editor.org/info/rfc2046</a>&gt;.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., &quot;Key words for use in RFCs to Indicate
              Requirement Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2231">RFC2231</a>]  Freed, N. and K. Moore, &quot;MIME Parameter Value and Encoded
              Word Extensions: Character Sets, Languages, and
              Continuations&quot;, <a href="/doc/html/rfc2231">RFC 2231</a>, DOI 10.17487/RFC2231, November
              1997, &lt;<a href="https://www.rfc-editor.org/info/rfc2231">https://www.rfc-editor.org/info/rfc2231</a>&gt;.

   [<a id="ref-RFC2818">RFC2818</a>]  Rescorla, E., &quot;HTTP Over TLS&quot;, <a href="/doc/html/rfc2818">RFC 2818</a>,
              DOI 10.17487/RFC2818, May 2000,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2818">https://www.rfc-editor.org/info/rfc2818</a>&gt;.

   [<a id="ref-RFC2985">RFC2985</a>]  Nystrom, M. and B. Kaliski, &quot;PKCS #9: Selected Object
              Classes and Attribute Types Version 2.0&quot;, <a href="/doc/html/rfc2985">RFC 2985</a>,
              DOI 10.17487/RFC2985, November 2000,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2985">https://www.rfc-editor.org/info/rfc2985</a>&gt;.

   [<a id="ref-RFC2986">RFC2986</a>]  Nystrom, M. and B. Kaliski, &quot;PKCS #10: Certification
              Request Syntax Specification Version 1.7&quot;, <a href="/doc/html/rfc2986">RFC 2986</a>,
              DOI 10.17487/RFC2986, November 2000,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2986">https://www.rfc-editor.org/info/rfc2986</a>&gt;.

   [<a id="ref-RFC3834">RFC3834</a>]  Moore, K., &quot;Recommendations for Automatic Responses to
              Electronic Mail&quot;, <a href="/doc/html/rfc3834">RFC 3834</a>, DOI 10.17487/RFC3834, August
              2004, &lt;<a href="https://www.rfc-editor.org/info/rfc3834">https://www.rfc-editor.org/info/rfc3834</a>&gt;.

   [<a id="ref-RFC4648">RFC4648</a>]  Josefsson, S., &quot;The Base16, Base32, and Base64 Data
              Encodings&quot;, <a href="/doc/html/rfc4648">RFC 4648</a>, DOI 10.17487/RFC4648, October 2006,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;.

   [<a id="ref-RFC5321">RFC5321</a>]  Klensin, J., &quot;Simple Mail Transfer Protocol&quot;, <a href="/doc/html/rfc5321">RFC 5321</a>,
              DOI 10.17487/RFC5321, October 2008,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5321">https://www.rfc-editor.org/info/rfc5321</a>&gt;.

   [<a id="ref-RFC5322">RFC5322</a>]  Resnick, P., Ed., &quot;Internet Message Format&quot;, <a href="/doc/html/rfc5322">RFC 5322</a>,
              DOI 10.17487/RFC5322, October 2008,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5322">https://www.rfc-editor.org/info/rfc5322</a>&gt;.

   [<a id="ref-RFC5890">RFC5890</a>]  Klensin, J., &quot;Internationalized Domain Names for
              Applications (IDNA): Definitions and Document Framework&quot;,
              <a href="/doc/html/rfc5890">RFC 5890</a>, DOI 10.17487/RFC5890, August 2010,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5890">https://www.rfc-editor.org/info/rfc5890</a>&gt;.

   [<a id="ref-RFC6234">RFC6234</a>]  Eastlake 3rd, D. and T. Hansen, &quot;US Secure Hash Algorithms
              (SHA and SHA-based HMAC and HKDF)&quot;, <a href="/doc/html/rfc6234">RFC 6234</a>,
              DOI 10.17487/RFC6234, May 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6234">https://www.rfc-editor.org/info/rfc6234</a>&gt;.

   [<a id="ref-RFC6376">RFC6376</a>]  Crocker, D., Ed., Hansen, T., Ed., and M. Kucherawy, Ed.,
              &quot;DomainKeys Identified Mail (DKIM) Signatures&quot;, STD 76,
              <a href="/doc/html/rfc6376">RFC 6376</a>, DOI 10.17487/RFC6376, September 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6376">https://www.rfc-editor.org/info/rfc6376</a>&gt;.

   [<a id="ref-RFC6531">RFC6531</a>]  Yao, J. and W. Mao, &quot;SMTP Extension for Internationalized
              Email&quot;, <a href="/doc/html/rfc6531">RFC 6531</a>, DOI 10.17487/RFC6531, February 2012,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6531">https://www.rfc-editor.org/info/rfc6531</a>&gt;.

   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., &quot;Ambiguity of Uppercase vs Lowercase in <a href="/doc/html/rfc2119">RFC</a>
              <a href="/doc/html/rfc2119">2119</a> Key Words&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

   [<a id="ref-RFC8398">RFC8398</a>]  Melnikov, A., Ed. and W. Chuang, Ed., &quot;Internationalized
              Email Addresses in X.509 Certificates&quot;, <a href="/doc/html/rfc8398">RFC 8398</a>,
              DOI 10.17487/RFC8398, May 2018,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8398">https://www.rfc-editor.org/info/rfc8398</a>&gt;.

   [<a id="ref-RFC8550">RFC8550</a>]  Schaad, J., Ramsdell, B., and S. Turner, &quot;Secure/
              Multipurpose Internet Mail Extensions (S/MIME) Version 4.0
              Certificate Handling&quot;, <a href="/doc/html/rfc8550">RFC 8550</a>, DOI 10.17487/RFC8550,
              April 2019, &lt;<a href="https://www.rfc-editor.org/info/rfc8550">https://www.rfc-editor.org/info/rfc8550</a>&gt;.

   [<a id="ref-RFC8551">RFC8551</a>]  Schaad, J., Ramsdell, B., and S. Turner, &quot;Secure/
              Multipurpose Internet Mail Extensions (S/MIME) Version 4.0
              Message Specification&quot;, <a href="/doc/html/rfc8551">RFC 8551</a>, DOI 10.17487/RFC8551,
              April 2019, &lt;<a href="https://www.rfc-editor.org/info/rfc8551">https://www.rfc-editor.org/info/rfc8551</a>&gt;.

   [<a id="ref-RFC8555">RFC8555</a>]  Barnes, R., Hoffman-Andrews, J., McCarney, D., and J.
              Kasten, &quot;Automatic Certificate Management Environment
              (ACME)&quot;, <a href="/doc/html/rfc8555">RFC 8555</a>, DOI 10.17487/RFC8555, March 2019,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8555">https://www.rfc-editor.org/info/rfc8555</a>&gt;.

   [<a id="ref-RFC8616">RFC8616</a>]  Levine, J., &quot;Email Authentication for Internationalized
              Mail&quot;, <a href="/doc/html/rfc8616">RFC 8616</a>, DOI 10.17487/RFC8616, June 2019,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8616">https://www.rfc-editor.org/info/rfc8616</a>&gt;.

<span class="h3"><a class="selflink" id="section-7.2" href="#section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-RFC4021">RFC4021</a>]  Klyne, G. and J. Palme, &quot;Registration of Mail and MIME
              Header Fields&quot;, <a href="/doc/html/rfc4021">RFC 4021</a>, DOI 10.17487/RFC4021, March
              2005, &lt;<a href="https://www.rfc-editor.org/info/rfc4021">https://www.rfc-editor.org/info/rfc4021</a>&gt;.

   [<a id="ref-RFC8058">RFC8058</a>]  Levine, J. and T. Herkula, &quot;Signaling One-Click
              Functionality for List Email Headers&quot;, <a href="/doc/html/rfc8058">RFC 8058</a>,
              DOI 10.17487/RFC8058, January 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8058">https://www.rfc-editor.org/info/rfc8058</a>&gt;.

Acknowledgements

   Thank you to Andreas Schulze, Gerd v. Egidy, James A. Baker, Ben
   Schwartz, Peter Yee, Hilarie Orman, Michael Jenkins, Barry Leiba,
   Fraser Tweedale, Daniel Kahn Gillmor, and Benjamin Kaduk for their
   suggestions, comments, and corrections of this document.

Author&#x27;s Address

   Alexey Melnikov
   Isode Ltd
   14 Castle Mews
   Hampton, Middlesex
   TW12 2NP
   United Kingdom

   Email: alexey.melnikov@isode.com
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

