<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc2852
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-newman-deliver/">
  <meta name="description" content="Deliver By SMTP Service Extension (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc2852.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc2852.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc2852.txt.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/rfc2852/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc2852/" title="Datatracker information for this document">Tracker</a>] [<a href="mailto:draft-newman-deliver@ietf.org?subject=draft-newman-deliver" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-newman-deliver-02.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-newman-deliver-02.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-newman-deliver-02.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-newman-deliver-02">draft-newman-deliver-02</a>                          Proposed Standard
                                                            <a class="text-warning" href="https://www.rfc-editor.org/errata_search.php?rfc=2852&amp;rec_status=0">Errata exist</a></pre>
      </div>
    

    <div class="draftcontent">
    <pre>Network Working Group                                           D. Newman
Request for Comments: 2852                               Sun Microsystems
Updates: <a href="/doc/html/rfc1894">1894</a>                                                   June 2000
Category: Standards Track


                   <span class="h1">Deliver By SMTP Service Extension</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the &quot;Internet
   Official Protocol Standards&quot; (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2000).  All Rights Reserved.

Abstract

   This memo defines a mechanism whereby a SMTP client can request, when
   transmitting a message to a SMTP server, that the server deliver the
   message within a prescribed period of time.  A client making such a
   request also specifies the message handling which is to occur if the
   message cannot be delivered within the specified time period: either
   the message is to be returned as undeliverable with no further
   processing, or a &quot;delayed&quot; delivery status notification (DSN) [<a href="#ref-6" title="&quot;An Extensible Message Format for Delivery Status Notifications&quot;">6</a>] is
   to be issued.

   This extension should not be viewed as a vehicle for requesting
   &quot;priority&quot; processing.  A receiving SMTP server may assign whatever
   processing priority it wishes to a message transmitted with a Deliver
   By request.  A Deliver By request serves to express a message&#x27;s
   urgency and to provide an additional degree of determinancy in its
   processing.  An indication of an urgent message&#x27;s status within a
   given time period may be requested and will be honored.  Moreover,
   the message may be withdrawn if not delivered within that time
   period.

   A typical usage of this mechanism is to prevent delivery of a message
   beyond some future time of significance to the sender or recipient
   but not known by the MTAs handling the message.  For instance, the
   sender may know that the message will be delivered as a page but does
   not consider the message to be sufficiently important as to warrant
   paging the recipient after business hours. In that case, the message
   could be marked such that delivery attempts are not made beyond



<span class="grey">Newman                      Standards Track                     [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


   17:00.  Another common usage arises when a sender wishes to be
   alerted to delivery delays.  In this case, the sender can mark a
   message such that if it is not delivered within, say, 30 minutes, a
   &quot;delayed&quot; DSN is generated but delivery attempts are nonetheless
   continued.  In this case the sender has been allowed to express a
   preference for when they would like to learn of delivery problems.

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Definitions</span>

   Throughout this document, the term &quot;deliver&quot; is taken to mean the act
   of transmitting a message to its &quot;final&quot; destination by a message
   transport agent (MTA).  Usually, but not always, this means storing
   or otherwise handing off the message to the recipient&#x27;s mailbox.
   Thus, an MTA which accepts a message to be delivered within a
   specified time period is agreeing to store or handoff the message to
   the recipient&#x27;s mailbox within the specified time period.  Outside
   the scope of the term &quot;deliver&quot; are any user-specified actions which
   might take place after the MTA stores or hands off the message; e.g.,
   user-programmed filters which, often unbeknownst to the MTA, resend
   the message to some other location.

   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;SHOULD&quot; and &quot;SHOULD NOT&quot; in this
   document are to be interpreted as described in <a href="/doc/html/rfc2119">RFC 2119</a> [<a href="#ref-7" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">7</a>].

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Framework for the Deliver By SMTP service extension</span>

   The Deliver By SMTP service extension uses the SMTP service extension
   mechanism described in [<a href="#ref-4" title="&quot;SMTP Service Extensions&quot;">4</a>].  The following SMTP service extension is
   therefore defined:

   (1)  The name of the SMTP service extension is &quot;Deliver By&quot;.

   (2)  The EHLO keyword value associated with this service extension is
        &quot;DELIVERBY&quot;.

   (3)  One optional parameter is allowed with this EHLO keyword value.
        The optional parameter, when supplied, is a comma separated list
        of options.  Only one option, a min-by-time, is specified in
        this document.  Future documents may extend this specification
        by specifying additional options.  The min-by-time is a fixed
        integer indicating the fixed minimum by-time that the server
        will accept when a by-mode of &quot;R&quot; is specified as per <a href="#section-4">Section 4</a>.

        The syntax of the optional parameter is as follows, using the
        augmented BNF notation of <a href="/doc/html/rfc2234">RFC 2234</a> [<a href="#ref-2" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">2</a>]:






<span class="grey">Newman                      Standards Track                     [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


      deliverby-param = min-by-time *( &#x27;,&#x27; extension-token )
      min-by-time     = [1*9DIGIT]
      extension-token = 1*&lt;any CHAR excluding SP, COMMA and all control
                           characters (US ASCII 0-31 inclusive)&gt;
      SP               = &lt;the space character (ASCII decimal code 32)&gt;
      COMMA            = &lt;the comma character (ASCII decimal code 44)&gt;

        If the parameter is omitted, no information is conveyed about
        the server&#x27;s fixed minimum by-time.

   (4)  One optional parameter using the keyword &quot;BY&quot; is added to the
        MAIL FROM command.

   (5)  The maximum length of a MAIL FROM command line is increased by
        17 characters by the possible addition of the BY keyword and
        value.

   (6)  No additional SMTP verbs are defined by this extension.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  The Deliver By SMTP service extension</span>

   A SMTP client wishing to use the Deliver By SMTP service extension
   may issue the EHLO command to start a SMTP session and to determine
   if the SMTP server supports the service extension.  If the server
   responds with code 250 to the EHLO command, and the response includes
   the EHLO keyword DELIVERBY, then the Deliver By SMTP service
   extension is supported by the server.

   If a numeric parameter follows the DELIVERBY keyword value of the
   EHLO response then that parameter indicates the minimum value allowed
   for the by-time when a by-mode of &quot;R&quot; is specified with the extended
   MAIL FROM command as described in <a href="#section-4">Section 4</a>.  Any attempt by a client
   to specify a by-mode of &quot;R&quot; and a by-time strictly less than this
   limit, min-by-time, will be rejected with a permanent failure (55z)
   reply code.

   A SMTP server that supports the Deliver By SMTP service extension
   will accept the extended version of the MAIL FROM command described
   in <a href="#section-4">Section 4</a>.  When supported by the server, a SMTP client may use
   the extended MAIL FROM command (instead of the MAIL FROM command
   described in [<a href="#ref-1" title="&quot;Simple Mail Transfer Protocol&quot;">1</a>]) to request that the message be delivered within the
   specified time period.  The server may then return an appropriate
   error code if it determines that the request cannot be honored.  Note
   that this may not be apparent to the server until either presentation
   of the recipient addresses with RCPT TO commands or completion of the
   transfer of the message data with the dot (.) command.  As such, the





<span class="grey">Newman                      Standards Track                     [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


   server may send to the client a success response to the MAIL FROM
   command only to later return an error response to the RCPT TO, DATA,
   or dot command.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  The extended MAIL FROM command</span>

   The extended MAIL FROM command is issued by a SMTP client when it
   wishes to inform a SMTP server that a message is to be delivered
   within a specified period of time and further what action to take
   should the message prove undeliverable within that time period.  The
   extended MAIL FROM command is identical to the MAIL FROM command as
   defined in <a href="/doc/html/rfc821">RFC 821</a> [<a href="#ref-1" title="&quot;Simple Mail Transfer Protocol&quot;">1</a>], except that a BY parameter appears after the
   address.

   The complete syntax of this extended command is defined in [<a href="#ref-4" title="&quot;SMTP Service Extensions&quot;">4</a>].  The
   esmtp-keyword is &quot;BY&quot; and the syntax for the esmtp-value is given by
   the syntax for by-value shown below.  In the augmented BNF of <a href="/doc/html/rfc2234">RFC</a>
   <a href="/doc/html/rfc2234">2234</a> [<a href="#ref-2" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">2</a>], the syntax for the BY esmtp-parameter is

   by-parameter = &quot;BY=&quot;by-value
   by-value     = by-time&quot;;&quot;by-mode[by-trace]
   by-time      = [&quot;-&quot; / &quot;+&quot;]1*9digit ; a negative or zero value is not
                                      ; allowed with a by-mode of &quot;R&quot;
   by-mode      = &quot;N&quot; / &quot;R&quot;           ; &quot;Notify&quot; or &quot;Return&quot;
   by-trace     = &quot;T&quot;                 ; &quot;Trace&quot;

   Note that the BY esmtp-keyword MUST have an associated esmtp-value.
   The by-time is a decimal representation of the number of seconds
   within which the message should be delivered and has the range

     -999,999,999 seconds &lt;= by-time &lt;= +999,999,999 seconds

   and is thus sufficient to represent a time anywhere from
   approximately 31.6 years in the past to 31.6 years in the future.

   As described in <a href="#section-4.1">Section 4.1</a>, the by-mode indicates the action the
   SMTP server must take should it not be possible to transmit the
   message within by-time seconds.

   Note that by-time is a delta time: the number of seconds within which
   to deliver the message.  This delta time does not extend an MTA&#x27;s
   normal retention period for undeliverable messages nor is it a
   &quot;deliver after&quot; time.

   A delta time is used so as to prevent problems associated with
   differences in system clocks between clients and servers.  Servers in
   receipt of a valid by-parameter are expected to convert the by-time
   into a locale-specific absolute time called the deliver-by-time.



<span class="grey">Newman                      Standards Track                     [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


   This is done by adding the by-time upon receipt to the current
   locale-specific time and thereby arriving at a locale-specific
   absolute time which is by-time seconds in the future or past,
   depending upon the arithmetic sign of by-time.  The message is then
   to be delivered by the deliver-by-time.  The sending client and
   receiving server should assume the transmission time of the MAIL FROM
   command to be instantaneous.  Clearly, it will not be and network
   latency will introduce an error, the nature of which will be to
   extend slightly the effective by-time. The more hops the message
   takes, the more pronounced the effect will be owing to the cumulative
   nature of this latency-induced error.

   In the case of a by-mode of &quot;N&quot;, it is possible that by-time may be
   zero or negative.  This is not an error and should not be rejected as
   such.  It indicates a message for which the deliver-by-time occurred
   -(by-time) seconds in the past.  [Here, &quot;-(by-time)&quot; represents the
   arithmetic negation of the by-time value.]  Zero and negative values
   are allowed so as to preserve information about any requested
   delivery time information -- information which the delivering MTA may
   wish to include with the delivered message for the benefit of the
   recipient or to show in a DSN or NDN (non delivery notification).

   In the case of a by-mode of &quot;R&quot;, a zero or negative by-time is a
   syntax error. In such a case, the SMTP server SHOULD return a
   permanent failure (501) SMTP reply code in response to the extended
   MAIL FROM command.  If the SMTP server also supports enhanced error
   codes [<a href="#ref-8" title="&quot;SMTP Service Extension for Returning Enhanced Error Codes&quot;">8</a>], then an enhanced error code of 5.5.4 SHOULD also be
   returned.

   If the by-time is a valid by-time specification but the SMTP server
   cannot honor or accept it for a server-specific reason, then SMTP
   server SHOULD respond with either a 455 SMTP response if the
   condition is transient or a 555 SMTP response if the condition is
   permanent. In addition, if the SMTP server also supports [<a href="#ref-8" title="&quot;SMTP Service Extension for Returning Enhanced Error Codes&quot;">8</a>], a
   suitable 4.X.X or 5.X.X enhanced error code SHOULD also be returned.

<span class="h3"><a class="selflink" id="section-4.1" href="#section-4.1">4.1</a>.  Server behavior upon receipt of the extended MAIL FROM command</span>

   Upon receipt of an extended MAIL FROM command containing a valid BY
   parameter, a SMTP server and associated MTA must handle the message
   in accord with the following subsections, Sections <a href="#section-4.1.1">4.1.1</a>-<a href="#section-4.1.5">4.1.5</a>.
   Delivery status notifications generated in response to processing a
   message with a Deliver By request should include both the optional
   Arrival-Date DSN field as well as the new Deliver-By-Date DSN field
   described in <a href="#section-5">Section 5</a> of this memo.






<span class="grey">Newman                      Standards Track                     [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


   A by-time Note that a message&#x27;s by-time does not extend the MTA&#x27;s
   normal message retention period: an MTA MAY return a message as
   undeliverable before the deliver-by-time has been reached.

<span class="h4"><a class="selflink" id="section-4.1.1" href="#section-4.1.1">4.1.1</a>.  Successful delivery</span>

   If the message is delivered before deliver-by-time, no special action
   need be taken.  If the SMTP server or MTA also supports the Delivery
   Status Notification SMTP service extension [<a href="#ref-5" title="&quot;SMTP Service Extension for Delivery Status Notifications&quot;">5</a>] and a NOTIFY parameter
   including &quot;SUCCESS&quot; was specified, a &quot;delivered&quot; DSN with appropriate
   status must be returned as per [<a href="#ref-5" title="&quot;SMTP Service Extension for Delivery Status Notifications&quot;">5</a>].

<span class="h4"><a class="selflink" id="section-4.1.2" href="#section-4.1.2">4.1.2</a>.  Unsuccessful delivery; deliver-by-time not yet reached</span>

   If deliver-by-time has not yet passed and the message has proved
   undeliverable for temporary reasons, then the SMTP server or MTA
   should continue delivery or relay attempts as per the site&#x27;s message
   handling policy.  If the MTA&#x27;s message retention period is less than
   by-time, the MTA MAY return the message as undeliverable before
   deliver-by-time has been reached.  However, the message MUST still be
   handled in accord with Sections <a href="#section-4.1.1">4.1.1</a>-<a href="#section-4.1.5">4.1.5</a>.

   If deliver-by-time has not yet passed and the message cannot be
   delivered for permanent reasons, then the SMTP server or MTA MUST
   return a &quot;failed&quot; DSN with an appropriate status for each recipient
   address with either no NOTIFY parameter specified or for which the
   NOTIFY parameter includes &quot;FAILURE&quot;.

<span class="h4"><a class="selflink" id="section-4.1.3" href="#section-4.1.3">4.1.3</a>.  Time has expired; deliver-by-time reached or passed</span>

   If the message is not delivered or relayed before deliver-by-time and
   a by-mode of &quot;R&quot; was specified, no further delivery attempts may be
   made for the message.  The server or MTA MUST issue a &quot;failed&quot; DSN
   with status 5.4.7, &quot;delivery time expired&quot;, for each recipient
   address with either no NOTIFY parameter specified or for which the
   NOTIFY parameter includes &quot;FAILURE&quot;.

   If the message is not delivered or relayed before deliver-by-time and
   a by-mode of &quot;N&quot; was specified, the server or MTA should continue
   attempts to deliver or relay the message using the site&#x27;s message
   handling policy.  In addition, the server or MTA MUST issue a
   &quot;delayed&quot; DSN with status 4.4.7, &quot;delivery time expired&quot;, for each
   recipient address with either no NOTIFY parameter specified or for
   which the NOTIFY parameter includes &quot;DELAY&quot;.







<span class="grey">Newman                      Standards Track                     [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


<span class="h4"><a class="selflink" id="section-4.1.4" href="#section-4.1.4">4.1.4</a>.  Relaying to another SMTP server</span>

   Sections <a href="#section-4.1.4.1">4.1.4.1</a> and <a href="#section-4.1.4.2">4.1.4.2</a> below describe when a message with a
   Deliver By request may be relayed to another SMTP server and what
   additional actions, if any, should or must be taken.  In addition to
   that discussed in those sections, the following must also be observed
   when relaying is permitted.

   If the message is relayed to a SMTP server that supports the Deliver
   By extension, a new BY parameter MUST be relayed specifying a by-time
   value indicating the number of seconds remaining until deliver-by-
   time.  The new by-time value should be computed as close to the time
   the MAIL FROM command is transmitted by the relaying SMTP client as
   is reasonably possible. Note that if deliver-by-time has passed, the
   relayed by-time will be a negative value indicating how may seconds
   has elapsed since delivery-by-time.  Such a case -- relay of a
   message for which deliver-by-time has just arrived or passed -- may
   only happen with a message that has a by-mode of &quot;N&quot;.

   When a message with a by-trace field with value &quot;T&quot; is relayed, a
   &quot;relayed&quot; DSN SHOULD be generated by the relaying SMTP client for
   each recipient which either did not specify a NOTIFY parameter or the
   NOTIFY parameter does not have the value &quot;NEVER&quot;.

   Note that these &quot;relayed&quot; DSNs are generated regardless of whether
   success notifications were explicitly requested with a NOTIFY=SUCCESS
   parameter.  Note further that the &quot;relayed&quot; DSNs discussed here are
   not terminal notifications:  downstream SMTP servers and MTAs may
   still support [<a href="#ref-5" title="&quot;SMTP Service Extension for Delivery Status Notifications&quot;">5</a>] and as such additional notifications may still
   result.

<span class="h5"><a class="selflink" id="section-4.1.4.1" href="#section-4.1.4.1">4.1.4.1</a>.  Relaying a message with a by-mode of &quot;R&quot;</span>

   A message for which a by-mode of &quot;R&quot; was specified MUST NOT be
   relayed to a SMTP server which does not support the Deliver By SMTP
   service extension.  Moreover, the server to which it is relayed MUST
   NOT have a fixed minimum by-time which is greater than the time
   remaining in which the message is to be delivered.  The fixed minimum
   by-time is expressed by the optional deliverby-param discussed in
   <a href="#section-2">Section 2</a>.

   If the message requires relaying in order to be delivered yet cannot
   be relayed, then the message is deemed to be undeliverable for
   permanent reasons and <a href="#section-4.1.2">Section 4.1.2</a> should be applied.







<span class="grey">Newman                      Standards Track                     [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


<span class="h5"><a class="selflink" id="section-4.1.4.2" href="#section-4.1.4.2">4.1.4.2</a>.  Relaying a message with a by-mode of &quot;N&quot;</span>

   A message with a by-mode of &quot;N&quot; may be relayed to another server
   regardless of whether or not the SMTP server to which it is relayed
   supports the Deliver By extension.

   If the message is relayed before deliver-by-time to a SMTP server
   that does not support the Deliver By extension, then the relaying
   SMTP client MUST issue a &quot;relayed&quot; DSN for each recipient which
   either did not specify a NOTIFY parameter or the NOTIFY parameter
   does not have the value &quot;NEVER&quot;. Further, if the SMTP server being
   relayed to supports the Delivery Status Notification SMTP service
   extension [<a href="#ref-5" title="&quot;SMTP Service Extension for Delivery Status Notifications&quot;">5</a>] then for each recipient: if no NOTIFY parameter was
   supplied, &quot;NOTIFY=FAILURE,DELAY&quot; SHOULD be requested; if a NOTIFY
   parameter was specified and does not have the value &quot;NEVER&quot;, &quot;DELAY&quot;
   SHOULD be added to the list of notify-list-element values if not
   already present.  Note that this explicitly overrides the &quot;MUST NOT&quot;
   wording of <a href="#section-6.2.1">Section 6.2.1</a>(c) of [<a href="#ref-5" title="&quot;SMTP Service Extension for Delivery Status Notifications&quot;">5</a>].

<span class="h4"><a class="selflink" id="section-4.1.5" href="#section-4.1.5">4.1.5</a>.  Relaying to a foreign mail system</span>

   If the foreign mail system supports semantics similar to the Deliver
   By SMTP service extension described in this memo, then convey the
   Deliver By request to that system.  Otherwise, relay the message as
   if relaying to a SMTP server which does not support the Deliver By
   extension.

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  Delivery status notifications and extension</span>

   The format of delivery status notifications (DSNs) is specified in
   [<a href="#ref-6" title="&quot;An Extensible Message Format for Delivery Status Notifications&quot;">6</a>].  DSNs generated in response to a Deliver By request should
   include an Arrival-Date DSN field.  This memo also extends the per-
   message-fields of [<a href="#ref-6" title="&quot;An Extensible Message Format for Delivery Status Notifications&quot;">6</a>] to include a new DSN field, Deliver-By-Date,
   indicating the deliver-by-time as computed by the MTA or SMTP server
   generating the DSN.  In the augmented BNF of <a href="/doc/html/rfc822">RFC 822</a> [<a href="#ref-2" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">2</a>], per-
   message-fields is therefore extended as follows:

     per-message-fields =
         [ original-envelope-id-field CRLF ]
         reporting-mta-field CRLF
         [ dsn-gateway-field CRLF ]
         [ received-from-mta-field CRLF ]
         [ arrival-date-field CRLF ]
         [ deliver-by-date-field CRLF ]
         *( extension-field CRLF )
     deliver-by-date-field = &quot;Deliver-by-date&quot; &quot;:&quot; date-time





<span class="grey">Newman                      Standards Track                     [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


   where date-time is a <a href="/doc/html/rfc822">RFC 822</a> [<a href="#ref-2" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">2</a>] date-time field as ammended by <a href="/doc/html/rfc1123">RFC</a>
   <a href="/doc/html/rfc1123">1123</a> [<a href="#ref-3" title="&quot;Requirements for Internet Hosts -- Application and Support&quot;">3</a>].

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Examples</span>

   In the following sample SMTP dialog, the SMTP client requests that a
   message from &lt;eljefe@bigbiz.com&gt; be delivered to
   &lt;topbanana@other.com&gt; within 2 minutes (120 seconds) and returned
   otherwise.  This request takes the form of a BY parameter on the MAIL
   FROM line of &quot;BY=120;R&quot; as shown below:

     S: 220 acme.net SMTP server here
     C: EHLO bigbiz.com
     S: 250-acme.net
     S: 250 DELIVERBY
     C: MAIL FROM:&lt;eljefe@bigbiz.com&gt; BY=120;R
     S: 250 &lt;eljefe@bigbiz.com&gt; sender ok
     C: RCPT TO:&lt;topbanana@other.com&gt;
     S: 250 &lt;topbanana@wherever.com&gt; recipient ok

   Suppose now that the receiving SMTP server in the above example needs
   to relay the message to another SMTP server, mail.other.com.  Owing
   to the original by-mode of &quot;R&quot;, the message may only be relayed to
   another SMTP server which supports the Deliver By extension (<a href="#section-4.1.4">Section</a>
   <a href="#section-4.1.4">4.1.4</a>).  Further, when relaying the message, the Deliver By request
   must be relayed.  With this in mind, consider the following SMTP
   dialog:

     S: 220 mail.other.com ESMTP server at your service
     C: EHLO acme.net
     S: 250-mail.other.com
     S: 250 DELIVERBY 240
     C: QUIT

   In the above dialog, the relaying SMTP server, acme.net, connects to
   mail.other.com and issues an EHLO command.  It then learns that the
   Deliver By extension is supported but that the minimum by-time for a
   by-mode of &quot;R&quot; is 4 minutes (240 seconds).  This value exceeds the
   message&#x27;s original by-time and therefore necessarily exceeds the
   remaining by-time.  The relaying SMTP server thus ends the SMTP
   session after which it must either attempt to follow any other MX
   records or, if there are no more MX records to follow, must return
   the message as undeliverable.  Similar behavior would result if the
   EHLO command was met with an error or did not include the DELIVERBY
   keyword.

   Consider instead, the relaying SMTP session:




<span class="grey">Newman                      Standards Track                     [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


     S: 220 mail.other.com ESMTP server at your service
     C: EHLO acme.net
     S: 250-mail.other.com
     S: 250 DELIVERBY 30
     C: MAIL FROM:&lt;eljefe@bigbiz.com&gt; BY=98;R
     S: 250 &lt;eljefe@bigbiz.com&gt; Sender okay
     C: RCPT TO:&lt;topbanana@other.com&gt;
     S: 250 &lt;topbanana@wherever.com&gt; Recipient okay

   In the above, the relaying SMTP client relays the BY parameter with
   the by-mode preserved and the by-time computed to be the remaining
   number of seconds at the approximate time that the MAIL FROM command
   was transmitted from the relaying SMTP client (acme.net) to the
   receiving SMTP server (mail.other.com).  In this example, 22 seconds
   have elapsed since acme.net received the MAIL FROM line from the
   original sending client and relayed the Deliver By request to
   mail.other.com.

<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  MX based relaying considerations</span>

   Sites which wish to use the Deliver By SMTP service extension and
   which direct their mail via MX records [<a href="#ref-9" title="&quot;Mail Routing and the Domain System&quot;">9</a>] need to ensure that all of
   their MX hosts -- hosts to which their mail is directed by MX records
   -- support the Deliver By extension. SMTP clients which support
   Deliver By SHOULD NOT attempt multiple MX hosts looking for one which
   supports Deliver By.

   MX hosts should pay careful attention to the min-by-time value they
   present in response to EHLO commands.  It is not practical for an MX
   host to present a value which either (1) is substantially different
   from that which can be handled by the destination host to which it
   relays, or (2) doesn&#x27;t recognize normal delivery latencies introduced
   when the MX host relays mail to the destination host.

<span class="h2"><a class="selflink" id="section-8" href="#section-8">8</a>.  Security Considerations</span>

   Implemention of Deliver By allows tracing of a mail transport system.
   The by-trace field &quot;T&quot; explicitly requests that a trace be generated.
   Moreover, even when the by-trace field is not used, a crude trace may
   be generated by entering a series of messages into the transport
   system, each with successively increasing by-time values; e.g.,
   &quot;BY=0;R&quot;, &quot;BY=1;R&quot;, &quot;BY=2;R&quot;. Probing, and in some cases tracing, can
   be accomplished through other means: querying the visible SMTP
   servers, investigating Received: header lines in bounced messages,
   and using utilities such as &quot;traceroute&quot;.






<span class="grey">Newman                      Standards Track                    [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


<span class="h2"><a class="selflink" id="section-9" href="#section-9">9</a>.  Other Considerations</span>

   SMTP servers which support the Deliver By SMTP service extension as
   well as their associated MTAs are not required to assign any special
   processing priority to messages with Deliver By requests.  Of course,
   some SMTP servers and MTAs may do so if they desire.  Moreover,
   delivery status notifications generated in response to messages with
   Deliver By requests are not required to receive any special
   processing.  Consequently, users of this service should not, in
   general, expect expedited processing of their messages.  Moreover,
   just because a message is sent with a &quot;BY=60;R&quot; parameter does not
   guarantee that the sender will learn of a delivery failure within any
   specified time period as the DSN will not necessarily be expedited
   back to sender.

<span class="h2"><a class="selflink" id="section-10" href="#section-10">10</a>.  Acknowledgments</span>

   The author wishes to thank Keith Moore for providing much of the
   initial impetus for this document as well as the basic ideas embodied
   within it.  Further thanks are due to Ned Freed and Chris Newman for
   their reviews of this document and suggestions for improvement.






























<span class="grey">Newman                      Standards Track                    [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


<span class="h2"><a class="selflink" id="section-11" href="#section-11">11</a>.  References</span>

   [<a id="ref-1">1</a>]  Postel, J., &quot;Simple Mail Transfer Protocol&quot;, STD 10, <a href="/doc/html/rfc821">RFC 821</a>,
        August 1982.

   [<a id="ref-2">2</a>]  Crocker, D., Editor, and P. Overell, &quot;Augmented BNF for Syntax
        Specifications: ABNF&quot;, <a href="/doc/html/rfc2234">RFC 2234</a>, November 1997.

   [<a id="ref-3">3</a>]  Braden, R., Editor, &quot;Requirements for Internet Hosts --
        Application and Support&quot;, STD 3, <a href="/doc/html/rfc1123">RFC 1123</a>, October 1989.

   [<a id="ref-4">4</a>]  Rose, M., Stefferud, E., Crocker, D., Klensin, J. and N. Freed,
        &quot;SMTP Service Extensions&quot;, STD 10, <a href="/doc/html/rfc1869">RFC 1869</a>, November 1995.

   [<a id="ref-5">5</a>]  Moore, K., &quot;SMTP Service Extension for Delivery Status
        Notifications&quot;, <a href="/doc/html/rfc1891">RFC 1891</a>, January 1996.

   [<a id="ref-6">6</a>]  Moore, K. and G. Vaudreuil, &quot;An Extensible Message Format for
        Delivery Status Notifications&quot;, <a href="/doc/html/rfc1894">RFC 1894</a>, January 1996.

   [<a id="ref-7">7</a>]  Bradner, S., &quot;Key words for use in RFCs to Indicate Requirement
        Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-8">8</a>]  Freed, N., &quot;SMTP Service Extension for Returning Enhanced Error
        Codes&quot;, <a href="/doc/html/rfc2034">RFC 2034</a>, October 1996.

   [<a id="ref-9">9</a>]  Partridge, C., &quot;Mail Routing and the Domain System&quot;, STD 14, <a href="/doc/html/rfc974">RFC</a>
        <a href="/doc/html/rfc974">974</a>, January 1986.

<span class="h2"><a class="selflink" id="section-12" href="#section-12">12</a>.  Author&#x27;s Address</span>

   Dan Newman
   Sun Microsystems, Inc.
   1050 Lakes Drive, Suite 250
   West Covina, CA  91790
   USA

   Phone: +1 626 919 3600
   Fax:   +1 626 919 3614
   EMail:  dan.newman@sun.com











<span class="grey">Newman                      Standards Track                    [Page 12]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-13" ></span>
<span class="grey"><a href="/doc/html/rfc2852">RFC 2852</a>           Deliver By SMTP Service Extension           June 2000</span>


<span class="h2"><a class="selflink" id="section-13" href="#section-13">13</a>.  Full Copyright Statement</span>

   Copyright (C) The Internet Society (2000).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   &quot;AS IS&quot; basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Newman                      Standards Track                    [Page 13]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

