<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc8326
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-grow-bgp-gshut/">
  <meta name="description" content="Graceful BGP Session Shutdown (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc8326.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc8326.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc8326.txt.pdf" title="PDF version of this document">pdf</a>|<a href="https://www.rfc-editor.org/rfc/inline-errata/rfc8326.html">with errata</a>|<a href="/doc/rfc8326/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc8326/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/grow/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-grow-bgp-gshut@ietf.org?subject=draft-ietf-grow-bgp-gshut" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-grow-bgp-gshut-13.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-grow-bgp-gshut-13.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-grow-bgp-gshut-13.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-ietf-grow-bgp-gshut-13">draft-ietf-grow-bgp-gshut-13</a>                     Proposed Standard
                                                            <a class="text-warning" href="https://www.rfc-editor.org/errata_search.php?rfc=8326&amp;rec_status=0">Errata exist</a></pre>
      </div>
    

    <div class="draftcontent">
    <pre>Internet Engineering Task Force (IETF)                  P. Francois, Ed.
Request for Comments: 8326                        Individual Contributor
Category: Standards Track                               B. Decraene, Ed.
ISSN: 2070-1721                                                   Orange
                                                              C. Pelsser
                                                   Strasbourg University
                                                                K. Patel
                                                            Arrcus, Inc.
                                                             C. Filsfils
                                                           Cisco Systems
                                                              March 2018


                     <span class="h1">Graceful BGP Session Shutdown</span>

Abstract

   This document standardizes a new well-known BGP community,
   GRACEFUL_SHUTDOWN, to signal the graceful shutdown of paths.  This
   document also describes operational procedures that use this
   well-known community to reduce the amount of traffic lost when BGP
   peering sessions are about to be shut down deliberately, e.g., for
   planned maintenance.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="/doc/html/rfc7841#section-2">Section&nbsp;2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8326">https://www.rfc-editor.org/info/rfc8326</a>.














<span class="grey">Francois, et al.             Standards Track                    [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


Copyright Notice

   Copyright (c) 2018 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust&#x27;s Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Packet Loss upon Manual EBGP Session Shutdown . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Procedure for EBGP Graceful Shutdown  . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-4.1">4.1</a>.  Pre-configuration . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-4.2">4.2</a>.  Operations at Maintenance Time  . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-4.3">4.3</a>.  BGP Implementation Support for Graceful Shutdown  . . . .   <a href="#page-6">6</a>
   <a href="#section-5">5</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-6">6</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-7">7</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-7.1">7.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-7.2">7.2</a>.  Informative References  . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#appendix-A">Appendix A</a>.  Alternative Techniques with Limited Applicability  .   8
     <a href="#appendix-A.1">A.1</a>.  Multi-Exit Discriminator Tweaking . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#appendix-A.2">A.2</a>.  IGP Distance Poisoning  . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#appendix-B">Appendix B</a>.  Configuration Examples . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#appendix-B.1">B.1</a>.  Cisco IOS XR  . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#appendix-B.2">B.2</a>.  BIRD  . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#appendix-B.3">B.3</a>.  OpenBGPD  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#appendix-C">Appendix C</a>.  Beyond EBGP Graceful Shutdown  . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#appendix-C.1">C.1</a>.  IBGP Graceful Shutdown  . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#appendix-C.2">C.2</a>.  EBGP Session Establishment  . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   Authors&#x27; Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>










<span class="grey">Francois, et al.             Standards Track                    [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction</span>

   Routing changes in BGP can be caused by planned maintenance
   operations.  This document defines a well-known community [<a href="/doc/html/rfc1997" title="&quot;BGP Communities Attribute&quot;">RFC1997</a>],
   called GRACEFUL_SHUTDOWN, for the purpose of reducing the management
   overhead of gracefully shutting down BGP sessions.  The well-known
   community allows implementers to provide an automated graceful
   shutdown mechanism that does not require any router reconfiguration
   at maintenance time.

   This document discusses operational procedures to be applied in order
   to reduce or eliminate loss of packets during a maintenance
   operation.  Loss comes from transient lack of reachability during BGP
   convergence that follows the shutdown of an EBGP peering session
   between two Autonomous System Border Routers (ASBRs).

   This document presents procedures for the cases where the forwarding
   plane is impacted by the maintenance, hence for when the use of
   Graceful Restart does not apply.

   The procedures described in this document can be applied to reduce or
   avoid packet loss for outbound and inbound traffic flows initially
   forwarded along the peering link to be shut down.  In both Autonomous
   Systems (ASes), these procedures trigger rerouting to alternate paths
   if they exist within the AS while allowing the use of the old path
   until alternate ones are learned.  This ensures that routers always
   have a valid route available during the convergence process.

   The goal of the document is to meet the requirements described in
   [<a href="/doc/html/rfc6198" title="&quot;Requirements for the Graceful Shutdown of BGP Sessions&quot;">RFC6198</a>] as best possible without changing BGP.

   Other maintenance cases, such as the shutdown of an IBGP session or
   the establishment of an EBGP session, are out of scope for this
   document.  For informational purposes, they are briefly discussed in
   <a href="#appendix-C">Appendix C</a>.

   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and
   &quot;OPTIONAL&quot; in this document are to be interpreted as described in
   <a href="/doc/html/bcp14">BCP 14</a> [<a href="/doc/html/rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>] [<a href="/doc/html/rfc8174" title="&quot;Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words&quot;">RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.










<span class="grey">Francois, et al.             Standards Track                    [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Terminology</span>

   graceful shutdown initiator
      A router on which the session shutdown is performed for the
      maintenance.

   graceful shutdown receiver
      A router that has a BGP session to be shut down with the graceful
      shutdown initiator.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Packet Loss upon Manual EBGP Session Shutdown</span>

   Packets can be lost during the BGP convergence following a manual
   shut down of an EBGP session for two reasons.

   First, some routers can have no path toward an affected prefix and
   drop traffic destined to this prefix.  This is because alternate
   paths can be hidden by nodes of an AS.  This happens when the
   extension defined in [<a href="/doc/html/rfc7911" title="&quot;Advertisement of Multiple Paths in BGP&quot;">RFC7911</a>] is not used and a) the paths are not
   selected as best by the ASBRs that receive them on an EBGP session or
   b) Route Reflectors do not propagate the paths further in the IBGP
   topology because they do not select them as best.

   Second, the FIB can be inconsistent between routers within the AS,
   and packets toward affected prefixes can loop and be dropped unless
   encapsulation is used within the AS.

   This document only addresses the first reason.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  Procedure for EBGP Graceful Shutdown</span>

   This section describes configurations and actions to be performed for
   the graceful shutdown of EBGP peering links.

   The goal of this procedure is to retain the paths to be shut down
   between the peers, but with a lower LOCAL_PREF value, allowing the
   paths to remain in use while alternate paths are selected and
   propagated, rather than simply withdrawing the paths.  The LOCAL_PREF
   value SHOULD be lower than any of the alternative paths.  The
   RECOMMENDED value is 0.

   Note that some alternative techniques with limited applicability are
   discussed in <a href="#appendix-A">Appendix A</a> for informational purposes.








<span class="grey">Francois, et al.             Standards Track                    [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


<span class="h3"><a class="selflink" id="section-4.1" href="#section-4.1">4.1</a>.  Pre-configuration</span>

   On each ASBR supporting the graceful shutdown receiver procedure, an
   inbound BGP route policy is applied on all EBGP sessions of the ASBR.
   That policy:

   o  matches the GRACEFUL_SHUTDOWN community.

   o  sets the LOCAL_PREF attribute of the paths tagged with the
      GRACEFUL_SHUTDOWN community to a low value.

   For informational purposes, examples of configurations are provided
   in <a href="#appendix-B">Appendix B</a>.

<span class="h3"><a class="selflink" id="section-4.2" href="#section-4.2">4.2</a>.  Operations at Maintenance Time</span>

   On the graceful shutdown initiator, at maintenance time, the
   operator:

   o  applies an outbound BGP route policy on the EBGP session to be
      shutdown.  This policy tags the paths propagated over the session
      with the GRACEFUL_SHUTDOWN community.  This will trigger the BGP
      implementation to re-advertise all active routes previously
      advertised and tag them with the GRACEFUL_SHUTDOWN community.

   o  applies an inbound BGP route policy on the EBGP session to be
      shutdown.  This policy tags the paths received over the session
      with the GRACEFUL_SHUTDOWN community and sets LOCAL_PREF to a low
      value.

   o  waits for route re-advertisement over the EBGP session and for BGP
      routing convergence on both ASBRs.

   o  shuts down the EBGP session, optionally using [<a href="/doc/html/rfc8203" title="&quot;BGP Administrative Shutdown Communication&quot;">RFC8203</a>] to
      communicate the reason for the shutdown.

   In the case of a shutdown of the whole router, in addition to the
   graceful shutdown of all EBGP sessions, there is a need to gracefully
   shut down the routes originated by this router (e.g., BGP aggregates
   redistributed from other protocols, including static routes).  This
   can be performed by tagging these routes with the GRACEFUL_SHUTDOWN
   community and setting LOCAL_PREF to a low value.









<span class="grey">Francois, et al.             Standards Track                    [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


<span class="h3"><a class="selflink" id="section-4.3" href="#section-4.3">4.3</a>.  BGP Implementation Support for Graceful Shutdown</span>

   BGP Implementers SHOULD provide configuration knobs that utilize the
   GRACEFUL_SHUTDOWN community to inform BGP neighbors in preparation
   for an impending neighbor shutdown.  Implementation details are
   outside the scope of this document.

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  IANA Considerations</span>

   IANA previously assigned the community value 0xFFFF0000 to the
   &#x27;planned-shut&#x27; community in the &quot;BGP Well-known Communities&quot;
   registry.  IANA has changed the name &#x27;planned-shut&#x27; to
   &#x27;GRACEFUL_SHUTDOWN&#x27; and updated the reference to point to this
   document.

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Security Considerations</span>

   By providing the graceful shutdown service to a neighboring AS, an
   ISP provides means to this neighbor, and possibly its downstream
   ASes, to lower the LOCAL_PREF value assigned to the paths received
   from this neighbor.

   The neighbor could abuse the technique and do inbound traffic
   engineering by declaring that some prefixes are undergoing
   maintenance so as to switch traffic to another peering link.

   If this behavior is not tolerated by the ISP, it SHOULD monitor the
   use of the graceful shutdown community.

<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  References</span>

<span class="h3"><a class="selflink" id="section-7.1" href="#section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-RFC1997">RFC1997</a>]  Chandra, R., Traina, P., and T. Li, &quot;BGP Communities
              Attribute&quot;, <a href="/doc/html/rfc1997">RFC 1997</a>, DOI 10.17487/RFC1997, August 1996,
              &lt;<a href="https://www.rfc-editor.org/info/rfc1997">https://www.rfc-editor.org/info/rfc1997</a>&gt;.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., &quot;Key words for use in RFCs to Indicate
              Requirement Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC6198">RFC6198</a>]  Decraene, B., Francois, P., Pelsser, C., Ahmad, Z.,
              Elizondo Armengol, A., and T. Takeda, &quot;Requirements for
              the Graceful Shutdown of BGP Sessions&quot;, <a href="/doc/html/rfc6198">RFC 6198</a>,
              DOI 10.17487/RFC6198, April 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6198">https://www.rfc-editor.org/info/rfc6198</a>&gt;.




<span class="grey">Francois, et al.             Standards Track                    [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., &quot;Ambiguity of Uppercase vs Lowercase in <a href="/doc/html/rfc2119">RFC</a>
              <a href="/doc/html/rfc2119">2119</a> Key Words&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

<span class="h3"><a class="selflink" id="section-7.2" href="#section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-BEST-EXTERNAL">BEST-EXTERNAL</a>]
              Marques, P., Fernando, R., Chen, E., Mohapatra, P., and H.
              Gredler, &quot;Advertisement of the best external route in
              BGP&quot;, Work in Progress, <a href="/doc/html/draft-ietf-idr-best-external-05">draft-ietf-idr-best-external-05</a>,
              January 2012.

   [<a id="ref-RFC7911">RFC7911</a>]  Walton, D., Retana, A., Chen, E., and J. Scudder,
              &quot;Advertisement of Multiple Paths in BGP&quot;, <a href="/doc/html/rfc7911">RFC 7911</a>,
              DOI 10.17487/RFC7911, July 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7911">https://www.rfc-editor.org/info/rfc7911</a>&gt;.

   [<a id="ref-RFC8203">RFC8203</a>]  Snijders, J., Heitz, J., and J. Scudder, &quot;BGP
              Administrative Shutdown Communication&quot;, <a href="/doc/html/rfc8203">RFC 8203</a>,
              DOI 10.17487/RFC8203, July 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8203">https://www.rfc-editor.org/info/rfc8203</a>&gt;.






























<span class="grey">Francois, et al.             Standards Track                    [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


<span class="h2"><a class="selflink" id="appendix-A" href="#appendix-A">Appendix A</a>.  Alternative Techniques with Limited Applicability</span>

   A few alternative techniques have been considered to provide graceful
   shutdown capabilities but have been rejected due to their limited
   applicability.  This section describes these techniques for possible
   reference.

<span class="h3"><a class="selflink" id="appendix-A.1" href="#appendix-A.1">A.1</a>.  Multi-Exit Discriminator Tweaking</span>

   The Multi-Exit Discriminator (MED) attribute of the paths to be
   avoided can be increased to influence the routers in the neighboring
   AS to select other paths.

   The solution only works if the alternate paths are as good as the
   initial ones with respect to the LOCAL_PREF value and the AS Path
   Length value.  In the other cases, increasing the MED value will not
   have an impact on the decision process of the routers in the
   neighboring AS.

<span class="h3"><a class="selflink" id="appendix-A.2" href="#appendix-A.2">A.2</a>.  IGP Distance Poisoning</span>

   The distance to the BGP NEXT_HOP corresponding to the maintained
   session can be increased in the IGP so that the old paths will be
   less preferred during the application of the IGP distance tie-break
   rule.  However, this solution only works for the paths whose
   alternates are as good as the old paths with respect to their
   LOCAL_PREF value, their AS Path length, and their MED value.

   Also, this poisoning cannot be applied when BGP &quot;NEXT_HOP self&quot; is
   used, as there is no BGP NEXT_HOP specific to the maintained session
   to poison in the IGP.

<span class="h2"><a class="selflink" id="appendix-B" href="#appendix-B">Appendix B</a>.  Configuration Examples</span>

   This appendix is non-normative.

   This appendix includes examples of routing policy configurations to
   honor the GRACEFUL_SHUTDOWN well-known BGP community.













<span class="grey">Francois, et al.             Standards Track                    [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


<span class="h3"><a class="selflink" id="appendix-B.1" href="#appendix-B.1">B.1</a>.  Cisco IOS XR</span>

   community-set comm-graceful-shutdown
     65535:0
   end-set
   !
   route-policy AS64497-ebgp-inbound
     ! normally this policy would contain much more
     if community matches-any comm-graceful-shutdown then
       set local-preference 0
     endif
   end-policy
   !
   router bgp 64496
    neighbor 2001:db8:1:2::1
     remote-as 64497
     address-family ipv6 unicast
      send-community-ebgp
      route-policy AS64497-ebgp-inbound in

     !
    !
   !

<span class="h3"><a class="selflink" id="appendix-B.2" href="#appendix-B.2">B.2</a>.  BIRD</span>

   function honor_graceful_shutdown() {
       if (65535, 0) ~ bgp_community then {
           bgp_local_pref = 0;
       }
   }
   filter AS64497_ebgp_inbound
   {
           # normally this policy would contain much more
           honor_graceful_shutdown();
   }
   protocol bgp peer_64497_1 {
       neighbor 2001:db8:1:2::1 as 64497;
       local as 64496;
       import keep filtered;
       import filter AS64497_ebgp_inbound;
   }









<span class="grey">Francois, et al.             Standards Track                    [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


<span class="h3"><a class="selflink" id="appendix-B.3" href="#appendix-B.3">B.3</a>.  OpenBGPD</span>

   AS 64496
   router-id 192.0.2.1
   neighbor 2001:db8:1:2::1 {
           remote-as 64497
   }
   # normally this policy would contain much more
   match from any community GRACEFUL_SHUTDOWN set { localpref 0 }

<span class="h2"><a class="selflink" id="appendix-C" href="#appendix-C">Appendix C</a>.  Beyond EBGP Graceful Shutdown</span>

<span class="h3"><a class="selflink" id="appendix-C.1" href="#appendix-C.1">C.1</a>.  IBGP Graceful Shutdown</span>

   For the shutdown of an IBGP session, provided the IBGP topology is
   viable after the maintenance of the session (i.e., if all BGP
   speakers of the AS have an IBGP signaling path for all prefixes
   advertised on this graceful shutdown IBGP session), then the shutdown
   of an IBGP session does not lead to transient unreachability.  As a
   consequence, no specific graceful shutdown action is required.

<span class="h3"><a class="selflink" id="appendix-C.2" href="#appendix-C.2">C.2</a>.  EBGP Session Establishment</span>

   We identify two potential causes for transient packet losses upon the
   establishment of an EBGP session.  The first one is local to the
   startup initiator; the second one is due to the BGP convergence
   following the injection of new best paths within the IBGP topology.

<span class="h4"><a class="selflink" id="appendix-C.2.1" href="#appendix-C.2.1">C.2.1</a>.  Unreachability Local to the ASBR</span>

   An ASBR that selects a path received over a newly established EBGP
   session as the best path may transiently drop traffic.  This can
   typically happen when the NEXT_HOP attribute differs from the IP
   address of the EBGP peer and the receiving ASBR has not yet resolved
   the MAC address associated with the IP address of that third-party
   NEXT_HOP.

   A BGP speaker implementation MAY avoid such losses by ensuring that
   third-party NEXT_HOPs are resolved before installing paths using
   these NEXT_HOPs in the RIB.

   Alternatively, the operator (script) MAY ping third-party NEXT_HOPs
   that are expected to be used prior to establishing the session.  By
   proceeding like this, the MAC addresses associated with these third-
   party NEXT_HOPs are resolved by the startup initiator.






<span class="grey">Francois, et al.             Standards Track                   [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


<span class="h4"><a class="selflink" id="appendix-C.2.2" href="#appendix-C.2.2">C.2.2</a>.  IBGP Convergence</span>

   During the establishment of an EBGP session, in some corner cases, a
   router may have no path toward an affected prefix, leading to loss of
   connectivity.

   A typical example for such transient unreachability for a given
   prefix is the following:

      Consider three Route Reflectors (RR): RR1, RR2, RR3.  There is a
      full mesh of IBGP sessions between them.

      1.  RR1 is initially advertising the current best path to the
          members of its IBGP RR full mesh.  It propagated that path
          within its RR full-mesh.  RR2 knows only that path toward the
          prefix.

      2.  RR3 receives a new best path originated by the startup
          initiator, which is one of its RR clients.  RR3 selects it as
          best and propagates an UPDATE within its RR full mesh, i.e.,
          to RR1 and RR2.

      3.  RR1 receives that path, reruns its decision process, and picks
          this new path as best.  As a result, RR1 withdraws its
          previously announced best path on the IBGP sessions of its RR
          full mesh.

      4.  If, for any reason, RR3 processes the withdraw generated in
          step 3 before processing the update generated in step 2, RR3
          transiently suffers from unreachability for the affected
          prefix.

   The use of [<a href="/doc/html/rfc7911" title="&quot;Advertisement of Multiple Paths in BGP&quot;">RFC7911</a>] or [<a href="#ref-BEST-EXTERNAL">BEST-EXTERNAL</a>] among the RR of the IBGP full
   mesh can solve these corner cases by ensuring that within an AS, the
   advertisement of a new route is not translated into the withdraw of a
   former route.

   Indeed, advertising the best external route ensures that an ASBR does
   not withdraw a previously advertised (EBGP) path when it receives an
   additional, preferred path over an IBGP session.  Also, advertising
   the best intra-cluster route ensures that an RR does not withdraw a
   previously advertised (IBGP) path to its non-clients (e.g., other RRs
   in a mesh of RR) when it receives a new, preferred path over an IBGP
   session.







<span class="grey">Francois, et al.             Standards Track                   [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="/doc/html/rfc8326">RFC 8326</a>              Graceful BGP Session Shutdown           March 2018</span>


Acknowledgments

   The authors wish to thank Olivier Bonaventure, Pradosh Mohapatra, Job
   Snijders, John Heasley, and Christopher Morrow for their useful
   comments.

Authors&#x27; Addresses

   Pierre Francois (editor)
   Individual Contributor

   Email: pfrpfr@gmail.com


   Bruno Decraene (editor)
   Orange

   Email: bruno.decraene@orange.com


   Cristel Pelsser
   Strasbourg University

   Email: pelsser@unistra.fr


   Keyur Patel
   Arrcus, Inc.

   Email: keyur@arrcus.com


   Clarence Filsfils
   Cisco Systems

   Email: cfilsfil@cisco.com















Francois, et al.             Standards Track                   [Page 12]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

