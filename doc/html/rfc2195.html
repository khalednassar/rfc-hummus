<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc2195
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/rfc2195/">
  <meta name="description" content="IMAP/POP AUTHorize Extension for Simple Challenge/Response (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc2195.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc2195.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc2195.txt.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/rfc2195/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc2195/" title="Datatracker information for this document">Tracker</a>] [<a href="mailto:rfc2195@ietf.org?subject=rfc2195" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=rfc2195-.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=rfc2195-.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/rfc2195-.txt" title="Run an idnits check of this document">Nits</a>]

                                                       Proposed Standard</pre>
      </div>
    

    <div class="draftcontent">
    <pre>Network Working Group                                       J. Klensin
Request for Comments: 2195                                    R. Catoe
Category: Standards Track                                 P. Krumviede
Obsoletes: <a href="/doc/html/rfc2095">2095</a>                                                    MCI
                                                        September 1997


       <span class="h1">IMAP/POP AUTHorize Extension for Simple Challenge/Response</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the &quot;Internet
   Official Protocol Standards&quot; (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Abstract

   While IMAP4 supports a number of strong authentication mechanisms as
   described in <a href="/doc/html/rfc1731">RFC 1731</a>, it lacks any mechanism that neither passes
   cleartext, reusable passwords across the network nor requires either
   a significant security infrastructure or that the mail server update
   a mail-system-wide user authentication file on each mail access.
   This specification provides a simple challenge-response
   authentication protocol that is suitable for use with IMAP4.  Since
   it utilizes Keyed-MD5 digests and does not require that the secret be
   stored in the clear on the server, it may also constitute an
   improvement on APOP for POP3 use as specified in <a href="/doc/html/rfc1734">RFC 1734</a>.

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>. Introduction</span>

   Existing Proposed Standards specify an AUTHENTICATE mechanism for the
   IMAP4 protocol [<a href="#ref-IMAP" title="&quot;Internet Message Access Protocol - Version 4rev1&quot;">IMAP</a>, <a href="#ref-IMAP-AUTH" title="&quot;IMAP4 Authentication Mechanisms&quot;">IMAP-AUTH</a>] and a parallel AUTH mechanism for
   the POP3 protocol [<a href="#ref-POP3-AUTH" title="&quot;POP3 AUTHentication command&quot;">POP3-AUTH</a>].  The AUTHENTICATE mechanism is
   intended to be extensible; the four methods specified in [<a href="#ref-IMAP-AUTH" title="&quot;IMAP4 Authentication Mechanisms&quot;">IMAP-AUTH</a>]
   are all fairly powerful and require some security infrastructure to
   support.  The base POP3 specification [<a href="#ref-POP3" title="&quot;Post Office Protocol - Version 3&quot;">POP3</a>] also contains a
   lightweight challenge-response mechanism called APOP.  APOP is
   associated with most of the risks associated with such protocols: in
   particular, it requires that both the client and server machines have
   access to the shared secret in cleartext form. CRAM offers a method
   for avoiding such cleartext storage while retaining the algorithmic
   simplicity of APOP in using only MD5, though in a &quot;keyed&quot; method.







<span class="grey">Klensin, Catoe &amp; Krumviede  Standards Track                     [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc2195">RFC 2195</a>              IMAP/POP AUTHorize Extension        September 1997</span>


   At present, IMAP [<a href="#ref-IMAP" title="&quot;Internet Message Access Protocol - Version 4rev1&quot;">IMAP</a>] lacks any facility corresponding to APOP.
   The only alternative to the strong mechanisms identified in [IMAP-
   AUTH] is a presumably cleartext username and password, supported
   through the LOGIN command in [<a href="#ref-IMAP" title="&quot;Internet Message Access Protocol - Version 4rev1&quot;">IMAP</a>].  This document describes a
   simple challenge-response mechanism, similar to APOP and PPP CHAP
   [PPP], that can be used with IMAP (and, in principle, with POP3).

   This mechanism also has the advantage over some possible alternatives
   of not requiring that the server maintain information about email
   &quot;logins&quot; on a per-login basis.  While mechanisms that do require such
   per-login history records may offer enhanced security, protocols such
   as IMAP, which may have several connections between a given client
   and server open more or less simultaneous, may make their
   implementation particularly challenging.

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>. Challenge-Response Authentication Mechanism (CRAM)</span>

   The authentication type associated with CRAM is &quot;CRAM-MD5&quot;.

   The data encoded in the first ready response contains an
   presumptively arbitrary string of random digits, a timestamp, and the
   fully-qualified primary host name of the server.  The syntax of the
   unencoded form must correspond to that of an <a href="/doc/html/rfc822">RFC 822</a> &#x27;msg-id&#x27;
   [<a href="/doc/html/rfc822">RFC822</a>] as described in [<a href="#ref-POP3" title="&quot;Post Office Protocol - Version 3&quot;">POP3</a>].

   The client makes note of the data and then responds with a string
   consisting of the user name, a space, and a &#x27;digest&#x27;.  The latter is
   computed by applying the keyed MD5 algorithm from [<a href="#ref-KEYED-MD5" title="&quot;HMAC: Keyed-Hashing for Message Authentication&quot;">KEYED-MD5</a>] where
   the key is a shared secret and the digested text is the timestamp
   (including angle-brackets).

   This shared secret is a string known only to the client and server.
   The `digest&#x27; parameter itself is a 16-octet value which is sent in
   hexadecimal format, using lower-case ASCII characters.

   When the server receives this client response, it verifies the digest
   provided.  If the digest is correct, the server should consider the
   client authenticated and respond appropriately.

   Keyed MD5 is chosen for this application because of the greater
   security imparted to authentication of short messages. In addition,
   the use of the techniques described in [<a href="#ref-KEYED-MD5" title="&quot;HMAC: Keyed-Hashing for Message Authentication&quot;">KEYED-MD5</a>] for precomputation
   of intermediate results make it possible to avoid explicit cleartext
   storage of the shared secret on the server system by instead storing
   the intermediate results which are known as &quot;contexts&quot;.






<span class="grey">Klensin, Catoe &amp; Krumviede  Standards Track                     [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc2195">RFC 2195</a>              IMAP/POP AUTHorize Extension        September 1997</span>


   CRAM does not support a protection mechanism.

   Example:

   The examples in this document show the use of the CRAM mechanism with
   the IMAP4 AUTHENTICATE command [<a href="#ref-IMAP-AUTH" title="&quot;IMAP4 Authentication Mechanisms&quot;">IMAP-AUTH</a>].  The base64 encoding of
   the challenges and responses is part of the IMAP4 AUTHENTICATE
   command, not part of the CRAM specification itself.

     S: * OK IMAP4 Server
     C: A0001 AUTHENTICATE CRAM-MD5
     S: + PDE4OTYuNjk3MTcwOTUyQHBvc3RvZmZpY2UucmVzdG9uLm1jaS5uZXQ+
     C: dGltIGI5MTNhNjAyYzdlZGE3YTQ5NWI0ZTZlNzMzNGQzODkw
     S: A0001 OK CRAM authentication successful

      In this example, the shared secret is the string
      &#x27;tanstaaftanstaaf&#x27;.  Hence, the Keyed MD5 digest is produced by
      calculating

        MD5((tanstaaftanstaaf XOR opad),
            MD5((tanstaaftanstaaf XOR ipad),
            &lt;1896.697170952@postoffice.reston.mci.net&gt;))

      where ipad and opad are as defined in the keyed-MD5 Work in
      Progress [<a href="#ref-KEYED-MD5" title="&quot;HMAC: Keyed-Hashing for Message Authentication&quot;">KEYED-MD5</a>] and the string shown in the challenge is the
      base64 encoding of &lt;1896.697170952@postoffice.reston.mci.net&gt;. The
      shared secret is null-padded to a length of 64 bytes. If the
      shared secret is longer than 64 bytes, the MD5 digest of the
      shared secret is used as a 16 byte input to the keyed MD5
      calculation.

      This produces a digest value (in hexadecimal) of

           b913a602c7eda7a495b4e6e7334d3890

      The user name is then prepended to it, forming

           tim b913a602c7eda7a495b4e6e7334d3890

      Which is then base64 encoded to meet the requirements of the IMAP4
      AUTHENTICATE command (or the similar POP3 AUTH command), yielding

           dGltIGI5MTNhNjAyYzdlZGE3YTQ5NWI0ZTZlNzMzNGQzODkw








<span class="grey">Klensin, Catoe &amp; Krumviede  Standards Track                     [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc2195">RFC 2195</a>              IMAP/POP AUTHorize Extension        September 1997</span>


<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>. References</span>

   [<a id="ref-CHAP">CHAP</a>]  Lloyd, B., and W. Simpson, &quot;PPP Authentication Protocols&quot;,
       <a href="/doc/html/rfc1334">RFC 1334</a>, October 1992.

   [<a id="ref-IMAP">IMAP</a>] Crispin, M., &quot;Internet Message Access Protocol - Version
       4rev1&quot;, <a href="/doc/html/rfc2060">RFC 2060</a>, University of Washington, December 1996.

   [<a id="ref-IMAP-AUTH">IMAP-AUTH</a>] Myers, J., &quot;IMAP4 Authentication Mechanisms&quot;,
       <a href="/doc/html/rfc1731">RFC 1731</a>, Carnegie Mellon, December 1994.

   [<a id="ref-KEYED-MD5">KEYED-MD5</a>] Krawczyk, Bellare, Canetti, &quot;HMAC: Keyed-Hashing for
       Message Authentication&quot;, <a href="/doc/html/rfc2104">RFC 2104</a>, February 1997.

   [<a id="ref-MD5">MD5</a>]  Rivest, R., &quot;The MD5 Message Digest Algorithm&quot;,
       <a href="/doc/html/rfc1321">RFC 1321</a>, MIT Laboratory for Computer Science, April 1992.

   [<a id="ref-POP3">POP3</a>] Myers, J., and M. Rose, &quot;Post Office Protocol - Version 3&quot;,
       STD 53, <a href="/doc/html/rfc1939">RFC 1939</a>, Carnegie Mellon, May 1996.

   [<a id="ref-POP3-AUTH">POP3-AUTH</a>] Myers, J., &quot;POP3 AUTHentication command&quot;, <a href="/doc/html/rfc1734">RFC 1734</a>,
       Carnegie Mellon, December, 1994.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>. Security Considerations</span>

   It is conjectured that use of the CRAM authentication mechanism
   provides origin identification and replay protection for a session.
   Accordingly, a server that implements both a cleartext password
   command and this authentication type should not allow both methods of
   access for a given user.

   While the saving, on the server, of &quot;contexts&quot; (see <a href="#section-2">section 2</a>) is
   marginally better than saving the shared secrets in cleartext as is
   required by CHAP [<a href="#ref-CHAP" title="&quot;PPP Authentication Protocols&quot;">CHAP</a>] and APOP [<a href="#ref-POP3" title="&quot;Post Office Protocol - Version 3&quot;">POP3</a>], it is not sufficient to
   protect the secrets if the server itself is compromised.
   Consequently, servers that store the secrets or contexts must both be
   protected to a level appropriate to the potential information value
   in user mailboxes and identities.

   As the length of the shared secret increases, so does the difficulty
   of deriving it.

   While there are now suggestions in the literature that the use of MD5
   and keyed MD5 in authentication procedures probably has a limited
   effective lifetime, the technique is now widely deployed and widely
   understood.  It is believed that this general understanding may
   assist with the rapid replacement, by CRAM-MD5, of the current uses
   of permanent cleartext passwords in IMAP.   This document has been



<span class="grey">Klensin, Catoe &amp; Krumviede  Standards Track                     [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc2195">RFC 2195</a>              IMAP/POP AUTHorize Extension        September 1997</span>


   deliberately written to permit easy upgrading to use SHA (or whatever
   alternatives emerge) when they are considered to be widely available
   and adequately safe.

   Even with the use of CRAM, users are still vulnerable to active
   attacks.  An example of an increasingly common active attack is &#x27;TCP
   Session Hijacking&#x27; as described in CERT Advisory CA-95:01 [CERT95].

   See <a href="#section-1">section 1</a> above for additional discussion.

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>. Acknowledgements</span>

   This memo borrows ideas and some text liberally from [<a href="#ref-POP3" title="&quot;Post Office Protocol - Version 3&quot;">POP3</a>] and
   [<a href="/doc/html/rfc1731">RFC-1731</a>] and thanks are due the authors of those documents.  Ran
   Atkinson made a number of valuable technical and editorial
   contributions to the document.

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>. Authors&#x27; Addresses</span>

   John C. Klensin
   MCI Telecommunications
   800 Boylston St, 7th floor
   Boston, MA 02199
   USA

   EMail: klensin@mci.net
   Phone: +1 617 960 1011

   Randy Catoe
   MCI Telecommunications
   2100 Reston Parkway
   Reston, VA 22091
   USA

   EMail: randy@mci.net
   Phone: +1 703 715 7366

   Paul Krumviede
   MCI Telecommunications
   2100 Reston Parkway
   Reston, VA 22091
   USA

   EMail: paul@mci.net
   Phone: +1 703 715 7251






Klensin, Catoe &amp; Krumviede  Standards Track                     [Page 5]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

