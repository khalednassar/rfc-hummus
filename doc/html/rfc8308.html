<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc8308
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-curdle-ssh-ext-info/">
  <meta name="description" content="Extension Negotiation in the Secure Shell (SSH) Protocol (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc8308.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc8308.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc8308.txt.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/rfc8308/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc8308/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/curdle/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-curdle-ssh-ext-info@ietf.org?subject=draft-ietf-curdle-ssh-ext-info" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-curdle-ssh-ext-info-15.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-curdle-ssh-ext-info-15.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-curdle-ssh-ext-info-15.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-ietf-curdle-ssh-ext-info-15">draft-ietf-curdle-ssh-ext-info-15</a>                Proposed Standard</pre>
      </div>
    

    <div class="draftcontent">
    <pre>Internet Engineering Task Force (IETF)                          D. Bider
Request for Comments: 8308                               Bitvise Limited
Updates: <a href="/doc/html/rfc4251">4251</a>, <a href="/doc/html/rfc4252">4252</a>, <a href="/doc/html/rfc4253">4253</a>, <a href="/doc/html/rfc4254">4254</a>                               March 2018
Category: Standards Track
ISSN: 2070-1721


        <span class="h1">Extension Negotiation in the Secure Shell (SSH) Protocol</span>

Abstract

   This memo updates RFCs 4251, 4252, 4253, and 4254 by defining a
   mechanism for Secure Shell (SSH) clients and servers to exchange
   information about supported protocol extensions confidentially after
   SSH key exchange.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="/doc/html/rfc7841#section-2">Section&nbsp;2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8308">https://www.rfc-editor.org/info/rfc8308</a>.

Copyright Notice

   Copyright (c) 2018 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust&#x27;s Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.







<span class="grey">Bider                        Standards Track                    [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


Table of Contents

   <a href="#section-1">1</a>. Overview and Rationale ..........................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Requirements Terminology ...................................<a href="#page-3">3</a>
      <a href="#section-1.2">1.2</a>. Wire Encoding Terminology ..................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Extension Negotiation Mechanism .................................<a href="#page-3">3</a>
      <a href="#section-2.1">2.1</a>. Signaling of Extension Negotiation in SSH_MSG_KEXINIT ......<a href="#page-3">3</a>
      <a href="#section-2.2">2.2</a>. Enabling Criteria ..........................................<a href="#page-4">4</a>
      <a href="#section-2.3">2.3</a>. SSH_MSG_EXT_INFO Message ...................................<a href="#page-4">4</a>
      <a href="#section-2.4">2.4</a>. Message Order ..............................................<a href="#page-5">5</a>
      <a href="#section-2.5">2.5</a>. Interpretation of Extension Names and Values ...............<a href="#page-6">6</a>
   <a href="#section-3">3</a>. Initially Defined Extensions ....................................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. &quot;server-sig-algs&quot; ..........................................<a href="#page-6">6</a>
      <a href="#section-3.2">3.2</a>. &quot;delay-compression&quot; ........................................<a href="#page-7">7</a>
           <a href="#section-3.2.1">3.2.1</a>. Awkwardly Timed Key Re-Exchange .....................<a href="#page-9">9</a>
           <a href="#section-3.2.2">3.2.2</a>. Subsequent Re-Exchange ..............................<a href="#page-9">9</a>
           <a href="#section-3.2.3">3.2.3</a>. Compatibility Note: OpenSSH up to Version 7.5 .......<a href="#page-9">9</a>
      <a href="#section-3.3">3.3</a>. &quot;no-flow-control&quot; .........................................<a href="#page-10">10</a>
           <a href="#section-3.3.1">3.3.1</a>. Prior &quot;No Flow Control&quot; Practice ...................<a href="#page-10">10</a>
      <a href="#section-3.4">3.4</a>. &quot;elevation&quot; ...............................................<a href="#page-11">11</a>
   <a href="#section-4">4</a>. IANA Considerations ............................................<a href="#page-12">12</a>
      <a href="#section-4.1">4.1</a>. Additions to Existing Registries ..........................<a href="#page-12">12</a>
      <a href="#section-4.2">4.2</a>. New Registry: Extension Names .............................<a href="#page-12">12</a>
           <a href="#section-4.2.1">4.2.1</a>. Future Assignments to Extension Names Registry .....<a href="#page-12">12</a>
   <a href="#section-5">5</a>. Security Considerations ........................................<a href="#page-12">12</a>
   <a href="#section-6">6</a>. References .....................................................<a href="#page-13">13</a>
      <a href="#section-6.1">6.1</a>. Normative References ......................................<a href="#page-13">13</a>
      <a href="#section-6.2">6.2</a>. Informative References ....................................<a href="#page-13">13</a>
   Acknowledgments ...................................................<a href="#page-14">14</a>
   Author&#x27;s Address ..................................................<a href="#page-14">14</a>





















<span class="grey">Bider                        Standards Track                    [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Overview and Rationale</span>

   Secure Shell (SSH) is a common protocol for secure communication on
   the Internet.  The original design of the SSH transport layer
   [<a href="/doc/html/rfc4253" title="&quot;The Secure Shell (SSH) Transport Layer Protocol&quot;">RFC4253</a>] lacks proper extension negotiation.  Meanwhile, diverse
   implementations take steps to ensure that known message types contain
   no unrecognized information.  This makes it difficult for
   implementations to signal capabilities and negotiate extensions
   without risking disconnection.  This obstacle has been recognized in
   the process of updating SSH to support RSA signatures using SHA-256
   and SHA-512 [<a href="/doc/html/rfc8332" title="&quot;Use of RSA Keys with SHA-256 and SHA-512 in the Secure Shell (SSH) Protocol&quot;">RFC8332</a>].  To avoid trial and error as well as
   authentication penalties, a client must be able to discover public
   key algorithms a server accepts.  This extension mechanism permits
   this discovery.

   This memo updates RFCs 4251, 4252, 4253, and 4254.

<span class="h3"><a class="selflink" id="section-1.1" href="#section-1.1">1.1</a>.  Requirements Terminology</span>

   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and
   &quot;OPTIONAL&quot; in this document are to be interpreted as described in
   <a href="/doc/html/bcp14">BCP 14</a> [<a href="/doc/html/rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>] [<a href="/doc/html/rfc8174" title="&quot;Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words&quot;">RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

<span class="h3"><a class="selflink" id="section-1.2" href="#section-1.2">1.2</a>.  Wire Encoding Terminology</span>

   The wire encoding types in this document -- &quot;byte&quot;, &quot;uint32&quot;,
   &quot;string&quot;, &quot;boolean&quot;, &quot;name-list&quot; -- have meanings as described in
   [<a href="/doc/html/rfc4251" title="&quot;The Secure Shell (SSH) Protocol Architecture&quot;">RFC4251</a>].

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Extension Negotiation Mechanism</span>

<span class="h3"><a class="selflink" id="section-2.1" href="#section-2.1">2.1</a>.  Signaling of Extension Negotiation in SSH_MSG_KEXINIT</span>

   Applications implementing this mechanism MUST add one of the
   following indicator names to the field kex_algorithms in the
   SSH_MSG_KEXINIT message sent by the application in the first key
   exchange:

   o  When acting as server: &quot;ext-info-s&quot;

   o  When acting as client: &quot;ext-info-c&quot;

   The indicator name is added without quotes and MAY be added at any
   position in the name-list, subject to proper separation from other
   names as per name-list conventions.




<span class="grey">Bider                        Standards Track                    [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


   The names are added to the kex_algorithms field because this is one
   of two name-list fields in SSH_MSG_KEXINIT that do not have a
   separate copy for each data direction.

   The indicator names inserted by the client and server are different
   to ensure these names will not produce a match and therefore not
   affect the algorithm chosen in key exchange algorithm negotiation.

   The inclusion of textual indicator names is intended to provide a
   clue for implementers to discover this mechanism.

<span class="h3"><a class="selflink" id="section-2.2" href="#section-2.2">2.2</a>.  Enabling Criteria</span>

   If a client or server offers &quot;ext-info-c&quot; or &quot;ext-info-s&quot;
   respectively, it MUST be prepared to accept an SSH_MSG_EXT_INFO
   message from the peer.

   A server only needs to send &quot;ext-info-s&quot; if it intends to process
   SSH_MSG_EXT_INFO from the client.  A client only needs to send
   &quot;ext-info-c&quot; if it plans to process SSH_MSG_EXT_INFO from the server.

   If a server receives an &quot;ext-info-c&quot;, or a client receives an
   &quot;ext-info-s&quot;, it MAY send an SSH_MSG_EXT_INFO message but is not
   required to do so.

   Neither party needs to wait for the other&#x27;s SSH_MSG_KEXINIT in order
   to decide whether to send the appropriate indicator in its own
   SSH_MSG_KEXINIT.

   Implementations MUST NOT send an incorrect indicator name for their
   role.  Implementations MAY disconnect if the counterparty sends an
   incorrect indicator.  If &quot;ext-info-c&quot; or &quot;ext-info-s&quot; ends up being
   negotiated as a key exchange method, the parties MUST disconnect.

<span class="h3"><a class="selflink" id="section-2.3" href="#section-2.3">2.3</a>.  SSH_MSG_EXT_INFO Message</span>

   A party that received the &quot;ext-info-c&quot; or &quot;ext-info-s&quot; indicator MAY
   send the following message:

     byte       SSH_MSG_EXT_INFO (value 7)
     uint32     nr-extensions
     repeat the following 2 fields &quot;nr-extensions&quot; times:
       string   extension-name
       string   extension-value (binary)







<span class="grey">Bider                        Standards Track                    [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


   Implementers should pay careful attention to <a href="#section-2.5">Section 2.5</a>, in
   particular to the requirement to tolerate any sequence of bytes
   (including null bytes at any position) in an unknown extension&#x27;s
   extension-value.

<span class="h3"><a class="selflink" id="section-2.4" href="#section-2.4">2.4</a>.  Message Order</span>

   If a client sends SSH_MSG_EXT_INFO, it MUST send it as the next
   packet following the client&#x27;s first SSH_MSG_NEWKEYS message to the
   server.

   If a server sends SSH_MSG_EXT_INFO, it MAY send it at zero, one, or
   both of the following opportunities:

   o  As the next packet following the server&#x27;s first SSH_MSG_NEWKEYS.

      Where clients need information in the server&#x27;s SSH_MSG_EXT_INFO to
      authenticate, it is helpful if the server sends its
      SSH_MSG_EXT_INFO not only as the next packet after
      SSH_MSG_NEWKEYS, but without delay.

      Clients cannot rely on this because the server is not required to
      send the message at this time; if sent, it may be delayed by the
      network.  However, if a timely SSH_MSG_EXT_INFO is received, a
      client can pipeline an authentication request after its
      SSH_MSG_SERVICE_REQUEST, even when it needs extension information.

   o  Immediately preceding the server&#x27;s SSH_MSG_USERAUTH_SUCCESS, as
      defined in [<a href="/doc/html/rfc4252" title="&quot;The Secure Shell (SSH) Authentication Protocol&quot;">RFC4252</a>].

      The server MAY send SSH_MSG_EXT_INFO at this second opportunity,
      whether or not it sent it at the first.  A client that sent
      &quot;ext-info-c&quot; MUST accept a server&#x27;s SSH_MSG_EXT_INFO at both
      opportunities but MUST NOT require it.

      This allows a server to reveal support for additional extensions
      that it was unwilling to reveal to an unauthenticated client.  If
      a server sends a second SSH_MSG_EXT_INFO, this replaces any
      initial one, and both the client and the server re-evaluate
      extensions in effect.  The server&#x27;s second SSH_MSG_EXT_INFO is
      matched against the client&#x27;s original.

      The timing of the second opportunity is chosen for the following
      reasons.  If the message was sent earlier, it would not allow the
      server to withhold information until the client has authenticated.
      If it was sent later, a client that needs information from the
      second SSH_MSG_EXT_INFO immediately after it authenticates would
      have no way to reliably know whether to expect the message.



<span class="grey">Bider                        Standards Track                    [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


<span class="h3"><a class="selflink" id="section-2.5" href="#section-2.5">2.5</a>.  Interpretation of Extension Names and Values</span>

   Each extension is identified by its extension-name and defines the
   conditions under which the extension is considered to be in effect.
   Applications MUST ignore unrecognized extension-names.

   When it is specified, an extension MAY dictate that, in order to take
   effect, both parties must include it in their SSH_MSG_EXT_INFO or
   that it is sufficient for only one party to include it.  However,
   other rules MAY be specified.  The relative order in which extensions
   appear in an SSH_MSG_EXT_INFO message MUST be ignored.

   Extension-value fields are interpreted as defined by their respective
   extension.  This field MAY be empty if permitted by the extension.
   Applications that do not implement or recognize an extension MUST
   ignore its extension-value, regardless of its size or content.
   Applications MUST tolerate any sequence of bytes -- including null
   bytes at any position -- in an unknown extension&#x27;s extension-value.

   The cumulative size of an SSH_MSG_EXT_INFO message is limited only by
   the maximum packet length that an implementation may apply in
   accordance with [<a href="/doc/html/rfc4253" title="&quot;The Secure Shell (SSH) Transport Layer Protocol&quot;">RFC4253</a>].  Implementations MUST accept well-formed
   SSH_MSG_EXT_INFO messages up to the maximum packet length they
   accept.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Initially Defined Extensions</span>

<span class="h3"><a class="selflink" id="section-3.1" href="#section-3.1">3.1</a>.  &quot;server-sig-algs&quot;</span>

   This extension is sent with the following extension name and value:

     string      &quot;server-sig-algs&quot;
     name-list   public-key-algorithms-accepted

   The name-list type is a strict subset of the string type and is thus
   permissible as an extension-value.  See [<a href="/doc/html/rfc4251" title="&quot;The Secure Shell (SSH) Protocol Architecture&quot;">RFC4251</a>] for more
   information.

   This extension is sent by the server and contains a list of public
   key algorithms that the server is able to process as part of a
   &quot;publickey&quot; authentication request.  If a client sends this
   extension, the server MAY ignore it and MAY disconnect.

   In this extension, a server MUST enumerate all public key algorithms
   it might accept during user authentication.  However, early server
   implementations that do not enumerate all accepted algorithms do





<span class="grey">Bider                        Standards Track                    [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


   exist.  For this reason, a client MAY send a user authentication
   request using a public key algorithm not included in &quot;server-sig-
   algs&quot;.

   A client that wishes to proceed with public key authentication MAY
   wait for the server&#x27;s SSH_MSG_EXT_INFO so it can send a &quot;publickey&quot;
   authentication request with an appropriate public key algorithm,
   rather than resorting to trial and error.

   Servers that implement public key authentication SHOULD implement
   this extension.

   If a server does not send this extension, a client MUST NOT make any
   assumptions about the server&#x27;s public key algorithm support, and MAY
   proceed with authentication requests using trial and error.  Note
   that implementations are known to exist that apply authentication
   penalties if the client attempts to use an unexpected public key
   algorithm.

   Authentication penalties are applied by servers to deter brute-force
   password guessing, username enumeration, and other types of behavior
   deemed suspicious by server administrators or implementers.
   Penalties may include automatic IP address throttling or blocking,
   and they may trigger email alerts or auditing.

<span class="h3"><a class="selflink" id="section-3.2" href="#section-3.2">3.2</a>.  &quot;delay-compression&quot;</span>

   This extension MAY be sent by both parties as follows:

     string         &quot;delay-compression&quot;
     string:
       name-list    compression_algorithms_client_to_server
       name-list    compression_algorithms_server_to_client

   The extension-value is a string that encodes two name-lists.  The
   name-lists themselves have the encoding of strings.  For example, to
   indicate a preference for algorithms &quot;foo,bar&quot; in the client-to-
   server direction and &quot;bar,baz&quot; in the server-to-client direction, a
   sender encodes the extension-value as follows (including its length):

     00000016 00000007 666f6f2c626172 00000007 6261722c62617a

   This same encoding could be sent by either party -- client or server.

   This extension allows the server and client to renegotiate
   compression algorithm support without having to conduct a key
   re-exchange, which puts new algorithms into effect immediately upon
   successful authentication.



<span class="grey">Bider                        Standards Track                    [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


   This extension takes effect only if both parties send it.  Name-lists
   MAY include any compression algorithm that could have been negotiated
   in SSH_MSG_KEXINIT, except algorithms that define their own delayed
   compression semantics.  This means &quot;zlib,none&quot; is a valid algorithm
   list in this context, but &quot;zlib@openssh.com&quot; is not.

   If both parties send this extension, but the name-lists do not
   contain a common algorithm in either direction, the parties MUST
   disconnect in the same way as if negotiation failed as part of
   SSH_MSG_KEXINIT.

   If this extension takes effect, the renegotiated compression
   algorithm is activated for the very next SSH message after the
   trigger message:

   o  Sent by the server, the trigger message is
      SSH_MSG_USERAUTH_SUCCESS.

   o  Sent by the client, the trigger message is SSH_MSG_NEWCOMPRESS.

   If this extension takes effect, the client MUST send the following
   message within a reasonable number of outgoing SSH messages after
   receiving SSH_MSG_USERAUTH_SUCCESS, but not necessarily as the first
   such outgoing message:

     byte       SSH_MSG_NEWCOMPRESS (value 8)

   The purpose of SSH_MSG_NEWCOMPRESS is to avoid a race condition where
   the server cannot reliably know whether a message sent by the client
   was sent before or after receiving the server&#x27;s
   SSH_MSG_USERAUTH_SUCCESS.  For example, clients may send keep-alive
   messages during logon processing.

   As is the case for all extensions unless otherwise noted, the server
   MAY delay including this extension until its secondary
   SSH_MSG_EXT_INFO, sent before SSH_MSG_USERAUTH_SUCCESS.  This allows
   the server to avoid advertising compression until the client has
   authenticated.

   If the parties renegotiate compression using this extension in a
   session where compression is already enabled and the renegotiated
   algorithm is the same in one or both directions, then the internal
   compression state MUST be reset for each direction at the time the
   renegotiated algorithm takes effect.







<span class="grey">Bider                        Standards Track                    [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


<span class="h4"><a class="selflink" id="section-3.2.1" href="#section-3.2.1">3.2.1</a>.  Awkwardly Timed Key Re-Exchange</span>

   A party that has signaled, or intends to signal, support for this
   extension in an SSH session MUST NOT initiate key re-exchange in that
   session until either of the following occurs:

   o  This extension was negotiated, and the party that&#x27;s about to start
      key re-exchange already sent its trigger message for compression.

   o  The party has sent (if server) or received (if client) the message
      SSH_MSG_USERAUTH_SUCCESS, and this extension was not negotiated.

   If a party violates this rule, the other party MAY disconnect.

   In general, parties SHOULD NOT start key re-exchange before
   successful user authentication but MAY tolerate it if not using this
   extension.

<span class="h4"><a class="selflink" id="section-3.2.2" href="#section-3.2.2">3.2.2</a>.  Subsequent Re-Exchange</span>

   In subsequent key re-exchanges that unambiguously begin after the
   compression trigger messages, the compression algorithms negotiated
   in re-exchange override the algorithms negotiated with this
   extension.

<span class="h4"><a class="selflink" id="section-3.2.3" href="#section-3.2.3">3.2.3</a>.  Compatibility Note: OpenSSH up to Version 7.5</span>

   This extension uses a binary extension-value encoding.  OpenSSH
   clients up to and including version 7.5 advertise support to receive
   SSH_MSG_EXT_INFO but disconnect on receipt of an extension-value
   containing null bytes.  This is an error fixed in OpenSSH
   version 7.6.

   Implementations that wish to interoperate with OpenSSH 7.5 and
   earlier are advised to check the remote party&#x27;s SSH version string
   and omit this extension if an affected version is detected.  Affected
   versions do not implement this extension, so there is no harm in
   omitting it.  The extension SHOULD NOT be omitted if the detected
   OpenSSH version is 7.6 or higher.  This would make it harder for the
   OpenSSH project to implement this extension in a higher version.











<span class="grey">Bider                        Standards Track                    [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


<span class="h3"><a class="selflink" id="section-3.3" href="#section-3.3">3.3</a>.  &quot;no-flow-control&quot;</span>

   This extension is sent with the following extension name and value:

     string      &quot;no-flow-control&quot;
     string      choice of: &quot;p&quot; for preferred | &quot;s&quot; for supported

   A party SHOULD send &quot;s&quot; if it supports &quot;no-flow-control&quot; but does not
   prefer to enable it.  A party SHOULD send &quot;p&quot; if it prefers to enable
   the extension if the other party supports it.  Parties MAY disconnect
   if they receive a different extension value.

   For this extension to take effect, the following must occur:

   o  This extension MUST be sent by both parties.

   o  At least one party MUST have sent the value &quot;p&quot; (preferred).

   If this extension takes effect, the &quot;initial window size&quot; fields in
   SSH_MSG_CHANNEL_OPEN and SSH_MSG_CHANNEL_OPEN_CONFIRMATION, as
   defined in [<a href="/doc/html/rfc4254" title="&quot;The Secure Shell (SSH) Connection Protocol&quot;">RFC4254</a>], become meaningless.  The values of these fields
   MUST be ignored, and a channel behaves as if all window sizes are
   infinite.  Neither side is required to send any
   SSH_MSG_CHANNEL_WINDOW_ADJUST messages, and if received, such
   messages MUST be ignored.

   This extension is intended for, but not limited to, use by file
   transfer applications that are only going to use one channel and for
   which the flow control provided by SSH is an impediment, rather than
   a feature.

   Implementations MUST refuse to open more than one simultaneous
   channel when this extension is in effect.  Nevertheless, server
   implementations SHOULD support clients opening more than one
   non-simultaneous channel.

<span class="h4"><a class="selflink" id="section-3.3.1" href="#section-3.3.1">3.3.1</a>.  Prior &quot;No Flow Control&quot; Practice</span>

   Before this extension, some applications would simply not implement
   SSH flow control, sending an initial channel window size of 2^32 - 1.
   Applications SHOULD NOT do this for the following reasons:

   o  It is plausible to transfer more than 2^32 bytes over a channel.
      Such a channel will hang if the other party implements SSH flow
      control according to [<a href="/doc/html/rfc4254" title="&quot;The Secure Shell (SSH) Connection Protocol&quot;">RFC4254</a>].






<span class="grey">Bider                        Standards Track                   [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


   o  Implementations that cannot handle large channel window sizes
      exist, and they can exhibit non-graceful behaviors, including
      disconnect.

<span class="h3"><a class="selflink" id="section-3.4" href="#section-3.4">3.4</a>.  &quot;elevation&quot;</span>

   The terms &quot;elevation&quot; and &quot;elevated&quot; refer to an operating system
   mechanism where an administrator&#x27;s logon session is associated with
   two security contexts: one limited and one with administrative
   rights.  To &quot;elevate&quot; such a session is to activate the security
   context with full administrative rights.  For more information about
   this mechanism on Windows, see [<a href="#ref-WINADMIN" title="&quot;How to launch a process as a Full Administrator when UAC is enabled?&quot;">WINADMIN</a>] and [<a href="#ref-WINTOKEN" title="&quot;TOKEN_ELEVATION_TYPE enumeration&quot;">WINTOKEN</a>].

   This extension MAY be sent by the client as follows:

     string      &quot;elevation&quot;
     string      choice of: &quot;y&quot; | &quot;n&quot; | &quot;d&quot;

   A client sends &quot;y&quot; to indicate its preference that the session should
   be elevated; &quot;n&quot; to not be elevated; and &quot;d&quot; for the server to use
   its default behavior.  The server MAY disconnect if it receives a
   different extension value.  If a client does not send the &quot;elevation&quot;
   extension, the server SHOULD act as if &quot;d&quot; was sent.

   If a client has included this extension, then after authentication, a
   server that supports this extension SHOULD indicate to the client
   whether elevation was done by sending the following global request:

     byte        SSH_MSG_GLOBAL_REQUEST
     string      &quot;elevation&quot;
     boolean     want reply = false
     boolean     elevation performed

   Clients that implement this extension help reduce attack surface for
   Windows servers that handle administrative logins.  Where clients do
   not support this extension, servers must elevate sessions to allow
   full access by administrative users always.  Where clients support
   this extension, sessions can be created without elevation unless
   requested.












<span class="grey">Bider                        Standards Track                   [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  IANA Considerations</span>

<span class="h3"><a class="selflink" id="section-4.1" href="#section-4.1">4.1</a>.  Additions to Existing Registries</span>

   IANA has added the following entries to the &quot;Message Numbers&quot;
   registry [<a href="#ref-IANA-M" title="&quot;Message Numbers&quot;">IANA-M</a>] under the &quot;Secure Shell (SSH) Protocol Parameters&quot;
   registry [<a href="/doc/html/rfc4250" title="&quot;The Secure Shell (SSH) Protocol Assigned Numbers&quot;">RFC4250</a>]:

     Value    Message ID             Reference
     -----------------------------------------
     7        SSH_MSG_EXT_INFO       <a href="/doc/html/rfc8308">RFC 8308</a>
     8        SSH_MSG_NEWCOMPRESS    <a href="/doc/html/rfc8308">RFC 8308</a>

   IANA has also added the following entries to the &quot;Key Exchange Method
   Names&quot; registry [<a href="#ref-IANA-KE" title="&quot;Key Exchange Method Names&quot;">IANA-KE</a>]:

     Method Name     Reference      Note
     ------------------------------------------
     ext-info-s      <a href="/doc/html/rfc8308#section-2">RFC 8308       Section&nbsp;2</a>
     ext-info-c      <a href="/doc/html/rfc8308#section-2">RFC 8308       Section&nbsp;2</a>

<span class="h3"><a class="selflink" id="section-4.2" href="#section-4.2">4.2</a>.  New Registry: Extension Names</span>

   Also under the &quot;Secure Shell (SSH) Protocol Parameters&quot; registry,
   IANA has created a new &quot;Extension Names&quot; registry, with the following
   initial content:

     Extension Name       Reference       Note
     ------------------------------------------------
     server-sig-algs      <a href="/doc/html/rfc8308#section-3.1">RFC 8308        Section&nbsp;3.1</a>
     delay-compression    <a href="/doc/html/rfc8308#section-3.2">RFC 8308        Section&nbsp;3.2</a>
     no-flow-control      <a href="/doc/html/rfc8308#section-3.3">RFC 8308        Section&nbsp;3.3</a>
     elevation            <a href="/doc/html/rfc8308#section-3.4">RFC 8308        Section&nbsp;3.4</a>

<span class="h4"><a class="selflink" id="section-4.2.1" href="#section-4.2.1">4.2.1</a>.  Future Assignments to Extension Names Registry</span>

   Names in the &quot;Extension Names&quot; registry MUST follow the conventions
   for names defined in <a href="/doc/html/rfc4250#section-4.6.1">[RFC4250], Section&nbsp;4.6.1</a>.

   Requests for assignments of new non-local names in the &quot;Extension
   Names&quot; registry (i.e., names not including the &#x27;@&#x27; character) MUST be
   done using the IETF Review policy, as described in [<a href="/doc/html/rfc8126" title="">RFC8126</a>].

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  Security Considerations</span>

   Security considerations are discussed throughout this document.  This
   document updates the SSH protocol as defined in [<a href="/doc/html/rfc4251" title="&quot;The Secure Shell (SSH) Protocol Architecture&quot;">RFC4251</a>] and related
   documents.  The security considerations of [<a href="/doc/html/rfc4251" title="&quot;The Secure Shell (SSH) Protocol Architecture&quot;">RFC4251</a>] apply.



<span class="grey">Bider                        Standards Track                   [Page 12]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-13" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  References</span>

<span class="h3"><a class="selflink" id="section-6.1" href="#section-6.1">6.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., &quot;Key words for use in RFCs to Indicate
              Requirement Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC4250">RFC4250</a>]  Lehtinen, S. and C. Lonvick, Ed., &quot;The Secure Shell (SSH)
              Protocol Assigned Numbers&quot;, <a href="/doc/html/rfc4250">RFC 4250</a>,
              DOI 10.17487/RFC4250, January 2006,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4250">https://www.rfc-editor.org/info/rfc4250</a>&gt;.

   [<a id="ref-RFC4251">RFC4251</a>]  Ylonen, T. and C. Lonvick, Ed., &quot;The Secure Shell (SSH)
              Protocol Architecture&quot;, <a href="/doc/html/rfc4251">RFC 4251</a>, DOI 10.17487/RFC4251,
              January 2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4251">https://www.rfc-editor.org/info/rfc4251</a>&gt;.

   [<a id="ref-RFC4252">RFC4252</a>]  Ylonen, T. and C. Lonvick, Ed., &quot;The Secure Shell (SSH)
              Authentication Protocol&quot;, <a href="/doc/html/rfc4252">RFC 4252</a>, DOI 10.17487/RFC4252,
              January 2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4252">https://www.rfc-editor.org/info/rfc4252</a>&gt;.

   [<a id="ref-RFC4253">RFC4253</a>]  Ylonen, T. and C. Lonvick, Ed., &quot;The Secure Shell (SSH)
              Transport Layer Protocol&quot;, <a href="/doc/html/rfc4253">RFC 4253</a>, DOI 10.17487/RFC4253,
              January 2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4253">https://www.rfc-editor.org/info/rfc4253</a>&gt;.

   [<a id="ref-RFC4254">RFC4254</a>]  Ylonen, T. and C. Lonvick, Ed., &quot;The Secure Shell (SSH)
              Connection Protocol&quot;, <a href="/doc/html/rfc4254">RFC 4254</a>, DOI 10.17487/RFC4254,
              January 2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4254">https://www.rfc-editor.org/info/rfc4254</a>&gt;.

   [<a id="ref-RFC8126">RFC8126</a>]  Cotton, M., Leiba, B., and T. Narten, &quot;Guidelines for
              Writing an IANA Considerations Section in RFCs&quot;, <a href="/doc/html/bcp26">BCP 26</a>,
              <a href="/doc/html/rfc8126">RFC 8126</a>, DOI 10.17487/RFC8126, June 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;.

   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., &quot;Ambiguity of Uppercase vs Lowercase in <a href="/doc/html/rfc2119">RFC</a>
              <a href="/doc/html/rfc2119">2119</a> Key Words&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

<span class="h3"><a class="selflink" id="section-6.2" href="#section-6.2">6.2</a>.  Informative References</span>

   [<a id="ref-IANA-KE">IANA-KE</a>]  IANA, &quot;Key Exchange Method Names&quot;,
              &lt;<a href="https://www.iana.org/assignments/ssh-parameters/">https://www.iana.org/assignments/ssh-parameters/</a>&gt;.

   [<a id="ref-IANA-M">IANA-M</a>]   IANA, &quot;Message Numbers&quot;,
              &lt;<a href="https://www.iana.org/assignments/ssh-parameters/">https://www.iana.org/assignments/ssh-parameters/</a>&gt;.





<span class="grey">Bider                        Standards Track                   [Page 13]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-14" ></span>
<span class="grey"><a href="/doc/html/rfc8308">RFC 8308</a>              Extension Negotiation in SSH            March 2018</span>


   [<a id="ref-RFC8332">RFC8332</a>]  Bider, D., &quot;Use of RSA Keys with SHA-256 and SHA-512 in
              the Secure Shell (SSH) Protocol&quot;, <a href="/doc/html/rfc8332">RFC 8332</a>,
              DOI 10.17487/RFC8332, March 2018,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8332">https://www.rfc-editor.org/info/rfc8332</a>&gt;.

   [<a id="ref-WINADMIN">WINADMIN</a>] Microsoft, &quot;How to launch a process as a Full
              Administrator when UAC is enabled?&quot;, March 2013,
              &lt;<a href="https://blogs.msdn.microsoft.com/winsdk/2013/03/22/how-to-launch-a-process-as-a-full-administrator-when-uac-is-enabled/">https://blogs.msdn.microsoft.com/winsdk/2013/03/22/</a>
              <a href="https://blogs.msdn.microsoft.com/winsdk/2013/03/22/how-to-launch-a-process-as-a-full-administrator-when-uac-is-enabled/">how-to-launch-a-process-as-a-full-administrator-when-</a>
              <a href="https://blogs.msdn.microsoft.com/winsdk/2013/03/22/how-to-launch-a-process-as-a-full-administrator-when-uac-is-enabled/">uac-is-enabled/</a>&gt;.

   [<a id="ref-WINTOKEN">WINTOKEN</a>] Microsoft, &quot;TOKEN_ELEVATION_TYPE enumeration&quot;,
              &lt;<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/bb530718.aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/</a>
              <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/bb530718.aspx">bb530718.aspx</a>&gt;.

Acknowledgments

   Thanks to Markus Friedl and Damien Miller for comments and initial
   implementation.  Thanks to Peter Gutmann, Roumen Petrov, Mark D.
   Baushke, Daniel Migault, Eric Rescorla, Matthew A. Miller, Mirja
   Kuehlewind, Adam Roach, Spencer Dawkins, Alexey Melnikov, and Ben
   Campbell for reviews and feedback.

Author&#x27;s Address

   Denis Bider
   Bitvise Limited
   4105 Lombardy Court
   Colleyville, TX  76034
   United States of America

   Email: ietf-ssh3@denisbider.com
   URI:   <a href="https://www.bitvise.com/">https://www.bitvise.com/</a>


















Bider                        Standards Track                   [Page 14]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

