<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc6512
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-mpls-mldp-recurs-fec/">
  <meta name="description" content="Using Multipoint LDP When the Backbone Has No Route to the Root (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc6512.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc6512.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc6512.txt.pdf" title="PDF version of this document">pdf</a>|<a href="https://www.rfc-editor.org/rfc/inline-errata/rfc6512.html">with errata</a>|<a href="/doc/rfc6512/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc6512/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/mpls/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-mpls-mldp-recurs-fec@ietf.org?subject=draft-ietf-mpls-mldp-recurs-fec" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-mpls-mldp-recurs-fec-04.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-mpls-mldp-recurs-fec-04.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-mpls-mldp-recurs-fec-04.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-ietf-mpls-mldp-recurs-fec-04">draft-ietf-mpls-mldp-recurs-fec-04</a>               Proposed Standard
                                                            <a class="text-warning" href="https://www.rfc-editor.org/errata_search.php?rfc=6512&amp;rec_status=0">Errata exist</a></pre>
      </div>
    

    <div class="draftcontent">
    <pre>Internet Engineering Task Force (IETF)                      IJ. Wijnands
Request for Comments: 6512                                      E. Rosen
Category: Standards Track                                  Cisco Systems
ISSN: 2070-1721                                             M. Napierala
                                                                    AT&amp;T
                                                              N. Leymann
                                                        Deutsche Telekom
                                                           February 2012


    <span class="h1">Using Multipoint LDP When the Backbone Has No Route to the Root</span>

Abstract

   The control protocol used for constructing Point-to-Multipoint and
   Multipoint-to-Multipoint Label Switched Paths (&quot;MP LSPs&quot;) contains a
   field that identifies the address of a &quot;root node&quot;.  Intermediate
   nodes are expected to be able to look up that address in their
   routing tables.  However, this is not possible if the route to the
   root node is a BGP route and the intermediate nodes are part of a
   BGP-free core.  This document specifies procedures that enable an MP
   LSP to be constructed through a BGP-free core.  In these procedures,
   the root node address is temporarily replaced by an address that is
   known to the intermediate nodes and is on the path to the true root
   node.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="/doc/html/rfc5741#section-2">Section&nbsp;2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6512">http://www.rfc-editor.org/info/rfc6512</a>.

Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust&#x27;s Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of



<span class="grey">Wijnands, et al.             Standards Track                    [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. The Recursive Opaque Value ......................................<a href="#page-5">5</a>
      <a href="#section-2.1">2.1</a>. Encoding ...................................................<a href="#page-5">5</a>
      <a href="#section-2.2">2.2</a>. Procedures .................................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. The VPN-Recursive Opaque Value ..................................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. Encoding ...................................................<a href="#page-6">6</a>
      <a href="#section-3.2">3.2</a>. Procedures .................................................<a href="#page-7">7</a>
           <a href="#section-3.2.1">3.2.1</a>. Non-Segmented Inter-AS P-Tunnels ....................<a href="#page-7">7</a>
           <a href="#section-3.2.2">3.2.2</a>. Limited Carrier&#x27;s Carrier Function ..................<a href="#page-9">9</a>
   <a href="#section-4">4</a>. IANA Considerations ............................................<a href="#page-10">10</a>
   <a href="#section-5">5</a>. Security Considerations ........................................<a href="#page-10">10</a>
   <a href="#section-6">6</a>. Acknowledgments ................................................<a href="#page-10">10</a>
   <a href="#section-7">7</a>. References .....................................................<a href="#page-11">11</a>
      <a href="#section-7.1">7.1</a>. Normative References ......................................<a href="#page-11">11</a>
      <a href="#section-7.2">7.2</a>. Informative References ....................................<a href="#page-11">11</a>



























<span class="grey">Wijnands, et al.             Standards Track                    [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction</span>

   The document [<a href="#ref-mLDP" title="&quot;Label Distribution Protocol Extensions for Point- to-Multipoint and Multipoint-to-Multipoint Label Switched Paths&quot;">mLDP</a>] extends LDP [<a href="#ref-LDP" title="&quot;LDP Specification&quot;">LDP</a>] to support multipoint Label
   Switched Paths.  These extensions are known as &quot;Multipoint LDP&quot;, or
   more simply, as &quot;mLDP&quot;.  [<a href="#ref-mLDP" title="&quot;Label Distribution Protocol Extensions for Point- to-Multipoint and Multipoint-to-Multipoint Label Switched Paths&quot;">mLDP</a>] defines several LDP Forwarding
   Equivalence Class (FEC) element encodings: &quot;Point-to-Multipoint&quot;
   (P2MP), &quot;Multipoint-to-Multipoint (MP2MP) Upstream&quot;, and &quot;MP2MP
   Downstream&quot;.

   The encoding for these three FEC elements, as defined in [<a href="#ref-mLDP" title="&quot;Label Distribution Protocol Extensions for Point- to-Multipoint and Multipoint-to-Multipoint Label Switched Paths&quot;">mLDP</a>], is
   shown in Figure 1.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Type      |        Address Family         | Address Length|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      ~                       Root Node Address                       ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    Opaque Length              |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      ~                                                               ~
      |                     Opaque Value                              |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 1: mLDP FEC Element Encoding

   Note that a P2MP or MP2MP Label Switched Path (&quot;MP LSP&quot;) is
   identified by the combination of a &quot;root node&quot; and a variable length
   &quot;opaque value&quot;.  The root node also plays a special role in the mLDP
   procedures:  mLDP messages that are &quot;about&quot; a particular MP LSP are
   forwarded to the LDP adjacency that is the next hop on the route to
   the root node.

   Sometimes, it is desirable for an MP LSP to pass through a part of
   the network in which there is no route to the root node.  For
   instance, consider the topology of Figure 2.

           CE1----PE1---P1---- ...----P2 ----PE2----CE2----R

                                Figure 2

   In Figure 2, CE1 and CE2 are &quot;Customer Edge routers&quot;, R is a customer
   router at the same VPN site as CE2, and PE1 and PE2 are &quot;Provider
   Edge routers&quot;.  Suppose that PE1 has a BGP-learned route for R, with




<span class="grey">Wijnands, et al.             Standards Track                    [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


   PE2 as the BGP next hop.  Suppose also that the provider&#x27;s interior
   routers (such as P1 and P2) do not have any BGP-learned routes and,
   in particular, do not have any routes to R.

   In such an environment, unicast data packets from CE1 addressed to R
   would get encapsulated by PE1, tunneled to PE2, decapsulated by PE2,
   and forwarded to CE2.

   Suppose now that CE1 is trying to set up an MP LSP whose root is R,
   and the intention is that the provider&#x27;s network will participate in
   the construction of the LSP.  Then, the mLDP messages identifying the
   LSP must be passed from CE1 to PE1, from PE1 to P1, ..., from P2 to
   PE2, from PE2 to CE2, and from CE2 to R.

   To begin the process, CE1 creates an MP FEC element with the address
   of R as the root node address and passes that FEC element via mLDP to
   PE1.  However, PE1 cannot use this same FEC element to identify the
   LSP in the LDP messages it sends to P1, because P1 does not have a
   route to R.

   However, PE1 does know that PE2 is the BGP next hop on the path to R.
   What is needed is a method whereby:

   -  PE1 can tell P1 to set up an LSP as if the root node were PE2,

   -  PE2 can determine that the LSP in question is really rooted at R,
      not at PE2 itself, and

   -  PE2 can determine the original FEC element that CE1 passed to PE1,
      so that PE2 can pass it on to CE2.

   This document defines the procedures that allow CE1 to create an LSP
   rooted at R.  These procedures require PE1 to modify the MP FEC
   element before sending an mLDP message to P1.  The modified FEC
   element has PE2 as the root and the original FEC element as the
   opaque value.  This requires a new type of opaque value.  Since the
   opaque value contains a FEC element, we call this a &quot;Recursive Opaque
   Value&quot;.  When PE2 sends an mLDP message to CE2, it replaces the FEC
   element with the opaque value, thus undoing the recursion.  Details
   are in <a href="#section-2">Section 2</a>.

   <a href="#section-3">Section 3</a> defines the &quot;VPN-Recursive Opaque Value&quot;.  Whereas the
   &quot;Recursive Opaque Value&quot; carries the original FEC, the &quot;VPN-Recursive
   Opaque Value&quot; carries the original FEC plus a Route Distinguisher
   (RD).  This is applicable when MP LSPs are being used to carry the
   multicast traffic of a VPN [<a href="#ref-MVPN" title="&quot;Multicast in MPLS/BGP IP VPNs&quot;">MVPN</a>].  Details are in <a href="#section-3">Section 3</a>.





<span class="grey">Wijnands, et al.             Standards Track                    [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
   document are to be interpreted as described in [<a href="/doc/html/rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  The Recursive Opaque Value</span>

<span class="h3"><a class="selflink" id="section-2.1" href="#section-2.1">2.1</a>.  Encoding</span>

   We define a new type of opaque value, the Recursive Opaque Value.
   This is a &quot;basic type&quot;, identified by a 1-octet type field.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Type = 7     |         Length                |               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
       ~                                                               ~
       |                 P2MP or MP2MP FEC Element                     |
       |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                      Figure 3: Recursive Opaque Value

   The value field of the Recursive Opaque Value is itself a P2MP or
   MP2MP FEC element, encoded exactly as specified in [<a href="#ref-mLDP" title="&quot;Label Distribution Protocol Extensions for Point- to-Multipoint and Multipoint-to-Multipoint Label Switched Paths&quot;">mLDP</a>], with a
   type field, a length field, and value field of its own.  The length
   of the Recursive Opaque Value thus includes the lengths of the type,
   length, and value fields of the contained FEC element.

<span class="h3"><a class="selflink" id="section-2.2" href="#section-2.2">2.2</a>.  Procedures</span>

   In the topology of Figure 2, let us suppose that CE1 sends PE1 an MP
   FEC element whose root node is R and whose opaque value is Q.  We
   will refer to this FEC element as &quot;CE1-FEC&quot;.  We may think of CE1-FEC
   as an ordered pair, as follows:

       CE1-FEC = &lt;root=R, opaque_value=Q&gt;.

   PE1 determines that the root node R matches a BGP route, with a BGP
   next hop of PE2.  PE1 also knows by its configuration that the
   interior routers on the path to PE2 are &quot;BGP-free&quot; and thus have no
   route to R.

   PE1 therefore creates a new MP FEC element, whose root node address
   is the address of PE2 and whose opaque value is a Recursive Opaque
   Value whose value field contains CE1-FEC.  We refer to this FEC
   element as PE2-FEC:



<span class="grey">Wijnands, et al.             Standards Track                    [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


       PE2-FEC = &lt;root=PE2, opaque_value=CE1-FEC&gt;, i.e.,

       PE2-FEC = &lt;root=PE2, opaque_value=&lt;root=R,
                                          opaque_value=Q&gt;&gt;

   PE1 then sends this FEC element to P1.

   As far as the interior routers are concerned, they are being
   requested to build an MP LSP whose root node is PE2.  They MUST NOT
   interpret the opaque value at all.

   When PE2-FEC arrives at PE2, PE2 notes that it (PE2) is the
   identified root node and that the opaque value is a Recursive Opaque
   Value.  Therefore, PE2 MUST replace PE2-FEC with the contents of the
   Recursive Opaque Value (i.e., with CE1-FEC) before doing any further
   processing.  This will result in CE1-FEC being sent on to CE2, and
   further from CE2 to R.  Note that CE1-FEC will contain the LSP root
   node specified by CE1; the presumption is that PE2 has a route to
   this root node.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  The VPN-Recursive Opaque Value</span>

<span class="h3"><a class="selflink" id="section-3.1" href="#section-3.1">3.1</a>.  Encoding</span>

   We define a new type of opaque value, the VPN-Recursive Opaque Value.
   This is a &quot;basic type&quot;, identified by a 1-octet type field.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Type = 8     |         Length                |               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
       |                                                               |
       |       Route Distinguisher (8 octets)          +-+-+-+-+-+-+-+-+
       |                                               |               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
       ~                                                               ~
       |                 P2MP or MP2MP FEC Element                     |
       |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                      Figure 4: VPN-Recursive Opaque Value








<span class="grey">Wijnands, et al.             Standards Track                    [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


   The value field of the VPN-Recursive Opaque Value consists of an
   8-octet Route Distinguisher (RD), followed by a P2MP or MP2MP FEC
   element, encoded exactly as specified in [<a href="#ref-mLDP" title="&quot;Label Distribution Protocol Extensions for Point- to-Multipoint and Multipoint-to-Multipoint Label Switched Paths&quot;">mLDP</a>], with a type field, a
   length field, and value field of is own.  The length of the
   VPN-Recursive Opaque Value thus includes the 8 octets of RD plus the

   lengths of the type, length, and values fields of the contained FEC
   element.

<span class="h3"><a class="selflink" id="section-3.2" href="#section-3.2">3.2</a>.  Procedures</span>

<span class="h4"><a class="selflink" id="section-3.2.1" href="#section-3.2.1">3.2.1</a>.  Non-Segmented Inter-AS P-Tunnels</span>

   Consider the inter-AS (Autonomous System) VPN scenario depicted in
   Figure 5.

           PE1 --- P1 ---- ASBR1 ... ASBR2 ---- P2 ---- PE2

                                Figure 5

   Suppose this is an &quot;option B&quot; VPN interconnect ([<a href="#ref-VPN" title="&quot;BGP/MPLS IP Virtual Private Networks (VPNs)&quot;">VPN</a>], Section 10).
   This means that the Autonomous System Border Router (ASBR) in the
   first Autonomous System (i.e., ASBR1) does not have a route to PE
   routers in other ASes (such as PE2).  Suppose also that the Multicast
   VPN (MVPN) policy is to instantiate Provider Multicast Service
   Interfaces (PMSIs) [<a href="#ref-MVPN" title="&quot;Multicast in MPLS/BGP IP VPNs&quot;">MVPN</a>] using mLDP and that &quot;non-segmented inter-AS
   P-tunnels&quot; [<a href="#ref-MVPN" title="&quot;Multicast in MPLS/BGP IP VPNs&quot;">MVPN</a>] are being used.

   In this scenario, PE1 may need to join a P2MP or MP2MP LSP whose root
   is PE2.  P1 has no route to PE2, and all PE1 knows about the route to
   PE2 is that ASBR1 is the BGP next hop.  Since P1 has no root to PE2,
   PE1 needs to originate an mLDP message with a FEC element that
   identifies ASBR1 as the root.  This FEC element must contain enough
   information to enable ASBR1 to find the next hop towards PE2 even
   though ASBR1 does not have a route to PE2.

   Although ASBR1 does not have a route to PE2, it does have a BGP
   Intra-AS Inclusive PMSI (I-PMSI) auto-discovery (A-D) route [<a href="#ref-MVPN" title="&quot;Multicast in MPLS/BGP IP VPNs&quot;">MVPN</a>]
   whose Network Layer Reachability Information (NLRI) contains PE2&#x27;s IP
   address together with a particular RD.  PE1 also has this Inter-AS
   I-PMSI A-D route.  The LSP needs to be set up along the path
   established by the Intra-AS I-PMSI A-D routes.  Therefore, one must
   use a Recursive FEC element that contains the RD as well as the
   address of PE2.  The &quot;VPN-Recursive FEC Element&quot; defined herein is
   used for this purpose.






<span class="grey">Wijnands, et al.             Standards Track                    [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


   This enables us to provide the same functionality for mLDP P-tunnels
   that is provided for PIM P-tunnels in Section 8.1.3.2 of [<a href="#ref-MVPN" title="&quot;Multicast in MPLS/BGP IP VPNs&quot;">MVPN</a>]
   through the use of the MVPN Join Attribute.

   At PE1 in Figure 4, the LSP to be created is associated with a
   particular VPN Routing and Forwarding Table (VRF).  PE1 looks up in
   that VRF the Intra-AS I-PMSI A-D route originated by PE2.  It finds
   that the BGP next hop of that route is ASBR1.  So, it creates a P2MP
   or MP2MP FEC element whose root is ASBR1 and whose opaque value is a
   VPN-Recursive FEC element.  The VPN-Recursive FEC element itself
   consists of a root, an RD, and an opaque value, set as follows:

   -  The root is PE2.

   -  The RD is the RD from the NLRI of the Intra-AS A-D route
      originated by PE2.

   -  The opaque value is chosen (by some method outside the scope of
      this document) so as to be unique in the context of PE2.  (For
      example, it may have been specified in a PMSI Tunnel Attribute
      originated by PE2.)  We will refer to this opaque value as &quot;Q&quot;.

   The resulting FEC element can be informally represented as

       &lt;root=ASBR1, opaque_value=&lt;root=PE2, RD, opaque_value=Q&gt;&gt;.

   PE1 can now begin setting up the LSP by using this FEC element in an
   LDP Label Mapping message sent towards ASBR1.

   When ASBR1 receives, over a non-VRF interface, an mLDP Label Mapping
   message containing this FEC element, it sees that it is the root and
   that the opaque value is a VPN-Recursive Opaque Value.  It parses the
   VPN-Recursive Opaque value and extracts the root value, PE2.

   If ASBR1 has a route to PE2, it continues setting up the LSP by using
   the following FEC element:

       &lt;root=PE2, opaque_value=Q&gt;

   However, if ASBR1 does not have a route to PE2, it looks for an
   Intra-AS I-PMSI A-D route whose NLRI contains PE2&#x27;s address along
   with the specified RD value.  Say the BGP next hop of that route is
   ASBR2.  Then ASBR1 continues setting up the LSP by using the
   following FEC element:

       &lt;root=ASBR2, opaque_value=&lt;root=PE2, RD, opaque_value=Q&gt;&gt;.





<span class="grey">Wijnands, et al.             Standards Track                    [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


   Note that in this case, the root has changed from ASBR1 to ASBR2, but
   the opaque value is the unchanged VPN-Recursive FEC element.

<span class="h4"><a class="selflink" id="section-3.2.2" href="#section-3.2.2">3.2.2</a>.  Limited Carrier&#x27;s Carrier Function</span>

   Another possible use of the VPN-Recursive FEC is to provide a limited
   version of &quot;Carrier&#x27;s Carrier Service&quot;.  Referring again to the
   topology of Figure 2, suppose that PE1/PE2 are offering &quot;Carrier&#x27;s
   Carrier VPN Service&quot; [<a href="#ref-VPN" title="&quot;BGP/MPLS IP Virtual Private Networks (VPNs)&quot;">VPN</a>] to CE1/CE2.  CE1 sends PE1 an MP FEC
   element whose root node is R and whose opaque value is Q.  We will
   refer to this FEC element as &quot;CE1-FEC&quot;.  However, PE1&#x27;s route to R
   will be in a VRF.  Therefore, the FEC element created by PE1 must
   contain some identifier that PE2 can use to find the proper VRF in
   which to look up the address of R.

   When PE1 looks up the address of R in a VRF, it will find a route in
   the VPN-IP address family.  The next hop will be PE2, but there will
   also be a Route Distinguisher (RD) as part of that NLRI of the
   matching route.  In this case, the new FEC element created by PE1 has
   the address of PE2 as the root node address and has a VPN-Recursive
   Opaque Value.  The value field of the VPN-Recursive Opaque Value
   consists of the 8-octet RD followed by CE1-FEC.

   As far as the interior routers are concerned, they are being
   requested to build an MP LSP whose root node is PE2.  They MUST NOT
   interpret the opaque value at all.

   When an mLDP Label Mapping message containing PE2-FEC arrives at PE2
   over a VRF interface, PE2 notes that it is the identified root node
   and that the opaque value is a VPN-Recursive Opaque Value.
   Therefore, it MUST replace PE2-FEC with the contents of the
   VPN-Recursive Opaque Value (i.e., with CE1-FEC) before doing any
   further processing.  It uses the VRF to look up the path to R.  This
   will result in CE1-FEC being sent on to CE2, and presumably further
   from CE2 to R.

   In this scenario, the RD in the VPN-Recursive Opaque Value also
   ensures uniqueness of the FEC element within the inner carrier&#x27;s
   network.

   This way of providing Carrier&#x27;s Carrier service has limited
   applicability, as it only works under the following conditions:

   -  Both the inner carrier and the outer carrier are using non-
      segmented mLDP P-tunnels.






<span class="grey">Wijnands, et al.             Standards Track                    [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


   -  The inner carrier is not aggregating the P-tunnels of the outer
      carrier but is content to carry each such P-tunnel in a single
      P-tunnel of its own.

   The Carrier&#x27;s Carrier scenario can be distinguished from the inter-AS
   scenario by the fact that in the former, the mLDP messages are being
   exchanged on VRF interfaces.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  IANA Considerations</span>

   [<a id="ref-mLDP">mLDP</a>] defines a registry for &quot;The LDP MP Opaque Value Element Basic
   Type&quot;.  Two new code points have been assigned in this registry:

   -  Recursive Opaque Value: Type 7

      An opaque value of this type is itself a TLV that encodes an mLDP
      FEC type, as defined in [<a href="#ref-mLDP" title="&quot;Label Distribution Protocol Extensions for Point- to-Multipoint and Multipoint-to-Multipoint Label Switched Paths&quot;">mLDP</a>].

   -  VPN-Recursive Opaque Value: Type 8

      An opaque value of this type consists of an 8-octet Route
      Distinguisher as defined in [<a href="#ref-VPN" title="&quot;BGP/MPLS IP Virtual Private Networks (VPNs)&quot;">VPN</a>], followed by a TLV that encodes
      an mLDP FEC type, as defined in [<a href="#ref-mLDP" title="&quot;Label Distribution Protocol Extensions for Point- to-Multipoint and Multipoint-to-Multipoint Label Switched Paths&quot;">mLDP</a>].

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  Security Considerations</span>

   The security considerations of [<a href="#ref-LDP" title="&quot;LDP Specification&quot;">LDP</a>] and [<a href="#ref-mLDP" title="&quot;Label Distribution Protocol Extensions for Point- to-Multipoint and Multipoint-to-Multipoint Label Switched Paths&quot;">mLDP</a>] apply.

   Unauthorized modification of the FEC elements defined in this
   document can disrupt the creation of the multipoint LSPs or can cause
   the multipoint LSPs to pass through parts of the network where they
   are not supposed to go.  This could potentially be used as part of an
   attack to illegitimately insert or intercept multicast traffic.
   However, since the FEC elements defined in this document are not
   inherently more vulnerable to this form of attack than are the
   previously defined FEC elements, this document does not add new
   security vulnerabilities.

   A description of general security issues for MPLS can be found in
   [<a href="/doc/html/rfc5920" title="&quot;Security Framework for MPLS and GMPLS Networks&quot;">RFC5920</a>].

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Acknowledgments</span>

   The authors wish to thank Toerless Eckert for his contribution to
   this work.






<span class="grey">Wijnands, et al.             Standards Track                   [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  References</span>

<span class="h3"><a class="selflink" id="section-7.1" href="#section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-LDP">LDP</a>]     Andersson, L., Ed., Minei, I., Ed., and B. Thomas, Ed.,
             &quot;LDP Specification&quot;, <a href="/doc/html/rfc5036">RFC 5036</a>, October 2007.

   [<a id="ref-mLDP">mLDP</a>]    Wijnands, IJ., Ed., Minei, I., Ed., Kompella, K., and B.
             Thomas, &quot;Label Distribution Protocol Extensions for Point-
             to-Multipoint and Multipoint-to-Multipoint Label Switched
             Paths&quot;, <a href="/doc/html/rfc6388">RFC 6388</a>, November 2011.

   [<a id="ref-MVPN">MVPN</a>]    Rosen, E., Ed., and R. Aggarwal, Ed., &quot;Multicast in
             MPLS/BGP IP VPNs&quot;, <a href="/doc/html/rfc6513">RFC 6513</a>, February 2012.

   [<a id="ref-RFC2119">RFC2119</a>] Bradner, S., &quot;Key words for use in RFCs to Indicate
             Requirement Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-VPN">VPN</a>]     Rosen, E. and Y. Rekhter, &quot;BGP/MPLS IP Virtual Private
             Networks (VPNs)&quot;, <a href="/doc/html/rfc4364">RFC 4364</a>, February 2006.

<span class="h3"><a class="selflink" id="section-7.2" href="#section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-RFC5920">RFC5920</a>] Fang, L., Ed., &quot;Security Framework for MPLS and GMPLS
             Networks&quot;, <a href="/doc/html/rfc5920">RFC 5920</a>, July 2010.


























<span class="grey">Wijnands, et al.             Standards Track                   [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="/doc/html/rfc6512">RFC 6512</a>         Using mLDP with Recursive Opaque Values   February 2012</span>


Authors&#x27; Addresses

   IJsbrand Wijnands
   Cisco Systems, Inc.
   De kleetlaan 6a Diegem 1831
   Belgium
   EMail: ice@cisco.com

   Eric C. Rosen
   Cisco Systems, Inc.
   1414 Massachusetts Avenue
   Boxborough, MA  01719
   EMail: erosen@cisco.com

   Maria Napierala
   AT&amp;T Labs
   200 Laurel Avenue
   Middletown, NJ  07748
   EMail: mnapierala@att.com

   Nicolai Leymann
   Deutsche Telekom
   Winterfeldtstrasse 21
   Berlin  10781
   Germany
   EMail: n.leymann@telekom.de

























Wijnands, et al.             Standards Track                   [Page 12]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

