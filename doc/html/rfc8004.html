<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc8004
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-hip-rfc5204-bis/">
  <meta name="description" content="Host Identity Protocol (HIP) Rendezvous Extension (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc8004.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc8004.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc8004.txt.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/rfc8004/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc8004/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/hip/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-hip-rfc5204-bis@ietf.org?subject=draft-ietf-hip-rfc5204-bis" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-hip-rfc5204-bis-08.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-hip-rfc5204-bis-08.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-hip-rfc5204-bis-08.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-ietf-hip-rfc5204-bis-08">draft-ietf-hip-rfc5204-bis-08</a>                    Proposed Standard</pre>
      </div>
    

    <div class="draftcontent">
    <pre>Internet Engineering Task Force (IETF)                       J. Laganier
Request for Comments: 8004                       Luminate Wireless, Inc.
Obsoletes: <a href="/doc/html/rfc5204">5204</a>                                                L. Eggert
Category: Standards Track                                         NetApp
ISSN: 2070-1721                                             October 2016


           <span class="h1">Host Identity Protocol (HIP) Rendezvous Extension</span>

Abstract

   This document defines a rendezvous extension for the Host Identity
   Protocol (HIP).  The rendezvous extension extends HIP and the HIP
   Registration Extension for initiating communication between HIP nodes
   via HIP rendezvous servers.  Rendezvous servers improve reachability
   and operation when HIP nodes are multihomed or mobile.  This document
   obsoletes <a href="/doc/html/rfc5204">RFC 5204</a>.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="/doc/html/rfc7841#section-2">Section&nbsp;2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc8004">http://www.rfc-editor.org/info/rfc8004</a>.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust&#x27;s Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  Overview of Rendezvous Server Operation . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-3.1">3.1</a>.  Diagram Notation  . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-3.2">3.2</a>.  Rendezvous Client Registration  . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-3.3">3.3</a>.  Relaying the Base Exchange  . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-4">4</a>.  Rendezvous Server Extensions  . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-4.1">4.1</a>.  RENDEZVOUS Registration Type  . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-4.2">4.2</a>.  Parameter Formats and Processing  . . . . . . . . . . . .   <a href="#page-7">7</a>
       <a href="#section-4.2.1">4.2.1</a>.  RVS_HMAC Parameter  . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
       <a href="#section-4.2.2">4.2.2</a>.  FROM Parameter  . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
       <a href="#section-4.2.3">4.2.3</a>.  VIA_RVS Parameter . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-4.3">4.3</a>.  Modified Packets Processing . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
       <a href="#section-4.3.1">4.3.1</a>.  Processing Outgoing I1 Packets  . . . . . . . . . . .   <a href="#page-9">9</a>
       <a href="#section-4.3.2">4.3.2</a>.  Processing Incoming I1 Packets  . . . . . . . . . . .  <a href="#page-10">10</a>
       <a href="#section-4.3.3">4.3.3</a>.  Processing Outgoing R1 Packets  . . . . . . . . . . .  <a href="#page-10">10</a>
       <a href="#section-4.3.4">4.3.4</a>.  Processing Incoming R1 Packets  . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-5">5</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-6">6</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-7">7</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-7.1">7.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-7.2">7.2</a>.  Informative References  . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#appendix-A">Appendix A</a>.  Changes from <a href="/doc/html/rfc5204">RFC 5204</a>  . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   Authors&#x27; Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction</span>

   &quot;The Host Identity Protocol (HIP) Architecture&quot; [<a href="#ref-HIP-ARCH" title="&quot;Host Identity Protocol Architecture&quot;">HIP-ARCH</a>] introduces
   the rendezvous mechanism to help a HIP node to contact a frequently
   moving HIP node.  The rendezvous mechanism involves a third party,
   the rendezvous server (RVS), which serves as an initial contact point
   (&quot;rendezvous point&quot;) for its clients.  The clients of an RVS are HIP
   nodes that use the HIP Registration Extension [<a href="/doc/html/rfc8003" title="&quot;Host Identity Protocol (HIP) Registration Extension&quot;">RFC8003</a>] to register
   their HIT-&gt;IP address mappings with the RVS.  After this
   registration, other HIP nodes can initiate a base exchange using the
   IP address of the RVS instead of the current IP address of the node
   they attempt to contact.  Essentially, the clients of an RVS become
   reachable at the RVS&#x27;s IP address.  Peers can initiate a HIP base
   exchange with the IP address of the RVS, which will relay this
   initial communication such that the base exchange may successfully
   complete.







<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Terminology</span>

   This section defines terms used throughout the remainder of this
   specification.

   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
   document are to be interpreted as described in <a href="/doc/html/rfc2119">RFC 2119</a> [<a href="/doc/html/rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].

   In addition to the terminology defined in the HIP specification
   [<a href="/doc/html/rfc7401" title="&quot;Host Identity Protocol Version 2 (HIPv2)&quot;">RFC7401</a>] and the HIP Registration Extension [<a href="/doc/html/rfc8003" title="&quot;Host Identity Protocol (HIP) Registration Extension&quot;">RFC8003</a>], this document
   defines and uses the following terms:

   Rendezvous Service
      A HIP service provided by an RVS to its rendezvous clients.  The
      RVS offers to relay some of the arriving base exchange packets
      between the Initiator and Responder.

   Rendezvous Server (RVS)
      A HIP registrar providing rendezvous service.

   Rendezvous Client
      A HIP requester that has registered for rendezvous service at an
      RVS.

   Rendezvous Registration
      A HIP registration for rendezvous service, established between an
      RVS and a rendezvous client.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Overview of Rendezvous Server Operation</span>

   Figure 1 shows a simple HIP base exchange without an RVS, in which
   the Initiator initiates the exchange directly with the Responder by
   sending an I1 packet to the Responder&#x27;s IP address, as per the HIP
   specification [<a href="/doc/html/rfc7401" title="&quot;Host Identity Protocol Version 2 (HIPv2)&quot;">RFC7401</a>].

                      +-----+                +-----+
                      |     |-------I1------&gt;|     |
                      |  I  |&lt;------R1-------|  R  |
                      |     |-------I2------&gt;|     |
                      |     |&lt;------R2-------|     |
                      +-----+                +-----+

          Figure 1: HIP Base Exchange without a Rendezvous Server







<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


   The End-Host Mobility and Multihoming with the HIP specification
   [<a href="#ref-HIP-HOST-MOB">HIP-HOST-MOB</a>] allows a HIP node to notify its peers about changes in
   its set of IP addresses.  This specification presumes initial
   reachability of the two nodes with respect to each other.

   However, such a HIP node MAY also want to be reachable to other
   future correspondent peers that are unaware of its location change.
   The HIP Architecture [<a href="#ref-HIP-ARCH" title="&quot;Host Identity Protocol Architecture&quot;">HIP-ARCH</a>] introduces RVSs with whom a HIP node
   MAY register its Host Identity Tags (HITs) and current IP addresses.
   An RVS relays HIP packets arriving for these HITs to the node&#x27;s
   registered IP addresses.  When a HIP node has registered with an RVS,
   it SHOULD record the IP address of its RVS in its DNS record, using
   the HIP DNS resource record type defined in the HIP DNS Extension
   [<a href="/doc/html/rfc8005" title="&quot;Host Identity Protocol (HIP) Domain Name System (DNS) Extension&quot;">RFC8005</a>].

                                  +-----+
                         +--I1---&gt;| RVS |---I1--+
                         |        +-----+       |
                         |                      v
                      +-----+                +-----+
                      |     |&lt;------R1-------|     |
                      |  I  |-------I2------&gt;|  R  |
                      |     |&lt;------R2-------|     |
                      +-----+                +-----+

           Figure 2: HIP Base Exchange with a Rendezvous Server

   Figure 2 shows a HIP base exchange involving an RVS.  It is assumed
   that HIP node R previously registered its HITs and current IP
   addresses with the RVS, using the HIP Registration Extension
   [<a href="/doc/html/rfc8003" title="&quot;Host Identity Protocol (HIP) Registration Extension&quot;">RFC8003</a>].  When the Initiator I tries to establish contact with the
   Responder R, it must send the I1 of the base exchange either to one
   of R&#x27;s IP addresses (if known via DNS or other means) or to one of
   R&#x27;s RVSs.  Here, I obtains the IP address of R&#x27;s RVS from R&#x27;s DNS
   record and then sends the I1 packet of the HIP base exchange to RVS.
   RVS, noticing that the HIT contained in the arriving I1 packet is not
   one of its own, MUST check its current registrations to determine if
   it needs to relay the packets.  Here, it determines that the HIT
   belongs to R and then relays the I1 packet to the registered IP
   address.  R then completes the base exchange without further
   assistance from RVS by sending an R1 directly to the I&#x27;s IP address,
   as obtained from the I1 packet.  In this specification, the client of
   the RVS is always the Responder.  However, there might be reasons
   (such as NAT and firewall traversal) to allow a client to initiate a
   base exchange through its own RVS.  This specification does not
   address such scenarios, which should be specified in other documents.





<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


<span class="h3"><a class="selflink" id="section-3.1" href="#section-3.1">3.1</a>.  Diagram Notation</span>

   Notation       Significance
   --------       ------------

   I, R           I and R are the respective source and destination IP
                  addresses in the IP header.

   HIT-I, HIT-R   HIT-I and HIT-R are the Initiator&#x27;s and the
                  Responder&#x27;s HITs in the packet, respectively.

   REG_REQ        A REG_REQUEST parameter is present in the HIP header.

   REG_RES        A REG_RESPONSE parameter is present in the HIP header.

   FROM:I         A FROM parameter containing the IP address I is
                  present in the HIP header.

   RVS_HMAC       An RVS_HMAC parameter containing an Hashed Message
                  Authentication Code (HMAC) keyed with the appropriate
                  registration key is present in the HIP header.

   VIA:RVS        A VIA_RVS parameter containing the IP address RVS of
                  a rendezvous server is present in the HIP header.

<span class="h3"><a class="selflink" id="section-3.2" href="#section-3.2">3.2</a>.  Rendezvous Client Registration</span>

   Before an RVS starts to relay HIP packets to a rendezvous client, the
   rendezvous client needs to register with the RVS to receive
   rendezvous service by using the HIP Registration Extension [<a href="/doc/html/rfc8003" title="&quot;Host Identity Protocol (HIP) Registration Extension&quot;">RFC8003</a>]
   as illustrated in the following schema:

                +-----+                            +-----+
                |     |            I1              |     |
                |     |---------------------------&gt;|     |
                |     |&lt;---------------------------|     |
                |  I  |         R1(REG_INFO)       | RVS |
                |     |         I2(REG_REQ)        |     |
                |     |---------------------------&gt;|     |
                |     |&lt;---------------------------|     |
                |     |         R2(REG_RES)        |     |
                +-----+                            +-----+

          Rendezvous Client Registering with a Rendezvous Server







<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


<span class="h3"><a class="selflink" id="section-3.3" href="#section-3.3">3.3</a>.  Relaying the Base Exchange</span>

   If a HIP node and one of its RVSs have a rendezvous registration, the
   RVSs relay inbound I1 packets (that contain one of the client&#x27;s HITs)
   by rewriting the IP header.  They replace the destination IP address
   of the I1 packet with one of the IP addresses of the owner of the
   HIT, i.e., the rendezvous client.  They MUST also recompute the IP
   checksum accordingly.

   Because of ingress filtering on the path from the RVS to the client
   [<a href="/doc/html/rfc2827" title="&quot;Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing&quot;">RFC2827</a>] [<a href="/doc/html/rfc3013" title="&quot;Recommended Internet Service Provider Security Services and Procedures&quot;">RFC3013</a>], a HIP RVS SHOULD replace the source IP address,
   i.e., the IP address of I, with one of its own IP addresses.  The
   replacement IP address SHOULD be chosen according to relevant IPv4
   and IPv6 specifications [<a href="/doc/html/rfc1122" title="&quot;Requirements for Internet Hosts - Communication Layers&quot;">RFC1122</a>] [<a href="/doc/html/rfc6724" title="&quot;Default Address Selection for Internet Protocol Version 6 (IPv6)&quot;">RFC6724</a>].  Because this
   replacement conceals the Initiator&#x27;s IP address, the RVS MUST append
   a FROM parameter containing the original source IP address of the
   packet.  This FROM parameter MUST be integrity protected by an
   RVS_HMAC keyed with the corresponding rendezvous registration
   integrity key [<a href="/doc/html/rfc8003" title="&quot;Host Identity Protocol (HIP) Registration Extension&quot;">RFC8003</a>].

                                             I1(RVS, R, HIT-I, HIT-R
       I1(I, RVS, HIT-I, HIT-R) +---------+     FROM:I, RVS_HMAC)
       +-----------------------&gt;|         |--------------------+
       |                        |   RVS   |                    |
       |                        |         |                    |
       |                        +---------+                    |
       |                                                       V
      +-----+        R1(R, I, HIT-R, HIT-I, VIA:RVS)       +-----+
      |     |&lt;---------------------------------------------|     |
      |     |                                              |     |
      |  I  |            I2(I, R, HIT-I, HIT-R)            |  R  |
      |     |---------------------------------------------&gt;|     |
      |     |&lt;---------------------------------------------|     |
      +-----+             R2(R, I, HIT-R, HIT-I)           +-----+

                 Rendezvous Server Rewriting IP Addresses

   This modification of HIP packets at an RVS can be problematic because
   HIP uses integrity checks.  Because the I1 does not include HMAC or
   SIGNATURE parameters, these two end-to-end integrity checks are
   unaffected by the operation of RVSs.

   The RVS SHOULD verify the checksum field of an I1 packet before doing
   any modifications.  After modification, it MUST recompute the
   checksum field using the updated HIP header, which possibly included
   new FROM and RVS_HMAC parameters, and a pseudo-header containing the





<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


   updated source and destination IP addresses.  This enables the
   Responder to validate the checksum of the I1 packet &quot;as is&quot;, without
   having to parse any FROM parameters.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  Rendezvous Server Extensions</span>

   This section describes extensions to the HIP Registration Extension
   [<a href="/doc/html/rfc8003" title="&quot;Host Identity Protocol (HIP) Registration Extension&quot;">RFC8003</a>], allowing a HIP node to register with an RVS for rendezvous
   service and to notify the RVS aware of changes to its current
   location.  It also describes an extension to the HIP specification
   [<a href="/doc/html/rfc7401" title="&quot;Host Identity Protocol Version 2 (HIPv2)&quot;">RFC7401</a>] itself, allowing establishment of HIP associations via one
   or more HIP RVSs.

<span class="h3"><a class="selflink" id="section-4.1" href="#section-4.1">4.1</a>.  RENDEZVOUS Registration Type</span>

   This specification defines an additional registration for the HIP
   Registration Extension [<a href="/doc/html/rfc8003" title="&quot;Host Identity Protocol (HIP) Registration Extension&quot;">RFC8003</a>] that allows registering with an RVS
   for rendezvous service.

   Number   Registration Type
   ------   -----------------
   1        RENDEZVOUS

<span class="h3"><a class="selflink" id="section-4.2" href="#section-4.2">4.2</a>.  Parameter Formats and Processing</span>

<span class="h4"><a class="selflink" id="section-4.2.1" href="#section-4.2.1">4.2.1</a>.  RVS_HMAC Parameter</span>

   The RVS_HMAC is a non-critical parameter whose only difference with
   the HMAC parameter defined in the HIP specification [<a href="/doc/html/rfc7401" title="&quot;Host Identity Protocol Version 2 (HIPv2)&quot;">RFC7401</a>] is its
   &quot;type&quot; code.  This change causes it to be located after the FROM
   parameter (as opposed to the HMAC):

   Type        65500
   Length      Variable.  Length in octets, excluding Type, Length, and
               Padding.

   HMAC        HMAC computed over the HIP packet, excluding the
               RVS_HMAC parameter and any following parameters.  The
               HMAC is keyed with the appropriate HIP integrity key
               (HIP-lg or HIP-gl) established when rendezvous
               registration happened.  The HIP &quot;checksum&quot; field MUST be
               set to zero, and the HIP header length in the HIP common
               header MUST be calculated not to cover any excluded
               parameter when the HMAC is calculated.  The size of the
               HMAC is the natural size of the hash computation
               output depending on the used hash function.





<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


   To allow a rendezvous client and its RVS to verify the integrity of
   packets flowing between them, both SHOULD protect packets with an
   added RVS_HMAC parameter keyed with the HIP-lg or HIP-gl integrity
   key established while registration occurred.  A valid RVS_HMAC SHOULD
   be present on every packet flowing between a client and a server and
   MUST be present when a FROM parameter is processed.

<span class="h4"><a class="selflink" id="section-4.2.2" href="#section-4.2.2">4.2.2</a>.  FROM Parameter</span>

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |             Type              |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                             Address                           |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    Type        65498
    Length      16
    Address     An IPv6 address or an IPv4-in-IPv6 format IPv4 address.

   An RVS MUST add a FROM parameter containing the original source IP
   address of a HIP packet whenever the source IP address in the IP
   header is rewritten.  If one or more FROM parameters are already
   present, the new FROM parameter MUST be appended after the existing
   ones.

   Whenever an RVS inserts a FROM parameter, it MUST insert an RVS_HMAC
   protecting the packet integrity, especially the IP address included
   in the FROM parameter.


















<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


<span class="h4"><a class="selflink" id="section-4.2.3" href="#section-4.2.3">4.2.3</a>.  VIA_RVS Parameter</span>

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |             Type              |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                            Address                            |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                               .                               .
    .                               .                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                            Address                            |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    Type        65502
    Length      Variable
    Address     An IPv6 address or an IPv4-in-IPv6 format IPv4 address.

   After the Responder receives a relayed I1 packet, it can begin to
   send HIP packets addressed to the Initiator&#x27;s IP address, without
   further assistance from an RVS.  For debugging purposes, it MUST
   append a newly created VIA_RVS parameter at the end of the R1 packet
   that contains the IP address of the RVS that relayed the I1 packet.
   Including more than one IP address in the VIA_RVS parameter is
   outside the scope of this specification.  The main goal of using the
   VIA_RVS parameter is to allow operators to diagnose possible issues
   encountered while establishing a HIP association via an RVS.

<span class="h3"><a class="selflink" id="section-4.3" href="#section-4.3">4.3</a>.  Modified Packets Processing</span>

   The following subsections describe the differences of the processing
   of I1 and R1 while an RVS is involved in the base exchange.

<span class="h4"><a class="selflink" id="section-4.3.1" href="#section-4.3.1">4.3.1</a>.  Processing Outgoing I1 Packets</span>

   An Initiator SHOULD NOT send an opportunistic I1 with a NULL
   destination HIT to an IP address that is known to be a rendezvous
   server address, unless it wants to establish a HIP association with
   the RVS itself and does not know its HIT.





<span class="grey">Laganier &amp; Eggert            Standards Track                    [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


   When an RVS rewrites the source IP address of an I1 packet due to
   egress filtering, it MUST add a FROM parameter to the I1 that
   contains the Initiator&#x27;s source IP address.  This FROM parameter MUST
   be protected by an RVS_HMAC keyed with the integrity key established
   at rendezvous registration.

<span class="h4"><a class="selflink" id="section-4.3.2" href="#section-4.3.2">4.3.2</a>.  Processing Incoming I1 Packets</span>

   When an RVS receives an I1 whose destination HIT is not its own, it
   consults its registration database to find a registration for the
   rendezvous service established by the HIT owner.  If it finds an
   appropriate registration, it relays the packet to the registered IP
   address.  If it does not find an appropriate registration, it drops
   the packet.

   An RVS SHOULD interpret any incoming opportunistic I1 (i.e., an I1
   with a NULL destination HIT) as an I1 addressed to itself and SHOULD
   NOT attempt to relay it to one of its clients.

   When a rendezvous client receives an I1, it MUST validate any present
   RVS_HMAC parameter.  If the RVS_HMAC cannot be verified, the packet
   SHOULD be dropped.  If the RVS_HMAC cannot be verified and a FROM
   parameter is present, the packet MUST be dropped.

   A rendezvous client acting as Responder SHOULD drop opportunistic I1s
   that include a FROM parameter, because this indicates that the I1 has
   been relayed.

<span class="h4"><a class="selflink" id="section-4.3.3" href="#section-4.3.3">4.3.3</a>.  Processing Outgoing R1 Packets</span>

   When a Responder replies to an I1 relayed via an RVS, it MUST append
   to the regular R1 header a VIA_RVS parameter containing the IP
   addresses of the traversed RVSs.

<span class="h4"><a class="selflink" id="section-4.3.4" href="#section-4.3.4">4.3.4</a>.  Processing Incoming R1 Packets</span>

   The HIP specification [<a href="/doc/html/rfc7401" title="&quot;Host Identity Protocol Version 2 (HIPv2)&quot;">RFC7401</a>] mandates that a system receiving an
   R1 MUST first check to see if it has sent an I1 to the originator of
   the R1 (i.e., the system is in state I1-SENT).  When the R1 is
   replying to a relayed I1, this check SHOULD be based on HITs only.
   In case the IP addresses are also checked, then the source IP address
   MUST be checked against the IP address included in the VIA_RVS
   parameter.








<span class="grey">Laganier &amp; Eggert            Standards Track                   [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  Security Considerations</span>

   This section discusses the known threats introduced by these HIP
   extensions and the implications on the overall security of HIP.  In
   particular, it argues that the extensions described in this document
   do not introduce additional threats to HIP.

   It is difficult to encompass the whole scope of threats introduced by
   RVSs because their presence has implications both at the IP and HIP
   layers.  In particular, these extensions might allow for redirection,
   amplification, and reflection attacks at the IP layer, as well as
   attacks on the HIP layer itself, for example, man-in-the-middle
   attacks against the HIP base exchange.

   If an Initiator has a priori knowledge of the Responder&#x27;s host
   identity when it first contacts the Responder via an RVS, it has a
   means to verify the signatures in the HIP base exchange, which
   protects against man-in-the-middle attacks.

   If an Initiator does not have a priori knowledge of the Responder&#x27;s
   host identity (so-called &quot;opportunistic Initiators&quot;), it is almost
   impossible to defend the HIP exchange against these attacks, because
   the public keys exchanged cannot be authenticated.  The only approach
   would be to mitigate hijacking threats on HIP state by requiring an
   R1 answering an opportunistic I1 to come from the same IP address
   that originally sent the I1.  This procedure retains a level of
   security that is equivalent to what exists in the Internet today.

   However, for reasons of simplicity, this specification does not allow
   the establishment of a HIP association via an RVS in an opportunistic
   manner.

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  IANA Considerations</span>

   [<a href="/doc/html/rfc5204" title="&quot;Host Identity Protocol (HIP) Rendezvous Extension&quot;">RFC5204</a>], obsoleted by this document, made the following definitions
   and reservations in the &quot;Parameter Types&quot; subregistry under &quot;Host
   Identity Protocol (HIP) Parameters&quot;:

   Value   Parameter Type  Length
   -----   --------------  --------
   65498   FROM            16
   65500   RVS_HMAC        variable
   65502   VIA_RVS         variable

   In the &quot;Parameter Types&quot; subregistry under &quot;Host Identity Protocol
   (HIP) Parameters&quot;, references to [<a href="/doc/html/rfc5204" title="&quot;Host Identity Protocol (HIP) Rendezvous Extension&quot;">RFC5204</a>] have been replaced by
   references to this document.




<span class="grey">Laganier &amp; Eggert            Standards Track                   [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


   [<a href="/doc/html/rfc5204" title="&quot;Host Identity Protocol (HIP) Rendezvous Extension&quot;">RFC5204</a>], obsoleted by this document, made the following definition
   and reservation in the &quot;Registration Types&quot; subregistry under &quot;Host
   Identity Protocol (HIP) Parameters&quot;:

   Value   Registration Type
   -----   -----------------
   1       RENDEZVOUS

   In the &quot;Registration Types&quot; subregistry under &quot;Host Identity Protocol
   (HIP) Parameters&quot;, references to [<a href="/doc/html/rfc5204" title="&quot;Host Identity Protocol (HIP) Rendezvous Extension&quot;">RFC5204</a>] have been replaced by
   references to this document.

<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  References</span>

<span class="h3"><a class="selflink" id="section-7.1" href="#section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-RFC1122">RFC1122</a>]  Braden, R., Ed., &quot;Requirements for Internet Hosts -
              Communication Layers&quot;, STD 3, <a href="/doc/html/rfc1122">RFC 1122</a>,
              DOI 10.17487/RFC1122, October 1989,
              &lt;<a href="http://www.rfc-editor.org/info/rfc1122">http://www.rfc-editor.org/info/rfc1122</a>&gt;.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., &quot;Key words for use in RFCs to Indicate
              Requirement Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC6724">RFC6724</a>]  Thaler, D., Ed., Draves, R., Matsumoto, A., and T. Chown,
              &quot;Default Address Selection for Internet Protocol Version 6
              (IPv6)&quot;, <a href="/doc/html/rfc6724">RFC 6724</a>, DOI 10.17487/RFC6724, September 2012,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6724">http://www.rfc-editor.org/info/rfc6724</a>&gt;.

   [<a id="ref-RFC7401">RFC7401</a>]  Moskowitz, R., Ed., Heer, T., Jokela, P., and T.
              Henderson, &quot;Host Identity Protocol Version 2 (HIPv2)&quot;,
              <a href="/doc/html/rfc7401">RFC 7401</a>, DOI 10.17487/RFC7401, April 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7401">http://www.rfc-editor.org/info/rfc7401</a>&gt;.

   [<a id="ref-RFC8003">RFC8003</a>]  Laganier, J. and L. Eggert, &quot;Host Identity Protocol (HIP)
              Registration Extension&quot;, <a href="/doc/html/rfc8003">RFC 8003</a>, DOI 10.17487/RFC8003,
              October 2016, &lt;<a href="http://www.rfc-editor.org/info/rfc8003">http://www.rfc-editor.org/info/rfc8003</a>&gt;.

   [<a id="ref-RFC8005">RFC8005</a>]  Laganier, J., &quot;Host Identity Protocol (HIP) Domain Name
              System (DNS) Extension&quot;, <a href="/doc/html/rfc8005">RFC 8005</a>, DOI 10.17487/RFC8005,
              October 2016, &lt;<a href="http://www.rfc-editor.org/info/rfc8005">http://www.rfc-editor.org/info/rfc8005</a>&gt;.








<span class="grey">Laganier &amp; Eggert            Standards Track                   [Page 12]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-13" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


<span class="h3"><a class="selflink" id="section-7.2" href="#section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-HIP-ARCH">HIP-ARCH</a>] Moskowitz, R. and M. Komu, &quot;Host Identity Protocol
              Architecture&quot;, Work in Progress, <a href="/doc/html/draft-ietf-hip-rfc4423-bis-14">draft-ietf-hip-rfc4423-</a>
              <a href="/doc/html/draft-ietf-hip-rfc4423-bis-14">bis-14</a>, June 2016.

   [<a id="ref-HIP-HOST-MOB">HIP-HOST-MOB</a>]
              Henderson, T., Vogt, C., and J. Arkko, &quot;Host Mobility with
              the Host Identity Protocol&quot;, Work in Progress, <a href="/doc/html/draft-ietf-hip-rfc5206-bis-14">draft-ietf-</a>
              <a href="/doc/html/draft-ietf-hip-rfc5206-bis-14">hip-rfc5206-bis-14</a>, October 2016.

   [<a id="ref-RFC2827">RFC2827</a>]  Ferguson, P. and D. Senie, &quot;Network Ingress Filtering:
              Defeating Denial of Service Attacks which employ IP Source
              Address Spoofing&quot;, <a href="/doc/html/bcp38">BCP 38</a>, <a href="/doc/html/rfc2827">RFC 2827</a>, DOI 10.17487/RFC2827,
              May 2000, &lt;<a href="http://www.rfc-editor.org/info/rfc2827">http://www.rfc-editor.org/info/rfc2827</a>&gt;.

   [<a id="ref-RFC3013">RFC3013</a>]  Killalea, T., &quot;Recommended Internet Service Provider
              Security Services and Procedures&quot;, <a href="/doc/html/bcp46">BCP 46</a>, <a href="/doc/html/rfc3013">RFC 3013</a>,
              DOI 10.17487/RFC3013, November 2000,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3013">http://www.rfc-editor.org/info/rfc3013</a>&gt;.

   [<a id="ref-RFC5204">RFC5204</a>]  Laganier, J. and L. Eggert, &quot;Host Identity Protocol (HIP)
              Rendezvous Extension&quot;, <a href="/doc/html/rfc5204">RFC 5204</a>, DOI 10.17487/RFC5204,
              April 2008, &lt;<a href="http://www.rfc-editor.org/info/rfc5204">http://www.rfc-editor.org/info/rfc5204</a>&gt;.



























<span class="grey">Laganier &amp; Eggert            Standards Track                   [Page 13]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-14" ></span>
<span class="grey"><a href="/doc/html/rfc8004">RFC 8004</a>                HIP Rendezvous Extension            October 2016</span>


<span class="h2"><a class="selflink" id="appendix-A" href="#appendix-A">Appendix A</a>.  Changes from <a href="/doc/html/rfc5204">RFC 5204</a></span>

   o  Updated HIP references to revised HIP specifications.

Acknowledgments

   The following people have provided thoughtful and helpful discussions
   and/or suggestions that have improved this document: Marcus Brunner,
   Tom Henderson, Miika Komu, Mika Kousa, Pekka Nikander, Juergen
   Quittek, Justino Santos, Simon Schuetz, Tim Shepard, Kristian Slavov,
   and Martin Stiemerling.

   Lars Eggert has received funding from the European Union&#x27;s Horizon
   2020 research and innovation program 2014-2018 under grant agreement
   No. 644866.  This document reflects only the authors&#x27; views, and the
   European Commission is not responsible for any use that may be made
   of the information it contains.

   Thanks to Joel M. Halpern for performing the Gen-ART review of this
   document as part of the publication process.

Authors&#x27; Addresses

   Julien Laganier
   Luminate Wireless, Inc.
   Cupertino, CA
   United States of America

   Email: julien.ietf@gmail.com


   Lars Eggert
   NetApp
   Sonnenallee 1
   Kirchheim  85551
   Germany

   Phone: +49 151 12055791
   Email: lars@netapp.com
   URI:   <a href="http://eggert.org">http://eggert.org</a>











Laganier &amp; Eggert            Standards Track                   [Page 14]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

