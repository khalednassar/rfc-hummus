<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc3860
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-impp-im/">
  <meta name="description" content="Common Profile for Instant Messaging (CPIM) (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc3860.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc3860.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc3860.txt.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/rfc3860/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc3860/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/impp/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-impp-im@ietf.org?subject=draft-ietf-impp-im" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-impp-im-04.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-impp-im-04.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-impp-im-04.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-ietf-impp-im-04">draft-ietf-impp-im-04</a>                            Proposed Standard</pre>
      </div>
    

    <div class="draftcontent">
    <pre>Network Working Group                                        J. Peterson
Request for Comments: 3860                                       NeuStar
Category: Standards Track                                    August 2004


              <span class="h1">Common Profile for Instant Messaging (CPIM)</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the &quot;Internet
   Official Protocol Standards&quot; (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2004).

Abstract

   At the time this document was written, numerous instant messaging
   protocols were in use, and little interoperability between services
   based on these protocols has been achieved.  This specification
   defines common semantics and data formats for instant messaging to
   facilitate the creation of gateways between instant messaging
   services.

Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  Abstract Instant Messaging Service . . . . . . . . . . . . . .  <a href="#page-4">4</a>
       <a href="#section-3.1">3.1</a>.  Overview of Instant Messaging Service  . . . . . . . . .  <a href="#page-4">4</a>
       <a href="#section-3.2">3.2</a>.  Identification of INSTANT INBOXes  . . . . . . . . . . .  <a href="#page-5">5</a>
             <a href="#section-3.2.1">3.2.1</a>.  Address Resolution . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
       <a href="#section-3.3">3.3</a>.  Format of Instant Messages . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
       <a href="#section-3.4">3.4</a>.  The Messaging Service  . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
             <a href="#section-3.4.1">3.4.1</a>.  The Message Operation  . . . . . . . . . . . . .  <a href="#page-5">5</a>
             <a href="#section-3.4.2">3.4.2</a>.  Looping  . . . . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
   <a href="#section-4">4</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-5">5</a>.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
       <a href="#section-5.1">5.1</a>.  The IM URI Scheme. . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-6">6</a>.  Contributors . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-7">7</a>.  References . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
       <a href="#section-7.1">7.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
       <a href="#section-7.2">7.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>




<span class="grey">Peterson                    Standards Track                     [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


   <a href="#appendix-A">A</a>.  IM URI IANA Registration Template  . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#appendix-A.1">A.1</a>.  URI Scheme Name  . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#appendix-A.2">A.2</a>.  URI Scheme Syntax  . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#appendix-A.3">A.3</a>.  Character Encoding Considerations  . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#appendix-A.4">A.4</a>.  Intended Usage . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
       A.5.  Applications and/or Protocols which use this URI Scheme
             Name . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#appendix-A.6">A.6</a>.  Security Considerations  . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#appendix-A.7">A.7</a>.  Relevant Publications  . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
       A.8.  Person &amp; Email Address to Contact for Further
             Information. . . . . . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
       <a href="#appendix-A.9">A.9</a>.  Author/Change Controller . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
       A.10. Applications and/or Protocols which use this URI Scheme
             Name . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
   <a href="#appendix-B">B</a>.  Issues of Interest . . . . . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
       <a href="#appendix-B.1">B.1</a>.  Address Mapping  . . . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
       <a href="#appendix-B.2">B.2</a>.  Source-Route Mapping . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
   <a href="#appendix-C">C</a>.  Acknowledgments  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
   Author&#x27;s Address . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
   Full Copyright Statement . . . . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction</span>

   Instant messaging is defined in <a href="/doc/html/rfc2778">RFC2778</a> [<a href="#ref-5" title="&quot;A Model for Presence and Instant Messaging&quot;">5</a>].  At the time this
   document was written, numerous instant messaging protocols are in
   use, and little interoperability between services based on these
   protocols has been achieved.  This specification defines semantics
   and data formats for common services of instant messaging to
   facilitate the creation of gateways between instant messaging
   services: a common profile for instant messaging (CPIM).

   Service behavior is described abstractly in terms of operations
   invoked between the consumer and provider of a service.  Accordingly,
   each IM service must specify how this behavior is mapped onto its own
   protocol interactions.  The choice of strategy is a local matter,
   providing that there is a clear relation between the abstract
   behaviors of the service (as specified in this memo) and how it is
   faithfully realized by a particular instant messaging service.  For
   example, one strategy might transmit an instant message as textual
   key/value pairs, another might use a compact binary representation,
   and a third might use nested containers.

   The attributes for each operation are defined using an abstract
   syntax.  Although the syntax specifies the range of possible data
   values, each IM service must specify how well-formed instances of the
   abstract representation are encoded as a concrete series of bits.





<span class="grey">Peterson                    Standards Track                     [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


   In order to provide a means for the preservation of end-to-end
   features (especially security) to pass through instant messaging
   interoperability gateways, this specification also provides
   recommendations for instant messaging document formats that could be
   employed by instant messaging protocols.

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Terminology</span>

   In this document, the key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;,
   &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT
   RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; are to be interpreted as
   described in <a href="/doc/html/rfc2119">RFC 2119</a> [<a href="#ref-1" title="&quot;Key words for use in RFCs to indicate requirement levels&quot;">1</a>] and indicate requirement levels for
   compliant implementations.

   This memos makes use of the vocabulary defined in <a href="/doc/html/rfc2778">RFC 2778</a> [<a href="#ref-5" title="&quot;A Model for Presence and Instant Messaging&quot;">5</a>].
   Terms such as CLOSED, INSTANT INBOX, INSTANT MESSAGE, and OPEN are
   used in the same meaning as defined therein.

   The term &#x27;gateway&#x27; used in this document denotes a network element
   responsible for interworking between diverse instant messaging
   protocols.  Although the instant messaging protocols themselves are
   diverse, under the model used in this document these protocols can
   carry a common payload that is relayed by the gateway.  Whether these
   interworking intermediaries should be called &#x27;gateways&#x27; or &#x27;relays&#x27;
   is therefore somewhat debatable; for the purposes of this document,
   they are called &#x27;CPIM gateways&#x27;.

   The term &#x27;instant messaging service&#x27; also derives from <a href="/doc/html/rfc2778">RFC 2778</a>, but
   its meaning changes slightly due to the existence of gateways in the
   CPIM model.  When a client sends an operation to an instant messaging
   service, that service might either be an endpoint or an intermediary
   such as a CPIM gateway - in fact, the client should not have to be
   aware which it is addressing, as responses from either will appear
   the same.

   This document defines operations and attributes of an abstract
   instant messaging protocol.  In order for a compliant protocol to
   interface with an instant messaging gateway, it must support all of
   the operations described in this document (i.e., the instant
   messaging protocol must have some message or capability that provides
   the function described by each of the given operations).  Similarly,
   the attributes defined for these operations must correspond to
   information available in the instant messaging protocol in order for
   the protocol to interface with gateways defined by this
   specification.  Note that these attributes provide only the minimum
   possible information that needs to be specified for interoperability





<span class="grey">Peterson                    Standards Track                     [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


   - the functions in an instant messaging protocol that correspond to
   the operations described in this document can contain additional
   information that will not be mapped by CPIM.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Abstract Instant Messaging Service</span>

<span class="h3"><a class="selflink" id="section-3.1" href="#section-3.1">3.1</a>.  Overview of Instant Messaging Service</span>

   When an application wants to send a message to an INSTANT INBOX, it
   invokes the message operation, e.g.,

   +-------+                    +-------+
   |       |                    |       |
   | appl. | -- message ------&gt; |  IM   |
   |       |                    | svc.  |
   +-------+                    +-------+

   The message operation has the following attributes: source,
   destination, MaxForwards and TransID.  &#x27;source&#x27; and &#x27;destination&#x27;
   identify the originator and recipient of an instant message,
   respectively, and consist of an INSTANT INBOX identifier (as
   described in <a href="#section-3.2">Section 3.2</a>).  The MaxForwards is a hop counter to avoid
   loops through gateways, with usage detailed defined in <a href="#section-3.4.2">Section 3.4.2</a>;
   its initial value is set by the originator.  The TransID is a unique
   identifier used to correlate message operations to response
   operations; gateways should be capable of handling TransIDs up to 40
   bytes in length.

   The message operation also has some content, the instant message
   itself, which may be textual, or which may consist of other data.
   Content details are specified in <a href="#section-3.3">Section 3.3</a>.

   Note that this specification assumes that instant messaging protocols
   provide reliable message delivery; there are no application-layer
   message delivery assurance provisions in this specification.

   Upon receiving a message operation, the service immediately responds
   by invoking the response operation containing the same transaction-
   identifier, e.g.,

   +-------+                    +-------+
   |       |                    |       |
   | appl. | &lt;----- response -- |  IM   |
   |       |                    |  svc. |
   +-------+                    +-------+






<span class="grey">Peterson                    Standards Track                     [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


   The response operation contains the following attributes: TransID and
   status.  The TransID is used to correlate the response to a
   particular instant message.  Status indicates whether the delivery of
   the message succeeded or failed.  Valid status values are described
   in <a href="#section-3.4.1">Section 3.4.1</a>.

<span class="h3"><a class="selflink" id="section-3.2" href="#section-3.2">3.2</a>.  Identification of INSTANT INBOXes</span>

   An INSTANT INBOX is specified using an instant messaging URI with the
   &#x27;im:&#x27; URI scheme.  The full syntax of the IM URI scheme is given in
   <a href="#appendix-A">Appendix A</a>.  An example would be: &quot;im:fred@example.com&quot;

<span class="h4"><a class="selflink" id="section-3.2.1" href="#section-3.2.1">3.2.1</a>.  Address Resolution</span>

   An IM service client determines the next hop to forward the IM to by
   resolving the domain name portion of the service destination.
   Compliant implementations SHOULD follow the guidelines for
   dereferencing URIs given in [<a href="#ref-2" title="&quot;Address Resolution for Instant Messaging and Presence&quot;">2</a>].

<span class="h3"><a class="selflink" id="section-3.3" href="#section-3.3">3.3</a>.  Format of Instant Messages</span>

   This specification defines an abstract interoperability mechanism for
   instant messaging protocols; the message content definition given
   here pertains to semantics rather than syntax.  However, some
   important properties for interoperability can only be provided if a
   common end-to-end format for instant messaging is employed by the
   interoperating instant messaging protocols, especially with respect
   to security.  In order to maintain end-to-end security properties,
   applications that send message operations to a CPIM gateway MUST
   implement the format defined in MSGFMT [<a href="#ref-4" title="&quot;Common Presence and Instant Messaging: Message Format&quot;">4</a>].  Applications MAY support
   other content formats.

   CPIM gateways MUST be capable of relaying the content of a message
   operation between supported instant messaging protocols without
   needing to modify or inspect the content.

<span class="h3"><a class="selflink" id="section-3.4" href="#section-3.4">3.4</a>.  The Messaging Service</span>

<span class="h4"><a class="selflink" id="section-3.4.1" href="#section-3.4.1">3.4.1</a>.  The Message Operation</span>

   When an application wants to send an INSTANT MESSAGE, it invokes the
   message operation.









<span class="grey">Peterson                    Standards Track                     [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


   When an instant messaging service receives the message operation, it
   performs the following preliminary checks:

   1.  If the source or destination does not refer to a syntactically
       valid INSTANT INBOX, a response operation having status &quot;failure&quot;
       is invoked.

   2.  If the destination of the operation cannot be resolved by the
       recipient, and the recipient is not the final recipient, a
       response operation with the status &quot;failure&quot; is invoked.

   3.  If access control does not permit the application to request this
       operation, a response operation having status &quot;failure&quot; is
       invoked.

   4.  Provided these checks are successful:

          If the instant messaging service is able to successfully
          deliver the message, a response operation having status
          &quot;success&quot; is invoked.

          If the service is unable to successfully deliver the message,
          a response operation having status &quot;failure&quot; is invoked.

          If the service must delegate responsibility for delivery
          (i.e., if it is acting as a gateway or proxying the
          operation), and if the delegation will not result in a future
          authoritative indication to the service, a response operation
          having status &quot;indeterminant&quot; is invoked.

          If the service must delegate responsibility for delivery, and
          if the delegation will result in a future authoritative
          indication to the service, then a response operation is
          invoked immediately after the indication is received.

   When the service invokes the response operation, the transID
   parameter is identical to the value found in the message operation
   invoked by the application.

<span class="h4"><a class="selflink" id="section-3.4.2" href="#section-3.4.2">3.4.2</a>.  Looping</span>

   The dynamic routing of instant messages can result in looping of a
   message through a relay.  Detection of loops is not always obvious,
   since aliasing and group list expansions can legitimately cause a
   message to pass through a relay more than one time.






<span class="grey">Peterson                    Standards Track                     [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


   This document assumes that instant messaging protocols that can be
   gatewayed by CPIM support some semantic equivalent to an integer
   value that indicates the maximum number of hops through which a
   message can pass.  When that number of hops has been reached, the
   message is assumed to have looped.

   When a CPIM gateway relays an instant message, it decrements the
   value of the MaxForwards attribute.  This document does not mandate
   any particular initial setting for the MaxForwards element in instant
   messaging protocols, but it is recommended that the value be
   reasonably large (over one hundred).

   If a CPIM gateway receives an instant message operation that has a
   MaxForwards attribute of 0, it discards the message and invokes a
   failure operation.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  Security Considerations</span>

   Detailed security considerations for instant messaging protocols are
   given in <a href="/doc/html/rfc2779">RFC 2779</a> [<a href="#ref-6" title="&quot;Instant Messaging / Presence Protocol Requirements&quot;">6</a>] (in particular, requirements are given in
   <a href="#section-5.4">section 5.4</a> and some motivating discussion with 8.1).

   CPIM defines an interoperability function that is employed by
   gateways between instant messaging protocols.  CPIM gateways MUST be
   compliant with the minimum security requirements of the instant
   messaging protocols with which they interface.

   The introduction of gateways to the security model of instant
   messaging in <a href="/doc/html/rfc2779">RFC 2779</a> also introduces some new risks.  End-to-end
   security properties (especially confidentiality and integrity)
   between instant messaging user agents that interface through a CPIM
   gateway can only be provided if a common instant message format (such
   as the format described in MSGFMT [<a href="#ref-4" title="&quot;Common Presence and Instant Messaging: Message Format&quot;">4</a>]) is supported by the protocols
   interfacing with the CPIM gateway.

   When end-to-end security is required, the message operation MUST use
   MSGFMT, and MUST secure the MSGFMT MIME body with S/MIME [<a href="#ref-8" title="&quot;Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Message Specification&quot;">8</a>], with
   encryption (CMS EnvelopeData) and/or S/MIME signatures (CMS
   SignedData).

   The S/MIME algorithms are set by CMS [<a href="#ref-9" title="&quot;Cryptographic Message Syntax (CMS)&quot;">9</a>].  The AES [<a href="#ref-11" title="&quot;Use of the Advanced Encryption Standard (AES) Encryption Algorithm and in Cryptographic Message Syntax (CMS)&quot;">11</a>] algorithm
   should be preferred, as it is expected that AES best suits the
   capabilities of many platforms.  Implementations MAY use AES as an
   encryption algorithm, but are REQUIRED to support only the baseline
   algorithms mandated by S/MIME and CMS.






<span class="grey">Peterson                    Standards Track                     [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


   When IM URIs are placed in instant messaging protocols, they convey
   the identity of the sender and/or the recipient.  Certificates that
   are used for S/MIME IM operations SHOULD, for the purposes of
   reference integrity, contain a subjectAltName field containing the IM
   URI of their subject.  Note that such certificates may also contain
   other identifiers, including those specific to particular instant
   messaging protocols.  In order to further facilitate interoperability
   of secure messaging through CPIM gateways, users and service
   providers are encouraged to employ trust anchors for certificates
   that are widely accepted rather than trust anchors specific to any
   particular instant messaging service or provider.

   In some cases, anonymous messaging may be desired.  Such a capability
   is beyond the scope of this specification.

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  IANA Considerations</span>

   The IANA has assigned the &quot;im&quot; scheme.

<span class="h3"><a class="selflink" id="section-5.1" href="#section-5.1">5.1</a>.  The IM URI Scheme</span>

   The Instant Messaging (IM) URI scheme designates an Internet
   resource, namely an INSTANT INBOX.

   The syntax of an IM URI is given in <a href="#appendix-A">Appendix A</a>.

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Contributors</span>

   Dave Crocker edited earlier versions of this document.

   The following individuals made substantial textual contributions to
   this document:

      Athanassios Diacakis (thanos.diacakis@openwave.com)

      Florencio Mazzoldi (flo@networkprojects.com)

      Christian Huitema (huitema@microsoft.com)

      Graham Klyne (gk@ninebynine.org)

      Jonathan Rosenberg (jdrosen@dynamicsoft.com)

      Robert Sparks (rsparks@dynamicsoft.com)

      Hiroyasu Sugano (suga@flab.fujitsu.co.jp)





<span class="grey">Peterson                    Standards Track                     [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  References</span>

<span class="h3"><a class="selflink" id="section-7.1" href="#section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-1">1</a>]  Bradner, S., &quot;Key words for use in RFCs to indicate requirement
        levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-2">2</a>]  Peterson, J., &quot;Address Resolution for Instant Messaging and
        Presence&quot;, <a href="/doc/html/rfc3861">RFC 3861</a>, August 2004.

   [<a id="ref-3">3</a>]  Resnick, P., &quot;Internet Message Format&quot;, STD 11, <a href="/doc/html/rfc2822">RFC 2822</a>, April
        2001.

   [<a id="ref-4">4</a>]  Atkins, D. and G. Klyne, &quot;Common Presence and Instant Messaging:
        Message Format&quot;, <a href="/doc/html/rfc3862">RFC 3862</a>, August 2004.

   [<a id="ref-5">5</a>]  Day, M., Rosenberg, J., and H. Sugano, &quot;A Model for Presence and
        Instant Messaging&quot;, <a href="/doc/html/rfc2778">RFC 2778</a>, February 2000.

   [<a id="ref-6">6</a>]  Day, M., Aggarwal, S., and J. Vincent, &quot;Instant Messaging /
        Presence Protocol Requirements&quot;, <a href="/doc/html/rfc2779">RFC 2779</a>, February 2000.

   [<a id="ref-7">7</a>]  Allocchio, C., &quot;GSTN Address Element Extensions in Email
        Services&quot;, <a href="/doc/html/rfc2846">RFC 2846</a>, June 2000.

   [<a id="ref-8">8</a>]  Ramsdell, B., &quot;Secure/Multipurpose Internet Mail Extensions
        (S/MIME) Version 3.1 Message Specification&quot;, <a href="/doc/html/rfc3851">RFC 3851</a>, July
        2004.

   [<a id="ref-9">9</a>]  Housley, R., &quot;Cryptographic Message Syntax (CMS)&quot;, <a href="/doc/html/rfc3852">RFC 3852</a>,
        July 2004.

   [<a id="ref-10">10</a>] Berners-Lee, T., Fielding, R., and L. Masinter, &quot;Uniform
        Resource Identifiers (URI): Generic Syntax&quot;, <a href="/doc/html/rfc2396">RFC 2396</a>, August
        1998.

<span class="h3"><a class="selflink" id="section-7.2" href="#section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-11">11</a>] Schaad, J., &quot;Use of the Advanced Encryption Standard (AES)
        Encryption Algorithm and in Cryptographic Message Syntax (CMS)&quot;,
        <a href="/doc/html/rfc3565">RFC 3565</a>, August 2003.










<span class="grey">Peterson                    Standards Track                     [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


<span class="h2"><a class="selflink" id="appendix-A" href="#appendix-A">Appendix A</a>.  IM URI IANA Registration Template</span>

   This section provides the information to register the im: instant
   messaging URI.

<span class="h3"><a class="selflink" id="appendix-A.1" href="#appendix-A.1">A.1</a>.  URI Scheme Name</span>

   im

<span class="h3"><a class="selflink" id="appendix-A.2" href="#appendix-A.2">A.2</a>.  URI Scheme Syntax</span>

   The syntax follows the existing mailto: URI syntax specified in <a href="/doc/html/rfc2368">RFC</a>
   <a href="/doc/html/rfc2368">2368</a>.  The ABNF is:

   IM-URI         = &quot;im:&quot; [ to ] [ headers ]
   to             =  mailbox
   headers        =  &quot;?&quot; header *( &quot;&amp;&quot; header )
   header         =  hname &quot;=&quot; hvalue
   hname          =  *uric
   hvalue         =  *uric

   Here the symbol &quot;mailbox&quot; represents an encoded mailbox name as
   defined in <a href="/doc/html/rfc2822">RFC 2822</a> [<a href="#ref-3" title="&quot;Internet Message Format&quot;">3</a>], and the symbol &quot;uric&quot; denotes any character
   that is valid in a URL (defined in <a href="/doc/html/rfc2396">RFC 2396</a> [<a href="#ref-10" title="&quot;Uniform Resource Identifiers (URI): Generic Syntax&quot;">10</a>]).

<span class="h3"><a class="selflink" id="appendix-A.3" href="#appendix-A.3">A.3</a>.  Character Encoding Considerations</span>

   Representation of non-ASCII character sets in local-part strings is
   limited to the standard methods provided as extensions to <a href="/doc/html/rfc2822">RFC 2822</a>
   [<a href="#ref-3" title="&quot;Internet Message Format&quot;">3</a>].

<span class="h3"><a class="selflink" id="appendix-A.4" href="#appendix-A.4">A.4</a>.  Intended Usage</span>

   Use of the im: URI follows closely usage of the mailto: URI.  That
   is, invocation of an IM URI will cause the user&#x27;s instant messaging
   application to start, with destination address and message headers
   fill-in according to the information supplied in the URI.

<span class="h3"><a class="selflink" id="appendix-A.5" href="#appendix-A.5">A.5</a>.  Applications and/or Protocols which use this URI Scheme Name</span>

   It is anticipated that protocols compliant with <a href="/doc/html/rfc2779">RFC 2779</a>, and meeting
   the interoperability requirements specified here, will make use of
   this URI scheme name.

<span class="h3"><a class="selflink" id="appendix-A.6" href="#appendix-A.6">A.6</a>.  Security Considerations</span>

   See <a href="#section-4">Section 4</a>.




<span class="grey">Peterson                    Standards Track                    [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


<span class="h3"><a class="selflink" id="appendix-A.7" href="#appendix-A.7">A.7</a>.  Relevant Publications</span>

   <a href="/doc/html/rfc2779">RFC 2779</a>, <a href="/doc/html/rfc2778">RFC 2778</a>

<span class="h3"><a class="selflink" id="appendix-A.8" href="#appendix-A.8">A.8</a>.  Person &amp; Email Address to Contact for Further Information</span>

   Jon Peterson [mailto:jon.peterson@neustar.biz]

<span class="h3"><a class="selflink" id="appendix-A.9" href="#appendix-A.9">A.9</a>.  Author/Change Controller</span>

   This scheme is registered under the IETF tree.  As such, IETF
   maintains change control.

<span class="h3"><a class="selflink" id="appendix-A.10" href="#appendix-A.10">A.10</a>.  Applications and/or Protocols which use this URI Scheme Name</span>

   Instant messaging service

<span class="h2"><a class="selflink" id="appendix-B" href="#appendix-B">Appendix B</a>.  Issues of Interest</span>

   This appendix briefly discusses issues that may be of interest when
   designing an interoperation gateway.

<span class="h3"><a class="selflink" id="appendix-B.1" href="#appendix-B.1">B.1</a>.  Address Mapping</span>

   When mapping the service described in this memo, mappings that place
   special information into the im: address local-part MUST use the
   meta-syntax defined in <a href="/doc/html/rfc2846">RFC 2846</a> [<a href="#ref-7" title="&quot;GSTN Address Element Extensions in Email Services&quot;">7</a>].

<span class="h3"><a class="selflink" id="appendix-B.2" href="#appendix-B.2">B.2</a>.  Source-Route Mapping</span>

   The easiest mapping technique is a form of source-routing and usually
   is the least friendly to humans having to type the string.  Source-
   routing also has a history of operational problems.

   Use of source-routing for exchanges between different services is by
   a transformation that places the entire, original address string into
   the im: address local part and names the gateway in the domain part.

   For example, if the destination INSTANT INBOX is &quot;pepp://example.com/
   fred&quot;, then, after performing the necessary character conversions,
   the resulting mapping is:

             im:pepp=example.com/fred@relay-domain

   where &quot;relay-domain&quot; is derived from local configuration information.






<span class="grey">Peterson                    Standards Track                    [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


   Experience shows that it is vastly preferable to hide this mapping
   from end-users - if possible, the underlying software should perform
   the mapping automatically.

<span class="h2"><a class="selflink" id="appendix-C" href="#appendix-C">Appendix C</a>.  Acknowledgments</span>

   The author would like to acknowledge John Ramsdell for his comments,
   suggestions and enthusiasm.  Thanks to Derek Atkins for editorial
   fixes.

Author&#x27;s Address

   Jon Peterson
   NeuStar, Inc.
   1800 Sutter St
   Suite 570
   Concord, CA  94520
   US

   Phone: +1 925/363-8720
   EMail: jon.peterson@neustar.biz






























<span class="grey">Peterson                    Standards Track                    [Page 12]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-13" ></span>
<span class="grey"><a href="/doc/html/rfc3860">RFC 3860</a>                          CPIM                       August 2004</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2004).  This document is subject
   to the rights, licenses and restrictions contained in <a href="/doc/html/bcp78">BCP 78</a>, and
   except as set forth therein, the authors retain all their rights.

   This document and the information contained herein are provided on an
   &quot;AS IS&quot; basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="/doc/html/bcp78">BCP 78</a> and <a href="/doc/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at ietf-
   ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.









Peterson                    Standards Track                    [Page 13]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

