<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc3543
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.34.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.34.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-mobileip-reg-revok/">
  <meta name="description" content="Registration Revocation in Mobile IPv4 (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.34.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.34.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.34.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc3543.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc3543.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc3543.txt.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/rfc3543/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc3543/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/mobileip/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-mobileip-reg-revok@ietf.org?subject=draft-ietf-mobileip-reg-revok" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-mobileip-reg-revok-07.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-mobileip-reg-revok-07.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-mobileip-reg-revok-07.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-ietf-mobileip-reg-revok-07">draft-ietf-mobileip-reg-revok-07</a>                 Proposed Standard</pre>
      </div>
    

    <div class="draftcontent">
    <pre>Network Working Group                                           S. Glass
Request for Comments: 3543                              Sun Microsystems
Category: Standards Track                                     M. Chandra
                                                           Cisco Systems
                                                             August 2003


                 <span class="h1">Registration Revocation in Mobile IPv4</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the &quot;Internet
   Official Protocol Standards&quot; (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2003).  All Rights Reserved.

Abstract

   This document defines a Mobile IPv4 Registration Revocation mechanism
   whereby a mobility agent involved in providing Mobile IP services to
   a mobile node can notify the other mobility agent providing Mobile IP
   services to the same mobile node of the termination of this
   registration.  The mechanism is also usable by a home agent to notify
   a co-located mobile node of the termination of its binding as well.
   Moreover, the mechanism provides for this notification to be
   acknowledged.  A signaling mechanism already defined by the Mobile
   IPv4 protocol is leveraged as a way to inform a mobile node of the
   revocation of its binding.

Table of Contents

   <a href="#section-1">1</a>.  Introduction and Applicability . . . . . . . . . . . . . . . .  <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Terminology. . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Registration Revocation Extensions and Messages. . . . . . . .  <a href="#page-4">4</a>
       <a href="#section-3.1">3.1</a>.  Advertising Registration Revocation Support. . . . . . .  <a href="#page-5">5</a>
       <a href="#section-3.2">3.2</a>.  Revocation Support Extension . . . . . . . . . . . . . .  <a href="#page-6">6</a>
       <a href="#section-3.3">3.3</a>.  Registration Revocation Message. . . . . . . . . . . . .  <a href="#page-8">8</a>
       <a href="#section-3.4">3.4</a>.  Registration Revocation Acknowledgment Message . . . . . <a href="#page-11">11</a>
       <a href="#section-3.5">3.5</a>.  Replay Protection. . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
   <a href="#section-4">4</a>.  Registration Revocation Overview . . . . . . . . . . . . . . . <a href="#page-15">15</a>
       <a href="#section-4.1">4.1</a>.  Mobile Node Notification . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
       4.2.  Registration Revocation Mechanism - Agent Notification . 17
             <a href="#section-4.2.1">4.2.1</a>.  Negotiating Revocation Support . . . . . . . . . <a href="#page-17">17</a>



<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


             <a href="#section-4.2.2">4.2.2</a>.  Home Domain Revoking a Registration. . . . . . . <a href="#page-19">19</a>
                     <a href="#section-4.2.2.1">4.2.2.1</a>.  Home Agent Responsibilities. . . . . . <a href="#page-19">19</a>
                     <a href="#section-4.2.2.2">4.2.2.2</a>.  Foreign Agent Responsibilities . . . . <a href="#page-20">20</a>
                     4.2.2.3.  &#x27;Direct&#x27; Co-located Mobile Node
                               Responsibilities . . . . . . . . . . . <a href="#page-20">20</a>
             <a href="#section-4.2.3">4.2.3</a>.  Foreign Domain Revoking a Registration . . . . . <a href="#page-21">21</a>
                     <a href="#section-4.2.3.1">4.2.3.1</a>.  Foreign Agent Responsibilities . . . . <a href="#page-21">21</a>
                     <a href="#section-4.2.3.2">4.2.3.2</a>.  Home Agent Responsibilities. . . . . . <a href="#page-22">22</a>
             <a href="#section-4.2.4">4.2.4</a>.  Mobile Node Deregistering a Registration . . . . <a href="#page-23">23</a>
       <a href="#section-4.3">4.3</a>.  Mobile IP Registration Bits in the Revocation Process. . <a href="#page-23">23</a>
             <a href="#section-4.3.1">4.3.1</a>.  The &#x27;R&#x27; Bit in Use . . . . . . . . . . . . . . . <a href="#page-23">23</a>
             <a href="#section-4.3.2">4.3.2</a>.  The &#x27;D&#x27; Bit in Use (co-located mobile nodes) . . <a href="#page-23">23</a>
   <a href="#section-5">5</a>.  Error Codes. . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-24">24</a>
   <a href="#section-6">6</a>.  Security Considerations. . . . . . . . . . . . . . . . . . . . <a href="#page-24">24</a>
       <a href="#section-6.1">6.1</a>.  Agent Advertisements . . . . . . . . . . . . . . . . . . <a href="#page-24">24</a>
       <a href="#section-6.2">6.2</a>.  Revocation Messages. . . . . . . . . . . . . . . . . . . <a href="#page-25">25</a>
   <a href="#section-7">7</a>.  IANA Considerations. . . . . . . . . . . . . . . . . . . . . . <a href="#page-27">27</a>
       <a href="#section-7.1">7.1</a>.  New Message Types. . . . . . . . . . . . . . . . . . . . <a href="#page-27">27</a>
       <a href="#section-7.2">7.2</a>.  New Extension Values . . . . . . . . . . . . . . . . . . <a href="#page-27">27</a>
       <a href="#section-7.3">7.3</a>.  New Error Codes. . . . . . . . . . . . . . . . . . . . . <a href="#page-27">27</a>
   <a href="#section-8">8</a>.  References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-27">27</a>
       <a href="#section-8.1">8.1</a>.  Normative (Numerical References) . . . . . . . . . . . . <a href="#page-27">27</a>
       <a href="#section-8.2">8.2</a>.  Informational (Alphabetical References). . . . . . . . . <a href="#page-28">28</a>
   <a href="#appendix-A">Appendix A</a>  An Example of the New Messages in Use. . . . . . . . . <a href="#page-29">29</a>
               <a href="#appendix-A.1">A.1</a>.  The Registration Phase . . . . . . . . . . . . . <a href="#page-29">29</a>
               <a href="#appendix-A.2">A.2</a>.  The Revocation Phase . . . . . . . . . . . . . . <a href="#page-29">29</a>
   <a href="#appendix-B">Appendix B</a>  Disparate Address, and Receiver Considerations . . . . <a href="#page-30">30</a>
   Acknowledgments. . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-32">32</a>
   Authors&#x27; Addresses . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-32">32</a>
   Full Copyright Statement . . . . . . . . . . . . . . . . . . . . . <a href="#page-33">33</a>

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction and Applicability</span>

   Mobile IP [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] defines registration of a mobile node&#x27;s location to
   provide connectivity between the mobile node and its home domain,
   facilitating communication between mobile nodes and any correspondent
   node.  At any time, either the home or foreign agent may wish to
   cease servicing a mobile node, or for administrative reasons may no
   longer be required to service a mobile node.

   This document defines a general registration revocation mechanism for
   Mobile IPv4, whereby a mobility agent can notify another mobility
   agent (or a &#x27;direct&#x27; co-located mobile node) of the termination of
   mobility bindings.  A mobility agent that receives a revocation
   notification no longer has to provide services to the mobile node
   whose registration has been revoked.  A signaling mechanism already
   defined by the Mobile IPv4 protocol [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] is leveraged as a way to
   inform a mobile node of the revocation of its binding.



<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   The registration revocation protocol provides the following
   advantages:

   1. Timely release of Mobile IP resources.  Resources being consumed
      to provide Mobile IP services for a mobile node that has stopped
      receiving Mobile IP services by one agent, can be reclaimed by the
      other agent in a more timely fashion than if it had to wait for
      the binding to expire.  This also applies to the case in which a
      mobile node roams away from a foreign agent to another foreign
      agent.  Notification to the previous foreign agent would allow it
      to reclaim resources.

   2. Accurate accounting.  This has a favorable impact on resolving
      accounting issues with respect to the length of mobility bindings
      in both domains, as the actual end of the registration is relayed.

   3. Earlier adoption of domain policy changes with regards to services
      offered/required of a Mobile IP binding.  For example, the home
      domain may now require reverse tunnels [<a href="#ref-C" title="&quot;Reverse Tunneling for Mobile IP, revised&quot;">C</a>], yet there are existing
      bindings that do not use them.  Without a revocation mechanism,
      new services can only be put in place or removed as bindings are
      re-registered.

   4. Timely notification to a mobile node that it is no longer
      receiving mobility services, thereby significantly shortening any
      &#x27;black-hole&#x27; periods to facilitate a more robust recovery.

   The revocation protocol is an active, yet unobtrusive mechanism
   allowing more timely communication between the three Mobile IP
   entities in the various administrative domains.  Since many mobile
   nodes may not understand the concept of revocation, care has been
   taken to ensure backwards compatibility with [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].

   The registration revocation protocol does not replace the methods
   described in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] for Mobile IP deregistration, as the purpose of
   these mechanisms is fundamentally different.  Deregistration messages
   are used by a mobile node to inform its home agent that it has e.g.,
   roamed back to its home subnet, whereas revocation messages are used
   between mobility agents to signal the termination of mobility
   bindings.  More specifically, the revocation message defined here is
   NOT for use by &#x27;direct&#x27; co-located mobile nodes that are terminating
   their registration as deregistration messages are already sufficient
   for this purpose.  A &#x27;direct&#x27; co-located mobile node, however, may
   wish to process revocation messages as it is a useful mechanism to
   trigger the re-negotiation of required services from the home domain.






<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Terminology</span>

   It is assumed that the reader is familiar with the terminology used
   in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].  In addition, the following terms are defined:

   &#x27;Direct&#x27; Co-located Mobile Node

      A mobile node registering directly with its home agent, with the
      &#x27;D&#x27; bit set in its registration request, and NOT registering
      through a foreign agent.

   Mobile IP Resources

      Various functional elements allocated by a mobility agent to
      support a Mobile IP binding, e.g., memory.

   Mobile IP Services

      Various responsibilities of a mobility agent in supporting a
      mobile node as defined in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], e.g., encapsulation of packets
      addressed to a mobile node by a home agent, decapsulation of these
      packets by a foreign agent for delivery to a mobile node, etc.

   Mobility Agent

      The home agent or foreign agent as specified in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].

   Revocation

      Premature termination of a mobility binding.

   The keywords &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
   document are to be interpreted as described in <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a> [<a href="#ref-3" title="&quot;Key Words for us in RFCs to Indicate Requirement Levels&quot;">3</a>].

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Registration Revocation Extensions and Messages</span>

   Registration revocation in Mobile IPv4 is accomplished via the
   following:

   -  Advertising Registration Revocation Support (<a href="#section-3.1">Section 3.1</a>.):

      o  A flag in the Agent Advertisement extension has been reserved
         for agents to advertise their support of revocation messages.







<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   -  Revocation Support Extension (<a href="#section-3.2">Section 3.2</a>.):

      o  This extension is appended to a registration request or
         registration reply by a mobility agent to indicate its support
         of registration revocation.

      o  This extension is appended to a registration request by a
         &#x27;direct&#x27; co-located mobile node to indicate its understanding
         of revocation messages.

   -  Registration Revocation Message (<a href="#section-3.3">Section 3.3</a>.):

      o  A message sent by a mobility agent to inform another mobility
         agent, or a &#x27;direct&#x27; co-located mobile node, that it has
         revoked the binding of a mobile node.

   -  Registration Revocation Acknowledgment Message (<a href="#section-3.4">Section 3.4</a>.):

      o  A message sent by mobility agents or &#x27;direct&#x27; co-located mobile
         nodes to indicate the receipt of a revocation message.

   Security considerations related to the above messages and extensions
   are covered in <a href="#section-6">Section 6</a>.

<span class="h3"><a class="selflink" id="section-3.1" href="#section-3.1">3.1</a>.  Advertising Registration Revocation Support</span>

   Mobility agents can advertise their support of registration
   revocation with a modification to the Mobility Agent Advertisement
   extension described in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].  An &#x27;X&#x27; bit is introduced to indicate an
   agent&#x27;s support for Registration Revocation.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |    Length     |        Sequence Number        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Registration Lifetime      |R|B|H|F|M|G|r|T|U|X| reserved  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  zero or more Care-of Addresses               |
   |                              ...                              |

      X   The mobility agent supports Registration Revocation

   A foreign agent that sets the &#x27;X&#x27; bit in an agent advertisement
   extension MUST support registration revocation messages on that link,
   specifically the Revocation Support Extension (<a href="#section-3.2">section 3.2</a>.),
   Revocation Messages (<a href="#section-3.3">section 3.3</a>.), and Revocation Acknowledgment




<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   (<a href="#section-3.4">section 3.4</a>.).  It is not required that all agents advertising on
   the same link support registration revocation, nor is it required
   that an agent advertise this support on all of its links.

   Note that using this information, a mobile node can select a foreign
   agent that supports Registration Revocation.  Should a mobile node
   not understand this bit, it simply ignores it as per [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].

   As a bit in the agent advertisement, use of the &#x27;X&#x27; bit has no impact
   on other messages, such as e.g., Challenge-Response [<a href="#ref-2" title="&quot;Mobile IPv4 Challenge/Response Extensions&quot;">2</a>].

<span class="h3"><a class="selflink" id="section-3.2" href="#section-3.2">3.2</a>.  Revocation Support Extension</span>

   The Mobile IP revocation support extension indicates support of
   registration revocation, and so MUST be attached to a registration
   request or registration reply by any entity that wants to receive
   revocation messages.  Normally, this is either a foreign agent, or a
   home agent.  However a &#x27;direct&#x27; co-located mobile node MAY also
   include a revocation support extension in its registration request.
   A mobile node which is not co-located MUST NOT include a Revocation
   Support Extension in its registration.

   A foreign agent advertising the &#x27;X&#x27; bit on the link on which the
   registration request was received, and that has a security
   relationship with the home agent identified in the same registration
   request, MUST attach a revocation support extension to the forwarded
   registration request.  A home agent that receives a registration
   request that does not contain a revocation extension SHOULD NOT
   include a revocation support extension in the associated registration
   reply.

   The format of the revocation support extension is based on the Type-
   Length-Value Extension Format given in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] and is defined as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
   |     Type      |     Length    |I|        Reserved            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
   |                            Timestamp                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-

      Type     137








<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


      Length
               Length (in bytes, currently 6).  Does NOT include Type
               and Length fields (in accordance with section 1.9. of
               [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>]).  This allows for a longer extension length should
               more bits be required in the future.

      Timestamp
               Current 4-byte timestamp of the mobility agent or
               &#x27;direct&#x27; co-located mobile node.  This is used to
               identify the ordering of registrations as they are
               forwarded, how they relate to the sending of any
               revocation messages, and to identify the approximate
               offset between the clocks of the mobility agents
               providing support for this binding, or between a &#x27;direct&#x27;
               co-located mobile node and its home agent.

      &#x27;I&#x27; Bit
               This bit is set to &#x27;1&#x27; by a mobility agent to indicate it
               supports the use of the &#x27;I&#x27; bit in revocation messages
               (<a href="#section-3.3">section 3.3</a>.)

               When sent by a foreign agent in a registration request:

               If set to 1, the FA is willing to have the home agent use
               the &#x27;I&#x27; bit in the revocation process to determine
               whether the mobile node should be informed of the
               revocation or not.

               If set to 0, indicates to the home agent that the foreign
               agent will follow its own policy with regards to
               informing the mobile node in the event of a revocation.

               When sent by a home agent in response to a revocation
               extension in which the &#x27;I&#x27; bit was set to &#x27;1&#x27;:

               If set to 1, the home agent agrees to use the &#x27;I&#x27; bit in
               the revocation process to indicate to the foreign agent
               whether or not the mobile node should be informed.

               If set to 0, the home agent will not use the &#x27;I&#x27; bit in
               the revocation process, thereby yielding to the foreign
               agent&#x27;s default behavior with regard to informing the
               mobile node.

               To preserve the robustness of the protocol, the
               recommended default behavior for a foreign agent is to
               inform the mobile node of its revocation as described in
               <a href="#section-4.1">Section 4.1</a>.



<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


      Reserved
               Reserved for future use.  MUST be set to 0 on sending,
               MUST be ignored on receiving.

   When appearing in a registration request, or registration reply, the
   Mobile IP revocation support extension MUST be protected either by a
   foreign-home authentication extension, a mobile-home authentication
   extension, or any other equivalent mechanism [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], e.g., via AAA [<a href="#ref-A" title="&quot;Mobile IP Authentication, Authorization, and Accounting Requirements&quot;">A</a>],
   [<a href="#ref-B" title="&quot;Criteria for Evaluating AAA Protocols for Network Access&quot;">B</a>], or perhaps IPsec.  If the extension appearing in either of these
   registration messages is NOT protected, the appropriate action as
   described by [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] (Sections <a href="#section-3.8.2.1">3.8.2.1</a>. and Sections <a href="#section-3.7.3.1">3.7.3.1</a>.) MUST be
   taken.

   Support of the &#x27;I&#x27; bit is OPTIONAL.  If a mobility agent does not
   support the specified functionality, it MUST set the &#x27;I&#x27; bit to zero.
   Note that the home agent setting the &#x27;I&#x27; bit to &#x27;1&#x27; in response to a
   revocation extension from the foreign agent in which the &#x27;I&#x27; bit was
   set to &#x27;0&#x27; is undefined, and SHOULD NOT be done.

   &#x27;I&#x27; bit support has been negotiated when both agents have set the &#x27;I&#x27;
   bit to &#x27;1&#x27; in their revocation support extensions.

   It is important to note that this extension is skippable (i.e., if
   the receiving mobility agent does not understand this extension, it
   MUST skip it, and continue processing the remainder of the
   registration request).

<span class="h3"><a class="selflink" id="section-3.3" href="#section-3.3">3.3</a>.  Registration Revocation Messages</span>

   A revocation message is sent by a mobility agent to inform another
   mobility agent, or a &#x27;direct&#x27; co-located mobile node, that it is
   revoking the binding of a mobile node.

   IP Fields:

      Source Address       In the case of the home agent issuing the
                           registration revocation, the address
                           registered with the care-of address as that
                           of the home agent (that is the address
                           identified as the home address of this
                           binding).

                           In the case of the foreign agent issuing the
                           registration revocation, the address
                           registered with the home agent as the care-of
                           address.





<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


      Destination Address  In the case of the home agent issuing the
                           registration revocation, the source address
                           of the last approved registration request for
                           this binding, i.e., the destination address
                           of the last registration reply indicating
                           success for this binding.

                           In the case of the foreign agent issuing the
                           registration revocation, the address
                           registered as that of the home agent by the
                           mobile node whose registration is being
                           revoked.

   UDP Fields:

      Source Port          variable

      Destination Port     434

   The UDP header is followed by the Mobile IP fields shown below:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |   Reserved    |A|I|          Reserved         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Home Address                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Home Domain Address                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Foreign Domain Address                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Revocation Identifier                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Extensions...
   +-+-+-+-+-+-+-+-+-+-+-+-+-
   |   Authenticator...
   +-+-+-+-+-+-+-+-+-+-+-+-+-

      Type     7

      Reserved MUST be sent as 0, ignored when received.

      A        Agent bit (&#x27;direction&#x27; bit).

               This bit identifies the role of the agent sending the
               revocation, that is the &#x27;direction&#x27; of the revocation
               message.  This is useful for detecting reflection



<span class="grey">Glass &amp; Chandra             Standards Track                     [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


               attacks, particularly when symmetric keying is being
               used.

               Set to &#x27;0&#x27; if the revoking agent is servicing this
               binding as a foreign agent.

               Set to &#x27;1&#x27; if the revoking agent is servicing this
               binding as a home agent.

      I        Inform bit.

               This bit MUST NOT be set to &#x27;1&#x27; unless &#x27;I&#x27; bit support
               was negotiated in the revocation extension messages
               passed in the registration process, otherwise the results
               can be unpredictable.

               When sent by the home agent to a foreign agent:

               Set to &#x27;0&#x27; to request that the mobile node SHOULD NOT be
               informed of the revocation, or because the use of the &#x27;I&#x27;
               bit was not agreed upon.

               Set to &#x27;1&#x27; to request that the mobile node be informed of
               the revocation.

               When sending a revocation message to a &#x27;direct&#x27; co-
               located mobile node, this bit is essentially irrelevant,
               but SHOULD be set to &#x27;1&#x27;.

               When sent by the foreign agent:

               Set to &#x27;0&#x27; to indicate that the foreign agent is using
               foreign domain policy as to whether or not the mobile
               node should be informed of the revocation, or because &#x27;I&#x27;
               bit support was not agreed upon.

               Set to &#x27;1&#x27; to ask the home agent if the mobile node
               should be informed of the revocation.

      Reserved
               MUST be sent as 0, ignored when received.

      Home Address
               The home IP address of the mobile node whose registration
               is being revoked.






<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


      Foreign Domain Address
               The relevant IP address in the foreign domain to identify
               which binding is being revoked.  This is one of the
               following: (i) the foreign agent&#x27;s IP address, or (ii)
               the co-located care-of address.

      Home Domain Address
               The IP address of the home agent to identify which
               binding is being revoked.

      Revocation Identifier
               Protects against replay attacks.  The revoking agent MUST
               insert its current 4-byte timestamp running off the same
               clock as it is using to fill in the timestamp in its
               revocation extensions.  See <a href="#section-3.5">section 3.5</a>.

   A registration revocation message MUST be protected by either a valid
   authenticator as specified in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], namely a home-foreign
   authenticator, if the communication is between home and foreign
   agents, or a mobile-home authenticator if the communication is being
   sent from a home agent to a &#x27;direct&#x27; co-located mobile node, or
   another security mechanism at least as secure, and agreed upon by the
   home and foreign domains, e.g., IPsec.  If any agent, or &#x27;direct&#x27;
   co-located mobile node, receives a registration revocation message
   that does not contain a valid authenticator, and is not adequately
   protected, the revocation message MUST be ignored, and silently
   discarded.

   A revocation message MUST NOT be sent for any registration that has
   expired, and MAY only be sent prior to the expiration of a mobile
   node&#x27;s registration.  Note, however, due to the nature of datagram
   delivery, this does not guarantee these messages will arrive before
   the natural expiration of any binding.

   An agent MUST NOT send more than one revocation message or
   registration message per second for the same binding.  Note that this
   updates [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] by including revocation messages in the rate limit
   specified in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], i.e., that an agent MUST NOT send more than one
   registration message per second for the same binding.

   An example of the use of revocation messages is given in <a href="#appendix-A">Appendix A</a>.

<span class="h3"><a class="selflink" id="section-3.4" href="#section-3.4">3.4</a>.  Registration Revocation Acknowledgment Message</span>

   A revocation acknowledgment message is sent by mobility agents or
   &#x27;direct&#x27; co-located mobile nodes to indicate the successful receipt
   of a revocation message.




<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   IP fields:

      Source Address       Copied from the destination address of the
                           received registration revocation message for
                           which this registration revocation
                           acknowledgment message is being generated.

      Destination Address  Copied from the source address of the
                           received registration revocation message for
                           which this registration revocation
                           acknowledgment message is being generated.

   UDP fields:

      Source Port          434 (copied from the destination port of the
                           revocation message).

      Destination Port     Copied from the source port of the revocation
                           message.

   The UDP header is followed by the Mobile IP fields shown below:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Reserved  |I|         Reserved            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Home Address                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Revocation Identifier                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Extensions...
   +-+-+-+-+-+-+-+-+-+-+-+-+-
   | Authenticator...
   +-+-+-+-+-+-+-+-+-+-+-+-+-

      Type     15

      Reserved
               MUST be sent as 0, ignored when received.

      I        Inform bit.

               The &#x27;I&#x27; bit MUST NOT be set to &#x27;1&#x27; in the revocation
               acknowledgment messages unless it was set to &#x27;1&#x27; in the
               revocation message.  If an agent receives a revocation
               acknowledgment message in which the &#x27;I&#x27; bit is set to
               &#x27;1&#x27;, but for which the revocation message being



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 12]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-13" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


               acknowledged had the &#x27;I&#x27; bit set to &#x27;0&#x27;, the &#x27;I&#x27; bit in
               the revocation acknowledgment message MUST be ignored.

               When sent by the home agent:

               Set to &#x27;1&#x27; by the home agent to request the foreign agent
               inform the mobile node of the revocation.

               Set to &#x27;0&#x27; by the home agent to request the foreign agent
               not inform the mobile node of the revocation.

               When sent by a foreign agent:

               Set to &#x27;1&#x27; to indicate to the home agent that the mobile
               node was informed.

               Set to &#x27;0&#x27; to indicate to the home agent that the foreign
               agent used local policy to determine whether or not the
               mobile node should be informed.  For purposes of protocol
               robustness, it is highly recommended that such a default
               be set for the foreign agent to inform the mobile node of
               the revocation.

      Reserved
               MUST be sent as 0, ignored when received.

      Home Address
               The home address copied from the revocation message for
               which this acknowledgment is being sent.

      Revocation Identifier
               Copied from the Revocation Identifier of the revocation
               message for which this acknowledgment is being sent.  See
               <a href="#section-3.5">Section 3.5</a>.

   A registration revocation acknowledgment message MUST be sent in
   response to a valid and authenticated registration revocation
   message.

   A registration acknowledgment message MUST be protected by either a
   valid authenticator as specified in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], namely a home-foreign
   authenticator if the communication is between home and foreign
   agents, or a mobile-home authenticator if the communication is
   between home agent and &#x27;direct&#x27; co-located mobile node, or another
   security mechanism at least as secure and agreed upon by the home and
   foreign domains, e.g., IPsec.





<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 13]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-14" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   An example of the use of Revocation Acknowledgment Messages is given
   in <a href="#appendix-A">Appendix A</a>.

<span class="h3"><a class="selflink" id="section-3.5" href="#section-3.5">3.5</a>.  Replay Protection</span>

   As registration revocation messages are designed to terminate service
   for a mobile node, or multiple mobile nodes simultaneously, replay
   protection is crucial to prevent denial of service attacks by
   &quot;malicious repeaters&quot; - those who store datagrams with the intent of
   replaying them at a later time, or by &quot;malicious reflectors&quot; - those
   who reflect packets back at their original source (both a form of
   &quot;active&quot; attack).  See <a href="#section-6">Section 6</a>. for a discussion of these security
   considerations.

   All Revocation Messages and Revocation Acknowledgment Messages MUST
   be authenticated as well be replay-protected.  The order in which
   they are done, however, is up to implementation.

   Replay protection is handled with a simple timestamp mechanism, using
   a single 32-bit identifier field in the registration revocation
   message, in conjunction with the home address field, to associate any
   revocation acknowledgment messages with its revocation messages.  To
   do this:

   -  The revoking agent sets the &#x27;A&#x27; bit to its agent-type, and the
      Revocation Identifier field in the registration revocation message
      to a valid 32-bit timestamp from the same clock it is using to set
      the timestamp field of its revocation extensions included in
      registration messages.

   -  Upon receipt of an authenticated revocation message, the receiving
      agent (or &#x27;direct&#x27; co-located mobile node) MUST check the value of
      the &#x27;A&#x27; bit, and Revocation Identifier to make sure this
      revocation message is not a replay of an old revocation message
      received from the same agent.  The receiving agent MUST also check
      that the message is not a reflection of a revocation message it
      sent in relation to the identified binding.  If the &#x27;A&#x27; bit and
      Identifier field imply this packet is a replay, the revocation
      message MUST be silently discarded.

   -  When building a revocation acknowledgment message, the
      acknowledging agent (or &#x27;direct&#x27; co-located mobile node) copies
      the values of the Home Address and Revocation Identifier fields
      from the revocation message into the  Home Address and the
      Revocation Identifier of the revocation acknowledgment message.
      This is so the revoking agent can match this revocation
      acknowledgment to its corresponding revocation message.




<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 14]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-15" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   -  Upon receiving a valid revocation acknowledgment, the revoking
      agent MUST check the Home Address and Identifier fields to make
      sure they match those fields from a corresponding revocation
      message it sent to the acknowledging agent.  If not, this
      revocation acknowledgment message MUST be silently discarded.

   Note that since the Identifier in an incoming revocation message is a
   32-bit timestamp, it is possible for an agent to check the validity
   of the Identifier fields without having to remember all identifiers
   sent by that corresponding agent.

   Note: as it is possible for a mobile node to register at different
   times with different home agents, and at different times with
   different foreign agents, it is crucial that it not be required that
   the Identifier fields be unique in messages from different agents as
   there is no guarantee that clocks on different agents will be
   synchronized.  For example, if a mobile node has simultaneous
   bindings with multiple foreign agents, and if revocation messages are
   received by more than one such foreign agent &quot;simultaneously&quot;, it is
   possible the revocation message from one of these foreign agents may
   contain Identifier fields that happen to match those of any or all
   the other foreign agents.  This MUST NOT result in any of these
   revocation messages being ignored.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  Registration Revocation Overview</span>

   Registration Revocation consists of two distinct pieces: a signaling
   mechanism between tunnel endpoints, and a signaling mechanism between
   foreign agent and mobile node.  A &#x27;direct&#x27; co-located mobile node MAY
   implement revocation extensions and revocation acknowledgment in
   order to receive and respond to revocation messages from its home
   agent, however, a &#x27;direct&#x27; co-located mobile node MUST NOT send a
   revocation message as de-registration messages defined in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] are
   sufficient for this purpose.

   For further discussion on security issues related to registration
   revocation, refer to <a href="#section-6">Section 6</a>.

<span class="h3"><a class="selflink" id="section-4.1" href="#section-4.1">4.1</a>.  Mobile Node Notification</span>

   A mechanism which provides a foreign agent a way to actively notify a
   mobile node that its binding has been reset already exists in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>],
   though it has been overlooked for this purpose.

   A brief overview of the mechanics of the sequence number in agent
   advertisement from [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] is given so that the mechanism by which the
   foreign agent &#x27;implies&#x27; to the mobile node that its binding is no
   longer active is clearly understood.



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 15]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-16" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   When a foreign agent begins sending agent advertisements, it starts
   with a sequence number of 0, and [monotonically] increments the
   sequence number with each subsequent agent advertisement.  In order
   for a mobile node to be able to distinguish between a foreign agent
   that has simply exhausted the sequence number space from one which
   has been reset, when the agent increments the sequence number counter
   past its maximum value, it sets the sequence number to 256 instead of
   rolling to 0 [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].  In this way, a mobile node would have to miss, at
   that time, 256 advertisements in a row to mistake a reset as a roll-
   over.  Moreover, the lifetimes contained within an agent
   advertisement should be set in such a way that when a mobile node
   believes it has missed 3 beacons, the entry for this foreign agent
   should time out, and if the mobile node is registered there, it
   should send an agent solicitation [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].  If, however, an agent is
   somehow reset, it will begin advertising with a sequence number of 0,
   and the mobile node can presume this foreign agent has lost its
   binding, and the mobile node SHOULD re-register to make sure it is
   still obtaining Mobile IP services through this foreign agent.

   Leveraging this mechanism, a foreign agent may consciously notify all
   mobile nodes currently bound to it that it has &quot;reset&quot; all of their
   bindings, even if the agent itself has not been reset, by simply
   [re]setting the sequence number of the next agent advertisement to 0.
   Moreover, a foreign agent may inform all mobile nodes currently bound
   to it that they should re-register with a different foreign agent by
   simultaneously setting the &#x27;B&#x27; bit in the advertisement to 1,
   indicating this foreign agent is busy and is not accepting new
   registrations [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].  In these situations, any mobile node in
   compliance with [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] will presume this foreign agent has lost its
   binding, and must re-register if they wish to re-establish Mobile IP
   functionality with their home subnet.

   To indicate to any registered mobile node that its binding no longer
   exists, the foreign agent with which the mobile node is registered
   may unicast an agent advertisement with the sequence number set to 0
   to the mobile node [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], [<a href="#ref-D" title="&quot;ICMP Router Discovery Messages&quot;">D</a>].  Moreover, if such a foreign agent
   wishes to indicate to the mobile node that its binding has been
   revoked, and that the mobile node should not attempt to renew its
   registration with it, the foreign agent MAY also set the &#x27;B&#x27; bit to 1
   in these agent advertisements, indicating it is busy, and is not
   accepting new registrations [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].  All mobile nodes compliant with [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>]
   will understand that this means the agent is busy, and MAY either
   immediately attempt to re-register with another agent in their
   foreign agent cache, or MAY solicit for additional agents.  In the
   latter case, a foreign agent can optionally remember the mobile
   node&#x27;s binding was revoked, and respond to the solicit in the same
   way, namely with the &#x27;B&#x27; bit set to 1.  It should be noted, though,
   that since the foreign agent is likely to not be setting the &#x27;B&#x27; bit



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 16]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-17" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   to 1 in its broadcasted agent advertisements (sent to the entire
   link), the revoked mobile node, upon hearing this agent&#x27;s multicast
   agent advertisement without the &#x27;B&#x27; bit set, may attempt to
   [re]register with it.  If this happens, depending on foreign domain
   policy, the foreign agent can simply deny the mobile node with an
   appropriate error code (e.g., &quot;administratively prohibited&quot;).  At
   this time, a mobile node can use foreign agent fallback to attempt to
   register with a different foreign agent as described in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].

   Mobile nodes which understand the revocation mechanism described by
   this document may understand that a unicast agent advertisement with
   the sequence number reset to 0 could indicate a revocation, and may
   attempt to re-register with the same foreign agent, or register with
   a different foreign agent, or co-locate.

   Agent Advertisements unicast to a mobile node MUST be sent as
   described in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] in addition to any methods currently in use on the
   link to make them secure or authenticatable to protect from denial-
   of-service attacks.

<span class="h3"><a class="selflink" id="section-4.2" href="#section-4.2">4.2</a>.  Registration Revocation Mechanism - Agent Notification</span>

   A foreign agent that is currently supporting registration revocation
   on a link MUST set the &#x27;X&#x27; bit in its Agent Advertisement Extensions
   being sent on that link.  This allows mobile nodes requiring
   Registration Revocation services to register with those foreign
   agents advertising its support.

<span class="h4"><a class="selflink" id="section-4.2.1" href="#section-4.2.1">4.2.1</a>.  Negotiation of Revocation Support</span>

   During the registration process, if the foreign agent wishes to
   participate in revocation messages with the home domain, it MUST have
   an existing security association with the home agent identified in
   the registration request, and append a revocation support extension
   (defined in <a href="#section-3.2">Section 3.2</a>.) to it.  If the corresponding registration
   reply from this home agent does not contain a revocation support
   extension, the foreign agent SHOULD assume the home agent does not
   understand registration revocation, or is unwilling to participate.
   If this is unacceptable to the foreign agent, it MAY deny the
   registration with e.g., &quot;Administratively Prohibited&quot;.  Note that in
   this case, where a security association exists, as specified in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>],
   both registration request and registration reply MUST still contain
   home-foreign authenticators.

   If a home agent wishes to be able to exchange revocation messages
   with the foreign domain, it MUST have an existing security
   association with the foreign agent who relayed the registration
   request, and it MUST append a revocation support extension to the



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 17]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-18" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   registration reply.  If the registration request from a foreign agent
   did not contain a revocation support extension, the home agent SHOULD
   assume the foreign agent does not understand registration revocation,
   or is unwilling to participate specifically for this binding.  If
   this is unacceptable to the home agent, it MAY deny the registration
   with e.g., &quot;Administratively Prohibited&quot;.  The home agent MAY include
   a revocation support extension in the registration reply.

   If a &#x27;direct&#x27; co-located mobile node wishes to be informed of a
   released binding by its home agent, it MUST insert a revocation
   support extension into the registration request.  If this is
   acceptable to the home agent, it MUST include a revocation support
   extension in its registration reply.  Note that if this is not
   acceptable, the home agent MAY deny the registration, or it MAY
   simply not include a revocation support extension in its registration
   reply indicating to the mobile node that it will not participate in
   revocation for this binding.  A home agent which receives a
   registration request from a &#x27;direct&#x27; co-located mobile node which
   does not contain a revocation support extension MAY deny the
   registration with e.g., &quot;Administratively Prohibited&quot; and also MAY or
   MAY NOT include a revocation support extension in the registration
   reply.

   Note that a non-colocated mobile node MUST NOT insert a revocation
   support extension into its registration request.  If a foreign agent
   receives such a registration request, it MUST silently discard it,
   and MAY log it as a protocol error.

   The &#x27;I&#x27; bit in the revocation extension is used to indicate whether
   or not the decision to inform the mobile node that its binding is
   terminated will be left to the home agent.  This functionality is
   offered by the foreign agent, and accepted by the home agent.  More
   precisely, by sending a revocation extension attached to a
   registration request in which the &#x27;I&#x27; bit is set to 1, the foreign
   agent is indicating to the home agent that it MAY leave the decision
   to inform this mobile node that its registration is terminated up to
   the home agent.  (The term &quot;MAY&quot; is used here because it is
   recognized that domain policy may change during the lifetime of any
   registration).  The home agent can acknowledge that it wishes to do
   this by setting the &#x27;I&#x27; bit to 1, or it can indicate it will not do
   so by setting the &#x27;I&#x27; bit to 0, in the revocation extension appearing
   in the registration reply.

   Revocation support is considered to be negotiated for a binding when
   both sides have included a revocation support extension during a
   successful registration exchange.





<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 18]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-19" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


<span class="h4"><a class="selflink" id="section-4.2.2" href="#section-4.2.2">4.2.2</a>.  Home Domain Revoking/Releasing a Registration</span>

   The following section details the responsibilities of each party
   depending on the functionality negotiated in the revocation support
   extensions when the home domain is revoking a registration.

<span class="h5"><a class="selflink" id="section-4.2.2.1" href="#section-4.2.2.1">4.2.2.1</a>.  Home Agent Responsibilities</span>

   In the case where a home agent is revoking a mobile node&#x27;s binding,
   and revocation support has been negotiated, the home agent MUST
   notify the foreign domain address it is terminating the tunnel entry
   point by sending a revocation message.  Note that the foreign domain
   address can either be the foreign agent care-of address, or the co-
   located care-of address of a &#x27;direct&#x27; co-located mobile node.

   As a home agent, it MUST set the &#x27;A&#x27; bit to &#x27;1&#x27;, indicating this
   packet is coming from the home agent servicing this binding.

   When a revocation message is being sent to a foreign agent, and the
   use of the &#x27;I&#x27; bit was negotiated in the registration process, the
   home agent MUST set the &#x27;I&#x27; bit to 1 if the home agent would like the
   foreign agent to inform the mobile node of the revocation.
   Conversely, if the home agent does not want the mobile node notified,
   it MUST set the &#x27;I&#x27; bit to 0.  Note that the home agent could also
   set the &#x27;I&#x27; bit to &#x27;0&#x27; because it knows the mobile node has
   registered with a different foreign agent, and so there is no need
   for the foreign agent to attempt a notification.

   The home agent MUST set the Identifier field as defined in <a href="#section-3.5">Section</a>
   <a href="#section-3.5">3.5</a>., and MUST include a valid authenticator as specified in <a href="#section-3.3">Section</a>
   <a href="#section-3.3">3.3</a>.

   If the home agent does not receive a revocation acknowledgment
   message within a reasonable amount of time, it MUST retransmit the
   revocation message.  How long the home agent waits to retransmit, and
   how many times the message is retransmitted is limited by the
   requirement that:

   -  every time the home agent is about to retransmit the revocation
      message, it MUST update the value of the timestamp in the
      revocation identifier with a current value from the same clock
      used to generate the timestamps in the revocation extensions sent
      to this foreign agent.  Note that this also necessarily means
      updating any fields derived using the revocation identifier (e.g.,
      a home-foreign authenticator).

   -  the home agent MUST NOT send more than one revocation per second
      for a particular binding,



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 19]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-20" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   -  the time between retransmissions SHOULD fall-back in analogy with
      the registration guidelines in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], namely exponential backoff,
      and

   -  the home agent MUST NOT retransmit revocation messages beyond the
      normal life of the binding identified by the revocation message.

<span class="h5"><a class="selflink" id="section-4.2.2.2" href="#section-4.2.2.2">4.2.2.2</a>.  Foreign Agent Responsibilities</span>

   Upon receiving a registration revocation message, the foreign agent
   MUST check that the validity of the authenticator, the &#x27;A&#x27; bit, and
   the identifier field against replay as defined by <a href="#section-3.5">Section 3.5</a>.  The
   foreign agent MUST also identify the binding described by the home
   agent as being released using the information in the revocation
   message, namely the addresses identified by the mobile node address,
   the foreign domain address, the home domain address, as well as the
   timestamp in the revocation message, and also the timestamp in the
   last accepted registration message; revocations are only valid for
   existing registrations, and so the timestamp of a registration MUST
   precede the revocation message (note that both of those timestamps
   were set by the same home agent).  Upon locating the binding, the
   foreign agent MUST revoke it, and MUST respond with a revocation
   acknowledgment sent to the source address of the revocation message.
   If the &#x27;I&#x27; bit was negotiated, the foreign agent MUST check the value
   of the &#x27;I&#x27; bit in the revocation message and act accordingly.

   If notifying the mobile node by the methods described in <a href="#section-4.1">Section</a>
   <a href="#section-4.1">4.1</a>., the foreign agent MUST set the &#x27;I&#x27; bit to &#x27;1&#x27; in the revocation
   acknowledgment to be sent to the home agent, or if not notifying the
   mobile node, the foreign agent MUST set the &#x27;I&#x27; bit to &#x27;0&#x27;.

   The foreign agent may discontinue all Mobile IP services by the
   former binding at this time, and free up any resources that were
   being used by it.

   The foreign agent MUST then generate a revocation acknowledgment,
   setting the Home Address and Identifier field in the revocation
   acknowledgment message as described by <a href="#section-3.5">Section 3.5</a>., and protect it
   with a valid authenticator as specified in <a href="#section-3.3">Section 3.3</a>.

<span class="h5"><a class="selflink" id="section-4.2.2.3" href="#section-4.2.2.3">4.2.2.3</a>.  &#x27;Direct&#x27; co-located mobile node Responsibilities</span>

   Upon receiving a revocation message, the &#x27;direct&#x27; co-located mobile
   node MUST validate the authenticator, and check the home address and
   identifier specified in the revocation message for replay.  If the
   packet passes authentication, and the identifier reveals this
   revocation to be new, the mobile node MUST verify that the
   information contained in the revocation messages identifies the home



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 20]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-21" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   agent with which it has a current binding, that this binding
   identifies correctly this mobile node and any foreign domain address
   it is currently using.  If the mobile node is able to identify such a
   binding, the mobile node SHOULD first generate a revocation
   acknowledgment message which MUST be sent to the IP source address of
   the revocation message.  The mobile node may then terminate any
   reverse tunnel encapsulation [<a href="#ref-C" title="&quot;Reverse Tunneling for Mobile IP, revised&quot;">C</a>] it is using to this home agent, and
   consider its binding revoked, and free up any other resources
   associated with the former binding.

<span class="h4"><a class="selflink" id="section-4.2.3" href="#section-4.2.3">4.2.3</a>.  Foreign Domain Revoking/Releasing a Registration</span>

   The following section details the responsibilities of each party
   depending on the functionality negotiated in the revocation support
   extensions when the foreign domain is revoking a registration.  Note
   that revocation support for a co-located mobile node registering via
   a foreign agent (because the &#x27;R&#x27; bit was set in the agent&#x27;s
   advertisement) is not supported.  See <a href="#section-4.3.1">Section 4.3.1</a>. for details.

<span class="h5"><a class="selflink" id="section-4.2.3.1" href="#section-4.2.3.1">4.2.3.1</a>.  Foreign Agent Responsibilities</span>

   If the use of the &#x27;I&#x27; bit was negotiated, and the foreign domain
   policy of informing the mobile node has not changed since the last
   successful registration exchange, the foreign agent MUST NOT inform
   any mobile node of its revocation at this time.  Instead, the foreign
   agent MUST set the &#x27;I&#x27; bit to &#x27;1&#x27; in the revocation message, thereby
   asking the home agent to use the &#x27;I&#x27; bit in the revocation
   acknowledgment to indicate if it should notify the effected mobile
   nodes.  If the policy on the foreign domain was to not notify the
   mobile node, or if it has changed since the most recent successful
   registration, and the foreign agent is no longer able to use the &#x27;I&#x27;
   bit, the foreign agent MUST set the &#x27;I&#x27; bit to &#x27;0&#x27;, and follow the
   policies of the foreign domain with regard to notifying the mobile
   node.

   Note that the &#x27;A&#x27; bit MUST be set to &#x27;0&#x27; to indicate that the
   revocation message is coming from the foreign agent servicing this
   binding.

   Before transmitting the revocation message, the foreign agent MUST
   set the revocation identifier as described by <a href="#section-3.5">section 3.5</a>., and MUST
   include an authenticator as described by <a href="#section-3.3">section 3.3</a>.

   If the foreign agent does not receive a revocation acknowledgment
   message within a reasonable amount of time, it MUST retransmit the
   revocation message.  How long the foreign agent waits to retransmit,
   and how many times the message is retransmitted is only limited by
   the following specifications:



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 21]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-22" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   -  every time the foreign agent is about to retransmit the revocation
      message, it MUST update the value of the timestamp in the
      revocation identifier with a current value from the same clock
      used to generate the timestamps in the revocation extensions sent
      to this home agent.  Note that this also necessarily means
      updating any fields derived using the revocation identifier (e.g.,
      a home-foreign authenticator).

   -  MUST NOT send more than one revocation per second for a particular
      binding,

   -  SHOULD set its retransmissions to fall-back in analogy with the
      registration guidelines in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], namely exponential backoff, and

   -  MUST NOT retransmit revocation messages beyond the normal life of
      the binding identified by the revocation message.

<span class="h5"><a class="selflink" id="section-4.2.3.2" href="#section-4.2.3.2">4.2.3.2</a>.  Home Agent Responsibilities</span>

   Upon receiving a registration revocation message, the home agent MUST
   check the &#x27;A&#x27; bit, and identifier field, as well as the
   authenticator.  If the packet is acceptable, the home agent MUST
   locate the binding identified by the foreign agent as being released
   using the information in the revocation message, namely the addresses
   identified by the home address, the foreign domain address and the
   home domain address fields.  As revocations are only valid for
   existing registrations, the timestamp of a registration MUST precede
   the revocation message (note that both of those timestamps were set
   by the same foreign agent).  Since this binding is no longer active,
   the home agent can free up any resources associated with the former
   binding and discontinue all Mobile IP services for it.

   Upon processing a valid registration revocation message, the home
   agent MUST send a revocation acknowledgment to the IP source address
   of the registration revocation message.

   If use of the &#x27;I&#x27; bit was negotiated, and the &#x27;I&#x27; bit is set to &#x27;1&#x27;
   in the revocation message, the home agent should decide if it wants
   the mobile node informed of the revocation of this binding.  If it
   does want the mobile node informed, it MUST set the &#x27;I&#x27; bit in the
   revocation acknowledgment message to &#x27;1&#x27;.  If it does not want the
   mobile node informed, it MUST set the &#x27;I&#x27; bit to &#x27;0&#x27;.

   The home agent MUST set the Home Address, and Revocation Identifier
   fields as described by <a href="#section-3.5">Section 3.5</a>., and protect the revocation
   acknowledgment message with a valid authenticator as specified in
   <a href="#section-3.3">Section 3.3</a>.




<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 22]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-23" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


<span class="h4"><a class="selflink" id="section-4.2.4" href="#section-4.2.4">4.2.4</a>.  Mobile Node Deregistering a Registration</span>

   The cases where a mobile node is registered with its home agent,
   whether it is registered directly with its home agent (&#x27;direct&#x27; co-
   located mobile node), or registered via a foreign agent, and wishes
   to terminate its own binding, the mobile node MUST NOT send a
   revocation message, but SHOULD simply deregister the appropriate
   care-of address with its home agent as described by [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].

<span class="h3"><a class="selflink" id="section-4.3" href="#section-4.3">4.3</a>.  Mobile IP Registration Bits in the Revocation Process</span>

   Several of the bits used in the registration process need special
   consideration when using the revocation mechanism.

<span class="h4"><a class="selflink" id="section-4.3.1" href="#section-4.3.1">4.3.1</a>.  The &#x27;R&#x27; Bit in Use</span>

   If the foreign agent wishes to be able to revoke a mobile node&#x27;s
   registration, it MUST set the &#x27;R&#x27; bit in its agent advertisements.
   (A foreign agent advertising the &#x27;R&#x27; bit requests every mobile node,
   even one that is co-located (and whose registration would otherwise
   by-pass the foreign agent), to register with the foreign agent.)
   However, in this case, the foreign agent SHOULD deny a registration
   request as &quot;Administratively Prohibited&quot; from a mobile node that is
   registering in a co-located fashion.  The reason being that the
   foreign agent will not be able to revoke the binding of a co-located
   mobile node due to reasons outlined in <a href="#section-4.3.2">Section 4.3.2</a>.

   How the foreign agent and/or foreign domain enforce the &#x27;R&#x27; bit is
   beyond the scope of this document.

<span class="h4"><a class="selflink" id="section-4.3.2" href="#section-4.3.2">4.3.2</a>.  The &#x27;D&#x27; bit in Use</span>

   A mobile node registering directly with its home agent in a co-
   located fashion with the &#x27;D&#x27; bit set in its registration request is
   supported in registration revocation.  However, support for a co-
   located mobile node (with the &#x27;D&#x27; bit set in its registration
   request) registering via a foreign agent is not supported for the
   following reasons.

   Registration requests where the &#x27;D&#x27; bit is set, and which are relayed
   through a foreign agent (e.g., due to the advertising of the &#x27;R&#x27; bit)
   should theoretically contain the foreign agent address as the source
   address of the registration request when received by the home agent.
   A home agent may conclude that the source address of this
   registration request is not the same as the co-located care-of
   address contained in the registration request, and is therefore
   likely to be the address of the foreign agent.  However, since there
   is no way to guarantee that this IP source address is in fact an



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 23]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-24" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   address of the foreign agent servicing the mobile node, accepting a
   revocation message from this IP source address may lead to a denial-
   of-service attack by a man-in-the-middle on the mobile node.

   Moreover, there is currently no method for the foreign agent
   servicing the mobile node to identify itself to the home agent during
   the Mobile IP registration phase.  Even if a foreign agent could
   identify itself, the co-located mobile node would also need to
   authorize that this foreign agent is indeed the agent that is
   providing it the Mobile IP services.  This is to thwart a denial-of-
   service attack on the mobile node by a foreign agent that has a
   security association with the home agent, and is on the path between
   the co-located mobile node and the home agent.

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  Error Codes</span>

   As the intent of a registration revocation message is not a request
   to discontinue services, but is a notification that Mobile IP
   services are discontinued, there are no new error codes.

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Security Considerations</span>

   There are two potential vulnerabilities, one in the agent
   advertisement mechanism, and one related to unauthorized revocation
   messages.

<span class="h3"><a class="selflink" id="section-6.1" href="#section-6.1">6.1</a>.  Agent Advertisements</span>

   Although the mechanisms defined by this document do not introduce
   this problem, it has been recognized that agent advertisements as
   defined in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] subject mobile nodes to a denial-of-service potential.
   This is because the agent advertisement as defined in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] may be
   spoofed by other machines residing on the link.  This makes it
   possible for such nodes to trick the mobile node into believing its
   registration has been revoked either by unicasting an advertisement
   with a reset sequence number to the link-local address of the mobile
   node, or by broadcasting it to the subnet, thereby tricking all
   mobile nodes registered with a particular foreign agent into
   believing all their registrations have been lost.

   There has been some work in this working group and others (e.g.,
   IPsec) to secure such router advertisements, though at the time of
   this publication, no solutions have become common practice.  To help
   circumvent possible denial of service issues here, bringing their
   potential for disruption to a minimum, mobile node implementors
   should ensure that any agent advertisement which doesn&#x27;t conform to a
   strict adherence to [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], specifically those whose TTL is not 1, or
   which do not emanate from the same link-address (when present) as



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 24]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-25" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   other agent advertisements supposedly from the same agent, or even
   that of the last successful registration reply, be silently
   discarded.

<span class="h3"><a class="selflink" id="section-6.2" href="#section-6.2">6.2</a>.  Revocation Messages</span>

   As registration revocation, when performed, terminates Mobile IP
   services being provided to the mobile node, it is crucial that all
   security and replay protection mechanisms be verified before a
   mobility agent believes that the other agent has revoked a binding.
   Messages which are sent link-local (e.g., between mobile node and
   foreign agent) MAY also be secured by methods outlined in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>], namely
   the use of mobile-foreign authenticators, but these have no direct
   relation to registration revocation.

   <a href="/doc/html/rfc3344">RFC 3344</a> [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] defines a security mechanism that MUST be used between
   home agents and mobile nodes, and MAY used between home agents and
   foreign agents, namely the use of authenticators.  All foreign and
   home agents MUST support protection of revocation messages via the
   foreign-home authenticators defined in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].  They MAY implement other
   mechanisms of equal or greater strength; if such mechanisms are known
   to be available to both parties, they MAY be used instead.

   Revocation messages are at least as secure as registration messages
   passed between home and foreign agents and containing home-foreign
   authenticators as defined in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>].  Thus, there are no new security
   threats introduced by the revocation mechanism other than those
   present in [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] with respect to the compromise of the shared secret
   which is used to generate the home-foreign authenticators.

   That said, there are two types of active attacks which use messages
   captured &quot;in flight&quot; by a man-in-the-middle between the home and
   foreign agents - &quot;malicious repeaters&quot; and &quot;malicious reflectors&quot;.

   In the case of a &quot;malicious repeater&quot;, a man-in-the-middle captures a
   revocation message, then replays it to the same IP destination
   address at a later time.  Presuming the authenticator of the original
   packet was deemed valid, without replay protection, the home-foreign
   authenticator of the replayed packet will (again) pass
   authentication.  Note that since datagrams are not guaranteed to
   arrive unduplicated, a replay may occur by &quot;design&quot;.

   In the case of a &quot;malicious reflector,&quot; a man-in-the-middle captures
   a revocation message, then returns it to its originator at a later
   time.  If the security association between home and foreign domains
   uses a security association involving a (single) shared secret which
   only protects the contents of the UDP portion of the packet (such as
   home-foreign authenticators as defined by [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>]), without replay



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 25]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-26" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   protection, the sender of the packet will also believe the revocation
   message to be authentic.

   The replay protection mechanism used by the revocation messages
   defined by this document is designed to protect against both of these
   active attacks.  As a benefit, by using a 32-bit timestamp it can be
   more quickly determined if revocation messages are replays, though
   the reader is advised to use caution in this approach.  An agent
   which receives an authenticated revocation message can compare the
   Identifier field to that of a previously received revocation message,
   and if the timestamp in the new message is found to have been
   generated after that of the time-stamp in the last revocation message
   received, it can immediately be determined as not being a replay.
   Note however that since datagrams are not guaranteed to arrive in
   order, it should not be presumed that because the values contained in
   an Identifier field are timestamps that they will necessarily be
   increasing with each successive revocation message received.  Should
   an implementor decide to base his replay detection mechanism on
   increasing timestamps, and therefore increasing Identifier values, a
   suitable time window should be defined in which revocation messages
   can be received.  At worst, ignoring any revocation message should
   result in the retransmission of another revocation message, this time
   with timestamp later than the last one received.

   Note that any registration request or reply can be replayed.  With
   the exchanging of time-stamps by agents in revocation extensions, an
   agent should have a belief that such messages have been delivered in
   a timely manner.  For purposes of registration revocation, the
   timeliness of a registration packet is simply based on the
   granularity of each registration.  Since [<a href="#ref-1" title="&quot;IP Mobility Support for IPv4&quot;">1</a>] provides a replay
   mechanism for the home agent to use, it has a way to tell if the
   registration request being presented to it is new.  The foreign
   agent, however, has no such mechanism in place with the mobile node.
   Foreign agents are advised to continue to consider registrations
   &#x27;outstanding&#x27; until the associated registration reply is returned
   from the home agent before using the information in any of its
   visitor entries.  Even so, this leaves the foreign agent open to a
   potential denial of service attack in which registration requests and
   replies are replayed by multiple nodes.  When this happens, the
   foreign agent could be lead to believe such registrations are active,
   but with old information, which can have adverse effects on them, as
   well as to the ability of that agent to successfully use the
   procedures outlined in this document.  Sufficient protection against
   this scenario is offered by the challenge-response mechanism [<a href="#ref-2" title="&quot;Mobile IPv4 Challenge/Response Extensions&quot;">2</a>] by
   which a foreign agent generates a live challenge to a mobile node for
   the purposes of making sure, among other things, that the
   registration request is not a replay.




<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 26]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-27" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  IANA Considerations</span>

   This document defines an additional set of messages between the home
   and foreign agent specific to the services being provided to the same
   mobile node, or sub-set of mobile nodes.  To ensure correct
   interoperation based on this specification, IANA has reserved values
   in the Mobile IP number space for two new message types, and a single
   new extension.

<span class="h3"><a class="selflink" id="section-7.1" href="#section-7.1">7.1</a>.  New Message Types</span>

   The following message types are introduced by this specification:

   Registration Revocation: A new Mobile IP control message, using UDP
   port 434, type 7.  This value has been taken from the same number
   space as Mobile IP Registration Request (Type = 1), and Mobile IP
   Registration Reply (Type = 3).

   Registration Revocation Acknowledgment: A new Mobile IP control
   message, using UDP port 434, type 15.  This value has been taken from
   the same number space as Mobile IP Registration Request (Type = 1),
   and Mobile IP Registration Reply (Type = 3).

<span class="h3"><a class="selflink" id="section-7.2" href="#section-7.2">7.2</a>.  New Extension Values</span>

   The following extensions are introduced by this specification:

   Revocation Support Extension: A new Mobile IP Extension, appended to
   a Registration Request, or Registration Reply.  The value assigned is
   137.  This extension is derived from the Extension number space.  It
   MUST be in the &#x27;skippable&#x27; (128 - 255) range as defined in <a href="/doc/html/rfc3344">RFC 3344</a>.

<span class="h3"><a class="selflink" id="section-7.3" href="#section-7.3">7.3</a>.  New Error Codes</span>

   There are no new Mobile IP error codes introduced by this document.

<span class="h2"><a class="selflink" id="section-8" href="#section-8">8</a>.  References</span>

<span class="h3"><a class="selflink" id="section-8.1" href="#section-8.1">8.1</a>.  Normative References (Numerical)</span>

   [<a id="ref-1">1</a>] Perkins, C., Ed., &quot;IP Mobility Support for IPv4&quot;, <a href="/doc/html/rfc3344">RFC 3344</a>,
       August 2002.

   [<a id="ref-2">2</a>] Perkins, C. and P. Calhoun, &quot;Mobile IPv4 Challenge/Response
       Extensions&quot;, <a href="/doc/html/rfc3012">RFC 3012</a>, November 2000.

   [<a id="ref-3">3</a>] Bradner, S., &quot;Key Words for us in RFCs to Indicate Requirement
       Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>, March 1997.



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 27]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-28" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


<span class="h3"><a class="selflink" id="section-8.2" href="#section-8.2">8.2</a>.  Informational References (Alphabetical)</span>

   [<a id="ref-A">A</a>] Glass, S., Hiller, T., Jacobs, S. and C. Perkins, &quot;Mobile IP
       Authentication, Authorization, and Accounting Requirements&quot;, <a href="/doc/html/rfc2977">RFC</a>
       <a href="/doc/html/rfc2977">2977</a>, October 2000.

   [<a id="ref-B">B</a>] Aboba, B., Calhoun, P., Glass, S., Hiller, T., McCann, P.,
       Shiino, H., Walsh, P., Zorn, G., Dommety, G., Perkins, C., Patil,
       B., Mitton, D., Manning, S., Beadles, M., Chen, X., Sivalingham,
       S., Hameed, A., Munson, M., Jacobs, S., Lim, B., Hirschman, B.,
       Hsu, R., Koo, H., Lipford, M., Campbell, E., Xu, Y., Baba, S. and
       E. Jaques, &quot;Criteria for Evaluating AAA Protocols for Network
       Access&quot;, <a href="/doc/html/rfc2989">RFC 2989</a>, November 2000.

   [<a id="ref-C">C</a>] Montenegro, G., Ed., &quot;Reverse Tunneling for Mobile IP, revised&quot;,
       <a href="/doc/html/rfc3024">RFC 3024</a>, January 2001.

   [<a id="ref-D">D</a>] Deering, S., Ed., &quot;ICMP Router Discovery Messages&quot;, <a href="/doc/html/rfc1256">RFC 1256</a>,
       September 1991.

   [<a id="ref-E">E</a>] Calhoun, P. and C. Perkins, &quot;Mobile IP Network Access Identifier
       Extension for IPv4&quot;, <a href="/doc/html/rfc2794">RFC 2794</a>, March 2000.





























<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 28]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-29" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


Appendix A: An Example of the Revocation Messages in Use

   For clarity, the following example is meant to illustrate the use of
   the new messages in the registration phase, and the revocation phase.
   In this example, a foreign agent and home agent will negotiate
   revocation during the registration phase.  During the revocation
   phase, the foreign agent will revoke the binding of a mobile node.

<span class="h3"><a class="selflink" id="appendix-A.1" href="#appendix-A.1">A.1</a>.  The Registration Phase</span>

   Consider a foreign agent that supports registration revocation, and
   has a security association with a home agent to which it is
   forwarding a registration request.  The foreign agent will include
   the revocation support extension after the mobile-home authenticator.
   Assume that the foreign agent supports the use of the &#x27;I&#x27; bit, and is
   willing to let the home agent decide if the mobile node should be
   informed of the revocation of its registration. Thus, the foreign
   agent will set the &#x27;I&#x27; bit to &#x27;1&#x27;.  The foreign agent will append a
   foreign-home authenticator to the registration request.

   Upon receiving the registration request containing a revocation
   extension, the home agent will include a revocation support extension
   in the registration reply.  Since the foreign agent set the &#x27;I&#x27; bit
   to &#x27;1&#x27; in its revocation extension, and the home agent supports the
   use of the &#x27;I&#x27; bit, the home agent will set the &#x27;I&#x27; bit in its
   registration extension to &#x27;1&#x27;.  Additionally, the home agent will
   append a home-foreign authenticator to the registration request.

   Upon receiving the authenticated registration reply, the foreign
   agent will check the revocation support extension and note that the
   home agent wants to decide if the mobile node should be notified in
   the event this registration is revoked, i.e., since the home agent
   set the &#x27;I&#x27; bit in the return revocation extension.

<span class="h3"><a class="selflink" id="appendix-A.2" href="#appendix-A.2">A.2</a>.  The Revocation Phase</span>

   The foreign agent revokes a mobile node&#x27;s binding, and generates a
   revocation message to be sent to the mobile node&#x27;s home agent.  Since
   the &#x27;I&#x27; bit was negotiated in the revocation extensions, and the
   foreign agent is still willing to let the home agent indicate whether
   this mobile node should be informed about the revocation, it will set
   the &#x27;I&#x27; bit to &#x27;1&#x27; in the revocation message.  The foreign agent also
   makes sure the &#x27;A&#x27; bit is set to &#x27;0&#x27;.

   The foreign agent will also place the address of the mobile node
   whose registration it wishes to revoke in the home address field, the
   address that the mobile node registered as the care-of address in the
   foreign domain field, and the address registered as the home agent in



<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 29]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-30" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   the home domain address field.  The foreign agent will set the
   Revocation Identifier to the current 32-bit timestamp, and append the
   foreign-home authenticator.

   Upon receiving the above revocation message, the home agent uses the
   address identified as the foreign domain address to identify the
   security association, and authenticate the revocation message.  After
   authenticating the message, the home agent will check to make sure
   the &#x27;A&#x27; bit and Identifier indicate that this revocation is not a
   replay.  The home agent then uses the mobile node home address,
   foreign domain address, and home domain address to locate the mobile
   node whose registration is being revoked.

   Upon processing a valid registration revocation message, the home
   agent generates a revocation acknowledgment message.  Since the &#x27;I&#x27;
   bit was set to &#x27;1&#x27; in the revocation message and the home agent
   wishes for the identified mobile node to be informed of the
   revocation, it will set the &#x27;I&#x27; bit in the revocation acknowledgment
   to &#x27;1&#x27;.  The home agent then copies the home address and the
   Revocation Identifier field into the revocation acknowledgement.  The
   home agent protects the revocation acknowledgment with a home-foreign
   authenticator.

   Upon receiving a valid revocation acknowledgment (in which the
   authenticator and Identifier fields are acceptable), the foreign
   agent checks the state of the &#x27;I&#x27; bit.  Since the &#x27;I&#x27; bit is set to
   &#x27;1&#x27;, the foreign agent will notify the mobile node of the revocation.

Appendix B:  Disparate Address, and Receiver Considerations

   Since the registration revocation message comes from a source address
   that is topologically routable from the interface receiving the
   datagram, the agents, by definition, are topologically connected (if
   this were not the case, the initial registration mechanism would have
   failed).  If either are the ultimate hop from this topologically
   connected region to one or more disparate address spaces, no problems
   are foreseen.  In order for the mobile node to have successfully
   registered with its home agent, it MUST have provided to the network
   (foreign agent) to which it is currently attached a routable address
   of its home agent.  Conversely, the care-of address being used by the
   mobile node must also be topologically significant to the home agent
   in order for the registration reply to have been received, and the
   tunnel initiated.  By definition, then, the home agent address and
   the care-of address must each be significant, and either address must
   form a unique pair in the context of this mobile node to both agents.






<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 30]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-31" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


   Another way of understanding this is that the tunnel endpoints are in
   some way connected, and hence each are unique as far as the other end
   is concerned.  The address at the other end of the tunnel, in
   combination with the address of the mobile node, must therefore form
   a unique pair that can be identified by the agent receiving the
   registration revocation message.

   As an example, consider a mobile node who&#x27;s home address lies in
   disparate address space A behind its home agent.  In the following
   diagram, [*] indicates an interface of the entity in which it
   appears.

      MN[a]-----[c]FA[b]=====((()))=====[b]HA[a]-----[a]CN

          Address      Some topologically      Address
          Space C      connected network       Space A

   We presume a binding for MN exists, and hence a tunnel between FA[b]
   and HA[b] exists.  Then, since the address assigned to MN[a] MUST be
   unique in address space A, the pair {FA[b],MN[a]} is guaranteed to be
   unique in the binding table of HA, and the pair {HA[b],MN[a]} is
   guaranteed to be unique in the foreign agent&#x27;s visitor list.

   As a result, a home agent receiving a registration revocation message
   and foreign-home authenticator for MN[a] from FA[b] is able to
   determine the unique mobile node address being deregistered.
   Conversely a foreign agent receiving a registration revocation
   message and home-foreign authenticator for MN[a] from HA[b] is able
   to determine the exact mobile node address being deregistered.  For
   this reason, if a foreign agent receives a registration revocation
   message with the home domain field set to the zero address it MUST be
   silently discarded.  This is to prevent confusion in the case of
   overlapping private addresses; when multiple mobile nodes are
   registered via the same care-of address and coincidentally using the
   same (disparate/private) home address, the home agent address
   appearing in the home domain field is the only way a foreign agent
   can discern the difference between these mobile nodes.














<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 31]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-32" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


Acknowledgments

   The authors would like to thank Rajesh Bhalla, Kent Leung, and Alpesh
   Patel for their contributions to the concepts detailed in
   <a href="/doc/html/draft-subbarao-mobileip-resource-00.txt">draft-subbarao-mobileip-resource-00.txt</a>, &quot;Releasing Resources in
   Mobile IP,&quot; from which the revocation support extension, and the
   acknowledgment mechanism contained in this document were derived.

   The authors would also like to thank Pete McCann for his discussions
   on replay mechanisms, and security concerns, and Ahmad Muhanna for
   pointing out a problem with the initial replay mechanism, which
   eventually lead to the addition of a time stamp to the Revocation
   Extension.

   The authors would also like to acknowledge Henrik Levkowetz for his
   detailed review of the document, and Michael Thomas for his review of
   the replay mechanism described herein.

Authors&#x27; Addresses

   Steven M. Glass
   Solaris Network Technologies
   Sun Microsystems
   1 Network Drive
   Burlington, MA.  01801

   Phone: +1.781.442.0000
   Fax:   +1.781.442.1706
   EMail: steven.glass@sun.com


   Madhavi W. Chandra
   IOS Technologies Division
   Cisco Systems
   7025 Kit Creek Road
   Research Triangle Park, NC 27709

   Phone: +1.919.392.8387
   EMail: mchandra@cisco.com












<span class="grey">Glass &amp; Chandra             Standards Track                    [Page 32]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-33" ></span>
<span class="grey"><a href="/doc/html/rfc3543">RFC 3543</a>         Registration Revocation in Mobile IPv4      August 2003</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2003).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assignees.

   This document and the information contained herein is provided on an
   &quot;AS IS&quot; basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Glass &amp; Chandra             Standards Track                    [Page 33]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

