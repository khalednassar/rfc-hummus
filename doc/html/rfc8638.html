<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    rfc8638
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.33.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.33.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-softwire-mesh-multicast/">
  <meta name="description" content="IPv4 Multicast over an IPv6 Multicast in Softwire Mesh Networks (RFC )">
  <script src="https://www.ietf.org/lib/dt/7.33.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.33.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.33.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.33.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgblue"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.rfc-editor.org/rfc/rfc8638.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.rfc-editor.org/rfc/rfc8638.html" title="HTML version of this document, from XML2RFC">html</a>|<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc8638.txt.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/rfc8638/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/rfc8638/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/softwire/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-softwire-mesh-multicast@ietf.org?subject=draft-ietf-softwire-mesh-multicast" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-softwire-mesh-multicast-25.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-softwire-mesh-multicast-25.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-softwire-mesh-multicast-25.txt" title="Run an idnits check of this document">Nits</a>]

From: <a href="/doc/html/draft-ietf-softwire-mesh-multicast-25">draft-ietf-softwire-mesh-multicast-25</a>            Proposed Standard</pre>
      </div>
    

    <div class="draftcontent">
    <pre>Internet Engineering Task Force (IETF)                             M. Xu
Request for Comments: 8638                                        Y. Cui
Category: Standards Track                                          J. Wu
ISSN: 2070-1721                                      Tsinghua University
                                                                 S. Yang
                                                     Shenzhen University
                                                                 C. Metz
                                                           Cisco Systems
                                                          September 2019


    <span class="h1">IPv4 Multicast over an IPv6 Multicast in Softwire Mesh Networks</span>

Abstract

   During the transition to IPv6, there are scenarios where a backbone
   network internally running one IP address family (referred to as the
   internal IP or I-IP family) connects client networks running another
   IP address family (referred to as the external IP or E-IP family).
   In such cases, the I-IP backbone needs to offer both unicast and
   multicast transit services to the client E-IP networks.

   This document describes a mechanism for supporting multicast across
   backbone networks where the I-IP and E-IP protocol families differ.
   The document focuses on the IPv4-over-IPv6 scenario, due to lack of
   real-world use cases for the IPv6-over-IPv4 scenario.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="/doc/html/rfc7841#section-2">Section&nbsp;2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8638">https://www.rfc-editor.org/info/rfc8638</a>.











<span class="grey">Xu, et al.                   Standards Track                    [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust&#x27;s Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Requirements Language . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-3">3</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-4">4</a>.  Scope . . . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-5">5</a>.  Mesh Multicast Mechanism  . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-5.1">5.1</a>.  Mechanism Overview  . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-5.2">5.2</a>.  Group Address Mapping . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-5.3">5.3</a>.  Source Address Mapping  . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-5.4">5.4</a>.  Routing Mechanism . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#section-6">6</a>.  Control-Plane Functions of AFBR . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.1">6.1</a>.  E-IP (*,G) and (S,G) State Maintenance  . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.2">6.2</a>.  I-IP (S&#x27;,G&#x27;) State Maintenance  . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.3">6.3</a>.  E-IP (S,G,rpt) State Maintenance  . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.4">6.4</a>.  Inter-AFBR Signaling  . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.5">6.5</a>.  SPT Switchover  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-6.6">6.6</a>.  Other PIM Message Types . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-6.7">6.7</a>.  Maintenance of Other PIM States . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-7">7</a>.  Data-Plane Functions of the AFBR  . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-7.1">7.1</a>.  Process and Forward Multicast Data  . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-7.2">7.2</a>.  TTL or Hop Count  . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-7.3">7.3</a>.  Fragmentation . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-8">8</a>.  Packet Format and Translation . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-9">9</a>.  Softwire Mesh Multicast Encapsulation . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-10">10</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-11">11</a>. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-12">12</a>. Normative References  . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
   Authors&#x27; Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>






<span class="grey">Xu, et al.                   Standards Track                    [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction</span>

   During the transition to IPv6, there are scenarios where a backbone
   network internally running one IP address family (referred to as the
   internal IP or I-IP family) connects client networks running another
   IP address family (referred to as the external IP or E-IP family).

   One solution is to leverage the multicast functions inherent in the
   I-IP backbone to efficiently forward client E-IP multicast packets
   inside an I-IP core tree.  The I-IP tree is rooted at one or more
   ingress Address Family Border Routers (AFBRs) [<a href="/doc/html/rfc5565" title="&quot;Softwire Mesh Framework&quot;">RFC5565</a>] and branches
   out to one or more egress AFBRs.

   [<a id="ref-RFC4925">RFC4925</a>] outlines the requirements for the softwire mesh scenario
   and includes support for multicast traffic.  It is likely that client
   E-IP multicast sources and receivers will reside in different client
   E-IP networks connected to an I-IP backbone network.  This requires
   the source-rooted or shared tree of the client E-IP to traverse the
   I-IP backbone network.

   This could be accomplished by reusing the multicast VPN (MVPN)
   approach outlined in [<a href="/doc/html/rfc6513" title="&quot;Multicast in MPLS/ BGP IP VPNs&quot;">RFC6513</a>].  MVPN-like schemes can support the
   softwire mesh scenario and achieve a &quot;many-to-one&quot; mapping between
   the E-IP client multicast trees and the transit-core multicast trees.
   The advantage of this approach is that the number of trees in the
   I-IP backbone network scales less than linearly with the number of
   E-IP client trees.  Corporate enterprise networks, and by extension
   multicast VPNs, have been known to run applications that create too
   many (S,G) states, which are source-specific states related to a
   specified multicast group [<a href="/doc/html/rfc7761" title="&quot;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)&quot;">RFC7761</a>] [<a href="/doc/html/rfc7899" title="&quot;Multicast VPN State Damping&quot;">RFC7899</a>].  Aggregation at the
   edge contains the (S,G) states for customers&#x27; VPNs and these need to
   be maintained by the network operator.  The disadvantage of this
   approach is the possibility of inefficient bandwidth and resource
   utilization when multicast packets are delivered to a receiving AFBR
   with no attached E-IP receivers.

   [<a id="ref-RFC8114">RFC8114</a>] provides a solution for delivering IPv4 multicast services
   over an IPv6 network, but it mainly focuses on the DS-Lite scenario
   [<a href="/doc/html/rfc6333" title="&quot;Dual- Stack Lite Broadband Deployments Following IPv4 Exhaustion&quot;">RFC6333</a>], where IPv4 addresses assigned by a broadband service
   provider are shared among customers.  This document describes a
   detailed solution for the IPv4-over-IPv6 softwire mesh scenario,
   where client networks run IPv4 and the backbone network runs IPv6.

   Internet-style multicast is somewhat different from the scenario in
   [<a href="/doc/html/rfc8114" title="&quot;Delivery of IPv4 Multicast Services to IPv4 Clients over an IPv6 Multicast Network&quot;">RFC8114</a>] in that the trees are source-rooted and relatively sparse.
   The need for multicast aggregation at the edge (where many customer





<span class="grey">Xu, et al.                   Standards Track                    [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   multicast trees are mapped to one or more backbone multicast trees)
   does not exist and to date has not been identified.  Thus, the need
   for alignment between the E-IP and I-IP multicast mechanisms emerges.

   [<a id="ref-RFC5565">RFC5565</a>] describes the &quot;Softwire Mesh Framework&quot;.  This document
   provides a more detailed description of how one-to-one mapping
   schemes (<a href="/doc/html/rfc5565#section-11.1">[RFC5565], Section&nbsp;11.1</a>) for IPv4-over-IPv6 multicast can be
   achieved.

   Figure 1 shows an example of how a softwire mesh network can support
   multicast traffic.  A multicast source S is located in one E-IP
   client network, while candidate E-IP group receivers are located in
   the same or different E-IP client networks that all share a common
   I-IP transit network.  When E-IP sources and receivers are not local
   to each other, they can only communicate with each other through the
   I-IP core.  There may be several E-IP sources for a single multicast
   group residing in different client E-IP networks.  In the case of
   shared trees, the E-IP sources, receivers, and rendezvous points
   (RPs) might be located in different client E-IP networks.  In the
   simplest case, a single operator manages the resources of the I-IP
   core, although the inter-operator case is also possible and so not
   precluded.

                   +---------+          +---------+
                   |         |          |         |  +--------+
                   |  E-IP   |          |  E-IP   +--+Source S|
                   | network |          | network |  +--------+
                   +---+-----+          +--+------+
                       |                   |
                     +-+--------+  +-------+--+
                     |          |  | upstream |
                   +-|   AFBR   +--+   AFBR   |-+
                   | +----------+  +----------+ |
                   |                            |  E-IP multicast
                   |      I-IP transit core     |  packets are forwarded
                   |                            |  across the I-IP
                   | +----------+  +----------+ |  transit core
                   +-|downstream|  |downstream|-+
                     |   AFBR   |--|   AFBR   |
                     +--+-------+  +--------+-+
                        |                   |
                    +---+----+          +---+----+
       +--------+   |        |          |        |  +--------+
       |Receiver+---+  E-IP  |          |  E-IP  +--+Receiver|
       +--------+   |network |          |network |  +--------+
                    +--------+          +--------+

                Figure 1: Softwire Mesh Multicast Framework



<span class="grey">Xu, et al.                   Standards Track                    [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Requirements Language</span>

   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;NOT RECOMMENDED&quot;, &quot;MAY&quot;, and
   &quot;OPTIONAL&quot; in this document are to be interpreted as described in
   <a href="/doc/html/bcp14">BCP 14</a> [<a href="/doc/html/rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>] [<a href="/doc/html/rfc8174" title="&quot;Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words&quot;">RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Terminology</span>

   The following terminology is used in this document.

   o  Address Family Border Router (AFBR) - A router interconnecting two
      or more networks using different IP address families.
      Additionally, in the context of softwire mesh multicast, the AFBR
      runs E-IP and I-IP control planes to maintain E-IP and I-IP
      multicast states respectively and performs the appropriate
      encapsulation/decapsulation of client E-IP multicast packets for
      transport across the I-IP core.  An AFBR will act as a source and/
      or receiver in an I-IP multicast tree.

   o  Upstream AFBR: An AFBR that is closer to the source of a multicast
      data flow.

   o  Downstream AFBR: An AFBR that is closer to a receiver of a
      multicast data flow.

   o  I-IP (Internal IP): This refers to the IP address family that is
      supported by the core network.  In this document, the I-IP is
      IPv6.

   o  E-IP (External IP): This refers to the IP address family that is
      supported by the client network(s) attached to the I-IP transit
      core.  In this document, the E-IP is IPv4.

   o  I-IP core tree: A distribution tree rooted at one or more AFBR
      source nodes and branched out to one or more AFBR leaf nodes.  An
      I-IP core tree is built using standard IP or MPLS multicast
      signaling protocols (in this document, we focus on IP multicast)
      operating exclusively inside the I-IP core network.  An I-IP core
      tree is used to forward E-IP multicast packets belonging to E-IP
      trees across the I-IP core.  Another name for an I-IP core tree is
      multicast or multipoint softwire.

   o  E-IP client tree: A distribution tree rooted at one or more hosts
      or routers located inside a client E-IP network and branched out
      to one or more leaf nodes located in the same or different client
      E-IP networks.



<span class="grey">Xu, et al.                   Standards Track                    [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   o  uPrefix64: The /96 unicast IPv6 prefix for constructing an
      IPv4-embedded IPv6 unicast address [<a href="/doc/html/rfc8114" title="&quot;Delivery of IPv4 Multicast Services to IPv4 Clients over an IPv6 Multicast Network&quot;">RFC8114</a>].

   o  mPrefix64: The /96 multicast IPv6 prefix for constructing an
      IPv4-embedded IPv6 multicast address [<a href="/doc/html/rfc8114" title="&quot;Delivery of IPv4 Multicast Services to IPv4 Clients over an IPv6 Multicast Network&quot;">RFC8114</a>].

   o  PIMv4, PIMv6: Refer to [<a href="/doc/html/rfc8114" title="&quot;Delivery of IPv4 Multicast Services to IPv4 Clients over an IPv6 Multicast Network&quot;">RFC8114</a>].

   o  Inter-AFBR signaling: A mechanism used by downstream AFBRs to send
      PIMv6 messages to the upstream AFBR.

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  Scope</span>

   This document focuses on the IPv4-over-IPv6 scenario, as shown in the
   following diagram.

                   +---------+        +---------+
                   |  IPv4   |        |  IPv4   |  +--------+
                   | Client  |        | Client  |--+Source S|
                   | Network |        | Network |  +--------+
                   +----+----+        +----+----+
                        |                  |
                     +--+-------+  +-------+--+
                     |          |  | Upstream |
                   +-+   AFBR   +--+   AFBR   |-+
                   | +----------+  +----------+ |
                   |                            |
                   |      IPv6 transit core     |
                   |                            |
                   | +----------+  +----------+ |
                   +-+Downstream+--+Downstream+-+
                     |   AFBR   |  |   AFBR   |
                     +--+-------+  +-------+--+
                        |                  |
                   +----+----+        +----+----+
       +--------+  |  IPv4   |        |  IPv4   |  +--------+
       |Receiver+--+ Client  |        | Client  +--+Receiver|
       +--------+  | Network |        | Network |  +--------+
                   +---------+        +---------+

                     Figure 2: IPv4-over-IPv6 Scenario

   In Figure 2, the E-IP client networks run IPv4, and the I-IP core
   runs IPv6.

   Because of the much larger IPv6 group address space, the client E-IP
   tree can be mapped to a specific I-IP core tree.  This simplifies
   operations on the AFBR because it becomes possible to algorithmically



<span class="grey">Xu, et al.                   Standards Track                    [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   map an IPv4 group/source address to an IPv6 group/source address and
   vice versa.

   The IPv4-over-IPv6 scenario is an emerging requirement as network
   operators build out native IPv6 backbone networks.  These networks
   support native IPv6 services and applications, but, in many cases,
   support for legacy IPv4 unicast and multicast services will also need
   to be accommodated.

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  Mesh Multicast Mechanism</span>

<span class="h3"><a class="selflink" id="section-5.1" href="#section-5.1">5.1</a>.  Mechanism Overview</span>

   Routers in the client E-IP networks have routes to all other client
   E-IP networks.  Through PIMv4 messages, E-IP hosts and routers have
   discovered or learnt of IPv4 addresses that are in (S,G) or (*,G)
   state [<a href="/doc/html/rfc7761" title="&quot;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)&quot;">RFC7761</a>].  Any I-IP multicast state instantiated in the core
   is referred to as (S&#x27;,G&#x27;) or (*,G&#x27;) and is separated from E-IP
   multicast state.

   Suppose a downstream AFBR receives an E-IP PIM Join/Prune message
   from the E-IP network for either an (S,G) tree or a (*,G) tree.  The
   AFBR translates the PIMv4 message into a PIMv6 message with the
   latter being directed towards the I-IP IPv6 address of the upstream
   AFBR.  When the PIMv6 message arrives at the upstream AFBR, it is
   translated back into a PIMv4 message.  The result of these actions is
   the construction of E-IP trees and a corresponding I-IP tree in the
   I-IP network.  An example of the packet format and translation is
   provided in <a href="#section-8">Section 8</a>.

   In this case, it is incumbent upon the AFBRs to perform PIM message
   conversions in the control plane and IP group address conversions or
   mappings in the data plane.  The AFBRs perform an algorithmic, one-
   to-one mapping of IPv4 to IPv6.

<span class="h3"><a class="selflink" id="section-5.2" href="#section-5.2">5.2</a>.  Group Address Mapping</span>

   A simple algorithmic mapping between IPv4 multicast group addresses
   and IPv6 group addresses is performed.  Figure 3 is provided as a
   reminder of the format:

   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   | 0-------------32--40--48--56--64--72--80--88--96-----------127|
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
   |                    mPrefix64                  | group address |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+

           Figure 3: IPv4-Embedded IPv6 Multicast Address Format



<span class="grey">Xu, et al.                   Standards Track                    [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   An IPv6 multicast prefix (mPrefix64) is provisioned on each AFBR.
   AFBRs will prepend the prefix to an IPv4 multicast group address when
   translating it to an IPv6 multicast group address.

   The construction of the mPrefix64 for Source-Specific Multicast (SSM)
   is the same as the construction of the mPrefix64 described in
   <a href="/doc/html/rfc8114#section-5">Section&nbsp;5 of [RFC8114]</a>.

   With this scheme, each IPv4 multicast address can be mapped to an
   IPv6 multicast address (with the assigned prefix), and each IPv6
   multicast address with the assigned prefix can be mapped to an IPv4
   multicast address.  The group address translation algorithm is
   specified in <a href="/doc/html/rfc8114#section-5.2">Section&nbsp;5.2 of [RFC8114]</a>.

<span class="h3"><a class="selflink" id="section-5.3" href="#section-5.3">5.3</a>.  Source Address Mapping</span>

   There are two kinds of multicast: Any-Source Multicast (ASM) and SSM.
   Considering that the I-IP network and E-IP network may support
   different kinds of multicast, the source address translation rules
   needed to support all possible scenarios may become very complex.
   But since SSM can be implemented with a strict subset of the PIM-SM
   protocol mechanisms [<a href="/doc/html/rfc7761" title="&quot;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)&quot;">RFC7761</a>], we can treat the I-IP core as SSM-only
   to make it as simple as possible.  There then remain only two
   scenarios to be discussed in detail:

   o  E-IP network supports SSM

      One possible way to make sure that the translated PIMv6 message
      reaches the upstream AFBR is to set S&#x27; to a virtual IPv6 address
      that leads to the upstream AFBR.  The unicast address translation
      should be achieved according to [<a href="/doc/html/rfc6052" title="&quot;IPv6 Addressing of IPv4/IPv6 Translators&quot;">RFC6052</a>].

   o  E-IP network supports ASM

      The (S,G) source list entry and the (*,G) source list entry differ
      only in that the latter has both the WildCard (WC) and RPT bits of
      the Encoded-Source-Address set, while with the former, the bits
      are cleared.  (See <a href="/doc/html/rfc7761#section-4.9.5.1">Section&nbsp;4.9.5.1 of [RFC7761]</a>.)  As a result,
      the source list entries in (*,G) messages can be translated into
      source list entries in (S&#x27;,G&#x27;) messages by clearing both the WC
      and RPT bits at downstream AFBRs, and vice versa for the reverse
      translation at upstream AFBRs.









<span class="grey">Xu, et al.                   Standards Track                    [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


<span class="h3"><a class="selflink" id="section-5.4" href="#section-5.4">5.4</a>.  Routing Mechanism</span>

   With mesh multicast, PIMv6 messages originating from a downstream
   AFBR need to be propagated to the correct upstream AFBR, and every
   AFBR needs the /96 prefix in the IPv4-embedded IPv6 source address
   format [<a href="/doc/html/rfc6052" title="&quot;IPv6 Addressing of IPv4/IPv6 Translators&quot;">RFC6052</a>].

   To achieve this, every AFBR MUST announce the address of one of its
   E-IPv4 interfaces in the &quot;v4&quot; field [<a href="/doc/html/rfc6052" title="&quot;IPv6 Addressing of IPv4/IPv6 Translators&quot;">RFC6052</a>] alongside the
   corresponding uPrefix46.  The announcement MUST be sent to the other
   AFBRs through Multiprotocol BGP (MBGP) [<a href="/doc/html/rfc4760" title="&quot;Multiprotocol Extensions for BGP-4&quot;">RFC4760</a>].  Every uPrefix64
   that an AFBR announces MUST be unique.  &quot;uPrefix64&quot; is an IPv6
   prefix, and the distribution mechanism is the same as the traditional
   mesh unicast scenario.

   As the &quot;v4&quot; field is an E-IP address, and BGP messages are not
   tunneled through softwires or any other mechanism specified in
   [<a href="/doc/html/rfc5565" title="&quot;Softwire Mesh Framework&quot;">RFC5565</a>], AFBRs MUST be able to transport and encode/decode BGP
   messages that are carried over the I-IP, and whose Network Layer
   Reachability Information (NLRI) and next hop (NH) are of the E-IP
   address family.

   In this way, when a downstream AFBR receives an E-IP PIM (S,G)
   message, it can translate this message into (S&#x27;,G&#x27;) by looking up the
   IP address of the corresponding AFBR&#x27;s E-IP interface.  Since the
   uPrefix64 of S&#x27; is unique and is known to every router in the I-IP
   network, the translated message will be forwarded to the
   corresponding upstream AFBR, and the upstream AFBR can translate the
   message back to (S,G).

   When a downstream AFBR receives an E-IP PIM (*,G) message, S&#x27; can be
   generated with the &quot;source address&quot; field set to * (the wildcard
   value).  The translated message will be forwarded to the
   corresponding upstream AFBR.  Every PIM router within a PIM domain
   MUST be able to map a particular multicast group address to the same
   RP when the source address is set to the wildcard value.  (See
   <a href="/doc/html/rfc7761#section-4.7">Section&nbsp;4.7 of [RFC7761]</a>.)  So, when the upstream AFBR checks the
   &quot;source address&quot; field of the message, it finds the IPv4 address of
   the RP and ascertains that this was originally a (*,G) message.  This
   is then translated back to the (*,G) message and processed.











<span class="grey">Xu, et al.                   Standards Track                    [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Control-Plane Functions of AFBR</span>

   AFBRs are responsible for the functions detailed in the subsections
   that follow.

<span class="h3"><a class="selflink" id="section-6.1" href="#section-6.1">6.1</a>.  E-IP (*,G) and (S,G) State Maintenance</span>

   E-IP (*,G) and (S,G) state maintenance for an AFBR is the same as
   E-IP (*,G) and (S,G) state maintenance for a multicast AFTR (mAFTR)
   described in <a href="/doc/html/rfc8114#section-7.2">Section&nbsp;7.2 of [RFC8114]</a>.

<span class="h3"><a class="selflink" id="section-6.2" href="#section-6.2">6.2</a>.  I-IP (S&#x27;,G&#x27;) State Maintenance</span>

   It is possible that the I-IP transit core runs another, non-transit,
   I-IP PIM-SSM instance.  Since the translated source address starts
   with the unique &quot;Well-Known&quot; prefix or the ISP-defined prefix that
   MUST NOT be used by another service provider, mesh multicast will not
   influence non-transit PIM-SSM multicast at all.  When an AFBR
   receives an I-IP (S&#x27;,G&#x27;) message, it MUST check S&#x27;.  If S&#x27; starts
   with the unique prefix, then the message is actually a translated
   E-IP (S,G) or (*,G) message, and the AFBR translates this message
   back to a PIMv4 message and processes it.

<span class="h3"><a class="selflink" id="section-6.3" href="#section-6.3">6.3</a>.  E-IP (S,G,rpt) State Maintenance</span>

   When an AFBR wishes to propagate a Join/Prune(S,G,rpt) message
   [<a href="/doc/html/rfc7761" title="&quot;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)&quot;">RFC7761</a>] to an I-IP upstream router, the AFBR MUST operate as
   specified in Sections <a href="#section-6.5">6.5</a> and <a href="#section-6.6">6.6</a>.

<span class="h3"><a class="selflink" id="section-6.4" href="#section-6.4">6.4</a>.  Inter-AFBR Signaling</span>

   Assume that one downstream AFBR has joined an RPT of (*,G) and a
   shortest path tree (SPT) of (S,G) and decided to perform an SPT
   switchover.  (See <a href="/doc/html/rfc7761#section-4.2.1">Section&nbsp;4.2.1 of [RFC7761]</a>.)  According to
   [<a href="/doc/html/rfc7761" title="&quot;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)&quot;">RFC7761</a>], it should propagate a Prune(S,G,rpt) message along with
   the periodic Join(*,G) message upstream towards the RP.  However,
   routers in the I-IP transit core do not process (S,G,rpt) messages
   since the I-IP transit core is treated as SSM only.  As a result, the
   downstream AFBR is unable to prune S from this RPT, so it will
   receive two copies of the same data for (S,G).  In order to solve
   this problem, we introduce a new mechanism for downstream AFBRs to
   inform upstream AFBRs of pruning any given S from an RPT.

   When a downstream AFBR wishes to propagate an (S,G,rpt) message
   upstream, it SHOULD encapsulate the (S,G,rpt) message, then send the
   encapsulated unicast message to the corresponding upstream AFBR,
   which we call &quot;RP&#x27;&quot;.




<span class="grey">Xu, et al.                   Standards Track                   [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   When RP&#x27; receives this encapsulated message, it MUST decapsulate the
   message as in the unicast scenario and retrieve the original
   (S,G,rpt) message.  The incoming interface of this message may be
   different from the outgoing interface that propagates multicast data
   to the corresponding downstream AFBR, and there may be other
   downstream AFBRs that need to receive multicast data for (S,G) from
   this incoming interface, so RP&#x27; should not simply process this
   message as specified in [<a href="/doc/html/rfc7761" title="&quot;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)&quot;">RFC7761</a>] on the incoming interface.

   To solve this problem, we introduce an &quot;interface agent&quot; to process
   all the encapsulated (S,G,rpt) messages the upstream AFBR receives.
   The interface agent&#x27;s RP&#x27; should prune S from the RPT of group G when
   no downstream AFBR is subscribed to receive multicast data for (S,G)
   along the RPT.

   In this way, we ensure that downstream AFBRs will not miss any
   multicast data that they need.  The cost of this is that multicast
   data for (S,G) will be duplicated along the RPT received by AFBRs
   affected by the SPT switchover, if at least one downstream AFBR
   exists that has not yet sent Prune(S,G,rpt) messages to the upstream
   AFBR.

   In certain deployment scenarios (e.g., if there is only a single
   downstream router), the interface agent function is not required.



























<span class="grey">Xu, et al.                   Standards Track                   [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   The mechanism used to achieve this is left to the implementation.
   The following diagram provides one possible solution for an
   &quot;interface agent&quot; implementation:

          +----------------------------------------+
          |                                        |
          |       +-----------+----------+         |
          |       |  PIM-SM   |    UDP   |         |
          |       +-----------+----------+         |
          |          ^                |            |
          |          |                |            |
          |          |                v            |
          |       +----------------------+         |
          |       |       I/F Agent      |         |
          |       +----------------------+         |
          |   PIM    ^                | multicast  |
          | messages |                |   data     |
          |          |  +-------------+---+        |
          |       +--+--|-----------+     |        |
          |       |     v           |     v        |
          |     +--------- +     +----------+      |
          |     | I-IP I/F |     | I-IP I/F |      |
          |     +----------+     +----------+      |
          |        ^     |          ^     |        |
          |        |     |          |     |        |
          +--------|-----|----------|-----|--------+
                   |     v          |     v

             Figure 4: Interface Agent Implementation Example

   Figure 4 shows an example of an interface agent implementation using
   UDP encapsulation.  The interface agent has two responsibilities: In
   the control plane, it should work as a real interface that has joined
   (*,G), representing all the I-IP interfaces that are outgoing
   interfaces of the (*,G) state machine, and it should process the
   (S,G,rpt) messages received from all the I-IP interfaces.

   The interface agent maintains downstream (S,G,rpt) state machines for
   every downstream AFBR, and it submits Prune(S,G,rpt) messages to the
   PIM-SM module only when every (S,G,rpt) state machine is in the
   Prune(P) or PruneTmp(P&#x27;) state, which means that no downstream AFBR
   is subscribed to receive multicast data for (S,G) along the RPT of G.
   Once a (S,G,rpt) state machine changes to NoInfo (NI) state, which
   means that the corresponding downstream AFBR has switched to receive
   multicast data for (S,G) along the RPT again, the interface agent
   MUST send a Join(S,G,rpt) to the PIM-SM module immediately.





<span class="grey">Xu, et al.                   Standards Track                   [Page 12]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-13" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   In the data plane, upon receiving a multicast data packet, the
   interface agent MUST encapsulate it at first, then propagate the
   encapsulated packet from every I-IP interface.

   NOTICE: It is possible that an E-IP neighbor of RP&#x27; has joined the
   RPT of G, so the per-interface state machine for receiving E-IP Join/
   Prune(S,G,rpt) messages should be preserved.

<span class="h3"><a class="selflink" id="section-6.5" href="#section-6.5">6.5</a>.  SPT Switchover</span>

   After a new AFBR requests the receipt of traffic destined for a
   multicast group, it will receive all the data from the RPT at first.
   At this time, every downstream AFBR will receive multicast data from
   any source from this RPT, in spite of whether they have switched over
   to an SPT or not.

   To minimize this redundancy, it is recommended that every AFBR&#x27;s
   SwitchToSptDesired(S,G) function employs the &quot;switch on first packet&quot;
   policy.  In this way, the delay in switchover to SPT is kept as small
   as possible, and after the moment that every AFBR has performed the
   SPT switchover for every S of group G, no data will be forwarded in
   the RPT of G, thus no more unnecessary duplication will be produced.

<span class="h3"><a class="selflink" id="section-6.6" href="#section-6.6">6.6</a>.  Other PIM Message Types</span>

   In addition to Join or Prune, other message types exist, including
   Register, Register-Stop, Hello and Assert.  Register and Register-
   Stop messages are sent by unicast, while Hello and Assert messages
   are only used between directly linked routers to negotiate with each
   other.  It is not necessary to translate these for forwarding, thus
   the processing of these messages is out of scope for this document.

<span class="h3"><a class="selflink" id="section-6.7" href="#section-6.7">6.7</a>.  Maintenance of Other PIM States</span>

   In addition to states mentioned above, other states exist, including
   (*,*,RP) and I-IP (*,G&#x27;) state.  Since we treat the I-IP core as SSM
   only, the maintenance of these states is out of scope for this
   document.

<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  Data-Plane Functions of the AFBR</span>

<span class="h3"><a class="selflink" id="section-7.1" href="#section-7.1">7.1</a>.  Process and Forward Multicast Data</span>

   Refer to <a href="/doc/html/rfc8114#section-7.4">Section&nbsp;7.4 of [RFC8114]</a>.  If there is at least one outgoing
   interface whose IP address family is different from the incoming
   interface, the AFBR MUST encapsulate this packet with
   mPrefix64-derived and uPrefix64-derived IPv6 addresses to form an
   IPv6 multicast packet.



<span class="grey">Xu, et al.                   Standards Track                   [Page 13]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-14" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


<span class="h3"><a class="selflink" id="section-7.2" href="#section-7.2">7.2</a>.  TTL or Hop Count</span>

   Upon encapsulation, the TTL and hop count in the outer header SHOULD
   be set by policy.  Upon decapsulation, the TTL and hop count in the
   inner header SHOULD be modified by policy; it MUST NOT be incremented
   and it MAY be decremented to reflect the cost of tunnel forwarding.
   Besides, processing of TTL and hop count information in protocol
   headers depends on the tunneling technology, which is out of scope of
   this document.

<span class="h3"><a class="selflink" id="section-7.3" href="#section-7.3">7.3</a>.  Fragmentation</span>

   The encapsulation performed by an upstream AFBR will increase the
   size of packets.  As a result, the outgoing I-IP link MTU may not
   accommodate the larger packet size.  It is not always possible for
   core operators to increase the MTU of every link, thus source
   fragmentation after encapsulation and reassembling of encapsulated
   packets MUST be supported by AFBRs [<a href="/doc/html/rfc5565" title="&quot;Softwire Mesh Framework&quot;">RFC5565</a>].  Path MTU Discovery
   (PMTUD) [<a href="/doc/html/rfc8201" title="&quot;Path MTU Discovery for IP version 6&quot;">RFC8201</a>] SHOULD be enabled, and ICMPv6 packets MUST NOT be
   filtered in the I-IP network.  Fragmentation and tunnel configuration
   considerations are provided in <a href="/doc/html/rfc5565#section-8">Section&nbsp;8 of [RFC5565]</a>.  The detailed
   procedure can be referred in <a href="/doc/html/rfc2473#section-7.2">Section&nbsp;7.2 of [RFC2473]</a>.

<span class="h2"><a class="selflink" id="section-8" href="#section-8">8</a>.  Packet Format and Translation</span>

   Because the PIM-SM specification is independent of the underlying
   unicast routing protocol, the packet format in <a href="/doc/html/rfc7761#section-4.9">Section&nbsp;4.9 of
   [RFC7761]</a> remains the same, except that the group address and source
   address MUST be translated when traversing an AFBR.






















<span class="grey">Xu, et al.                   Standards Track                   [Page 14]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-15" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   For example, Figure 5 shows the register-stop message format in the
   IPv4 and IPv6 address families.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |PIM Ver| Type  |   Reserved    |           Checksum            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |             IPv4 Group Address (Encoded-Group format)         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            IPv4 Source Address (Encoded-Unicast format)       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    (a) IPv4 Register-Stop Message Format


       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |PIM Ver| Type  |   Reserved    |           Checksum            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |             IPv6 Group Address (Encoded-Group format)         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            IPv6 Source Address (Encoded-Unicast format)       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    (b) IPv6 Register-Stop Message Format

                  Figure 5: Register-Stop Message Format

   In Figure 5, the semantics of fields &quot;PIM Ver&quot;, &quot;Type&quot;, &quot;Reserved&quot;,
   and &quot;Checksum&quot; are specified in <a href="/doc/html/rfc7761#section-4.9">Section&nbsp;4.9 of [RFC7761]</a>.

   IPv4 Group Address (Encoded-Group format): The encoded-group format
   of the IPv4 group address described in <a href="/doc/html/rfc7761#section-4.9.1">Section&nbsp;4.9.1 of [RFC7761]</a>.

   IPv4 Source Address (Encoded-Group format): The encoded-unicast
   format of the IPv4 source address described in <a href="/doc/html/rfc7761#section-4.9.1">Section&nbsp;4.9.1 of
   [RFC7761]</a>.

   IPv6 Group Address (Encoded-Group format): The encoded-group format
   of the IPv6 group address described in <a href="#section-5.2">Section 5.2</a>.

   IPv6 Source Address (Encoded-Group format): The encoded-unicast
   format of the IPv6 source address described in <a href="#section-5.3">Section 5.3</a>.






<span class="grey">Xu, et al.                   Standards Track                   [Page 15]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-16" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


<span class="h2"><a class="selflink" id="section-9" href="#section-9">9</a>.  Softwire Mesh Multicast Encapsulation</span>

   Softwire mesh multicast encapsulation does not require the use of any
   one particular encapsulation mechanism.  Rather, it MUST accommodate
   a variety of different encapsulation mechanisms and allow the use of
   encapsulation mechanisms mentioned in [<a href="/doc/html/rfc4925" title="&quot;Softwire Problem Statement&quot;">RFC4925</a>].  Additionally, all
   of the AFBRs attached to the I-IP network MUST implement the same
   encapsulation mechanism and follow the requirements mentioned in
   <a href="/doc/html/rfc5565#section-8">Section&nbsp;8 of [RFC5565]</a>.

<span class="h2"><a class="selflink" id="section-10" href="#section-10">10</a>.  Security Considerations</span>

   The security concerns raised in [<a href="/doc/html/rfc4925" title="&quot;Softwire Problem Statement&quot;">RFC4925</a>] and [<a href="/doc/html/rfc7761" title="&quot;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)&quot;">RFC7761</a>] are
   applicable here.

   The additional workload associated with some schemes, such as
   interface agents, could be exploited by an attacker to perform a DDoS
   attack.

   Compared with [<a href="/doc/html/rfc4925" title="&quot;Softwire Problem Statement&quot;">RFC4925</a>], the security concerns should be considered
   more carefully: An attacker could potentially set up many multicast
   trees in the edge networks, causing too many multicast states in the
   core network.  To defend against these attacks, BGP policies SHOULD
   be carefully configured, e.g., AFBRs only accept Well-Known prefix
   advertisements from trusted peers.  Besides, cryptographic methods
   for authenticating BGP sessions [<a href="/doc/html/rfc7454" title="&quot;BGP Operations and Security&quot;">RFC7454</a>] could be used.

<span class="h2"><a class="selflink" id="section-11" href="#section-11">11</a>.  IANA Considerations</span>

   This document has no IANA actions.

<span class="h2"><a class="selflink" id="section-12" href="#section-12">12</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., &quot;Key words for use in RFCs to Indicate
              Requirement Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2473">RFC2473</a>]  Conta, A. and S. Deering, &quot;Generic Packet Tunneling in
              IPv6 Specification&quot;, <a href="/doc/html/rfc2473">RFC 2473</a>, DOI 10.17487/RFC2473,
              December 1998, &lt;<a href="https://www.rfc-editor.org/info/rfc2473">https://www.rfc-editor.org/info/rfc2473</a>&gt;.

   [<a id="ref-RFC4760">RFC4760</a>]  Bates, T., Chandra, R., Katz, D., and Y. Rekhter,
              &quot;Multiprotocol Extensions for BGP-4&quot;, <a href="/doc/html/rfc4760">RFC 4760</a>,
              DOI 10.17487/RFC4760, January 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4760">https://www.rfc-editor.org/info/rfc4760</a>&gt;.





<span class="grey">Xu, et al.                   Standards Track                   [Page 16]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-17" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   [<a id="ref-RFC4925">RFC4925</a>]  Li, X., Ed., Dawkins, S., Ed., Ward, D., Ed., and A.
              Durand, Ed., &quot;Softwire Problem Statement&quot;, <a href="/doc/html/rfc4925">RFC 4925</a>,
              DOI 10.17487/RFC4925, July 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4925">https://www.rfc-editor.org/info/rfc4925</a>&gt;.

   [<a id="ref-RFC5565">RFC5565</a>]  Wu, J., Cui, Y., Metz, C., and E. Rosen, &quot;Softwire Mesh
              Framework&quot;, <a href="/doc/html/rfc5565">RFC 5565</a>, DOI 10.17487/RFC5565, June 2009,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5565">https://www.rfc-editor.org/info/rfc5565</a>&gt;.

   [<a id="ref-RFC6052">RFC6052</a>]  Bao, C., Huitema, C., Bagnulo, M., Boucadair, M., and X.
              Li, &quot;IPv6 Addressing of IPv4/IPv6 Translators&quot;, <a href="/doc/html/rfc6052">RFC 6052</a>,
              DOI 10.17487/RFC6052, October 2010,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6052">https://www.rfc-editor.org/info/rfc6052</a>&gt;.

   [<a id="ref-RFC6333">RFC6333</a>]  Durand, A., Droms, R., Woodyatt, J., and Y. Lee, &quot;Dual-
              Stack Lite Broadband Deployments Following IPv4
              Exhaustion&quot;, <a href="/doc/html/rfc6333">RFC 6333</a>, DOI 10.17487/RFC6333, August 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6333">https://www.rfc-editor.org/info/rfc6333</a>&gt;.

   [<a id="ref-RFC6513">RFC6513</a>]  Rosen, E., Ed. and R. Aggarwal, Ed., &quot;Multicast in MPLS/
              BGP IP VPNs&quot;, <a href="/doc/html/rfc6513">RFC 6513</a>, DOI 10.17487/RFC6513, February
              2012, &lt;<a href="https://www.rfc-editor.org/info/rfc6513">https://www.rfc-editor.org/info/rfc6513</a>&gt;.

   [<a id="ref-RFC7454">RFC7454</a>]  Durand, J., Pepelnjak, I., and G. Doering, &quot;BGP Operations
              and Security&quot;, <a href="/doc/html/bcp194">BCP 194</a>, <a href="/doc/html/rfc7454">RFC 7454</a>, DOI 10.17487/RFC7454,
              February 2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7454">https://www.rfc-editor.org/info/rfc7454</a>&gt;.

   [<a id="ref-RFC7761">RFC7761</a>]  Fenner, B., Handley, M., Holbrook, H., Kouvelas, I.,
              Parekh, R., Zhang, Z., and L. Zheng, &quot;Protocol Independent
              Multicast - Sparse Mode (PIM-SM): Protocol Specification
              (Revised)&quot;, STD 83, <a href="/doc/html/rfc7761">RFC 7761</a>, DOI 10.17487/RFC7761, March
              2016, &lt;<a href="https://www.rfc-editor.org/info/rfc7761">https://www.rfc-editor.org/info/rfc7761</a>&gt;.

   [<a id="ref-RFC7899">RFC7899</a>]  Morin, T., Ed., Litkowski, S., Patel, K., Zhang, Z.,
              Kebler, R., and J. Haas, &quot;Multicast VPN State Damping&quot;,
              <a href="/doc/html/rfc7899">RFC 7899</a>, DOI 10.17487/RFC7899, June 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7899">https://www.rfc-editor.org/info/rfc7899</a>&gt;.

   [<a id="ref-RFC8114">RFC8114</a>]  Boucadair, M., Qin, C., Jacquenet, C., Lee, Y., and Q.
              Wang, &quot;Delivery of IPv4 Multicast Services to IPv4 Clients
              over an IPv6 Multicast Network&quot;, <a href="/doc/html/rfc8114">RFC 8114</a>,
              DOI 10.17487/RFC8114, March 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8114">https://www.rfc-editor.org/info/rfc8114</a>&gt;.

   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., &quot;Ambiguity of Uppercase vs Lowercase in <a href="/doc/html/rfc2119">RFC</a>
              <a href="/doc/html/rfc2119">2119</a> Key Words&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.




<span class="grey">Xu, et al.                   Standards Track                   [Page 17]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-18" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   [<a id="ref-RFC8201">RFC8201</a>]  McCann, J., Deering, S., Mogul, J., and R. Hinden, Ed.,
              &quot;Path MTU Discovery for IP version 6&quot;, STD 87, <a href="/doc/html/rfc8201">RFC 8201</a>,
              DOI 10.17487/RFC8201, July 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8201">https://www.rfc-editor.org/info/rfc8201</a>&gt;.

Acknowledgements

   Wenlong Chen, Xuan Chen, Alain Durand, Yiu Lee, Jacni Qin, and Stig
   Venaas provided useful input to this document.

Authors&#x27; Addresses

   Mingwei Xu
   Tsinghua University
   Department of Computer Science
   Beijing  100084
   China

   Phone: +86-10-6278-5822
   Email: xumw@tsinghua.edu.cn


   Yong Cui
   Tsinghua University
   Department of Computer Science
   Beijing  100084
   China

   Phone: +86-10-6278-5822
   Email: cuiyong@tsinghua.edu.cn


   Jianping Wu
   Tsinghua University
   Department of Computer Science
   Beijing  100084
   China

   Phone: +86-10-6278-5983
   Email: jianping@cernet.edu.cn











<span class="grey">Xu, et al.                   Standards Track                   [Page 18]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-19" ></span>
<span class="grey"><a href="/doc/html/rfc8638">RFC 8638</a>                 Softwire Mesh Multicast          September 2019</span>


   Shu Yang
   Shenzhen University
   South Campus
   Shenzhen  518060
   China

   Phone: +86-755-2653-4078
   Email: yang.shu@szu.edu.cn


   Chris Metz
   Cisco Systems
   170 West Tasman Drive
   San Jose, CA  95134
   United States of America

   Phone: +1-408-525-3275
   Email: chmetz@cisco.com

































Xu, et al.                   Standards Track                   [Page 19]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

